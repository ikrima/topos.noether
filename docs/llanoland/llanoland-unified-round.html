<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>LLANOLAND ‚Äî Complete Debate Round</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Spectral:ital,wght@0,400;0,700;1,400&family=Bebas+Neue&family=Press+Start+2P&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    
    :root {
      /* SNES-inspired palette with LTTP influence */
      --bg-deep: #1a1a2e;
      --bg-mid: #16213e;
      --bg-light: #1f3460;
      --gold: #ffd700;
      --gold-dark: #b8860b;
      --sacred-blue: #4a9fff;
      --sacred-green: #50c878;
      --danger-red: #dc3545;
      --magic-purple: #9b59b6;
      --wisdom-teal: #20b2aa;
      --text-light: #f0f0f0;
      --text-mid: #a0a0b0;
      --frame-highlight: #5a7faa;
      --frame-shadow: #0f0f1a;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    body {
      background: var(--bg-deep);
      font-family: 'Spectral', serif;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .game-container {
      width: 100%;
      max-width: 800px;
      height: 100vh;
      max-height: 900px;
      position: relative;
      overflow: hidden;
    }
    
    /* Phase indicator */
    .phase-banner {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px 20px;
      background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .phase-indicator {
      display: flex;
      gap: 10px;
    }
    
    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--frame-shadow);
      border: 2px solid var(--frame-highlight);
      transition: all 0.3s;
    }
    
    .phase-dot.active {
      background: var(--gold);
      border-color: var(--gold);
      box-shadow: 0 0 15px var(--gold);
    }
    
    .phase-dot.complete {
      background: var(--sacred-green);
      border-color: var(--sacred-green);
    }
    
    .phase-name {
      font-family: 'Cinzel', serif;
      font-size: 14px;
      color: var(--gold);
      letter-spacing: 3px;
    }
    
    .round-info {
      text-align: right;
      font-size: 12px;
      color: var(--text-mid);
    }
    
    /* Coherence bar */
    .coherence-display {
      position: absolute;
      top: 60px;
      left: 20px;
      right: 20px;
      z-index: 100;
    }
    
    .coherence-label {
      font-family: 'Cinzel', serif;
      font-size: 11px;
      color: var(--text-mid);
      letter-spacing: 2px;
      margin-bottom: 5px;
    }
    
    .coherence-bar {
      height: 8px;
      background: rgba(0,0,0,0.5);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--frame-highlight);
    }
    
    .coherence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--sacred-green), var(--wisdom-teal));
      transition: width 0.3s;
      box-shadow: 0 0 10px var(--sacred-green);
    }
    
    .coherence-fill.low {
      background: linear-gradient(90deg, var(--danger-red), #ff6b6b);
    }
    
    /* ==================== */
    /* PHASE 1: THE FLOW    */
    /* ==================== */
    
    .flow-phase {
      position: absolute;
      inset: 0;
      padding: 100px 20px 20px;
      display: flex;
      flex-direction: column;
      animation: phase-in 0.5s ease-out;
    }
    
    @keyframes phase-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .flow-title {
      font-family: 'Cinzel', serif;
      font-size: 24px;
      text-align: center;
      color: var(--gold);
      margin-bottom: 5px;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
    }
    
    .flow-subtitle {
      font-size: 14px;
      text-align: center;
      color: var(--text-mid);
      margin-bottom: 20px;
      font-style: italic;
    }
    
    .flow-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      flex: 1;
      min-height: 0;
    }
    
    .flow-column {
      background: rgba(0,0,0,0.3);
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
    }
    
    .flow-column-header {
      font-family: 'Cinzel', serif;
      font-size: 12px;
      letter-spacing: 2px;
      padding-bottom: 10px;
      margin-bottom: 10px;
      border-bottom: 1px solid var(--frame-highlight);
    }
    
    .opponent-header { color: var(--danger-red); }
    .response-header { color: var(--sacred-green); }
    
    .argument-item {
      background: var(--bg-mid);
      border: 2px solid var(--frame-highlight);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .argument-item:hover {
      border-color: var(--gold);
      transform: translateX(3px);
    }
    
    .argument-item.selected {
      border-color: var(--gold);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }
    
    .argument-item.assigned {
      border-color: var(--sacred-green);
      opacity: 0.7;
    }
    
    .arg-label {
      font-family: 'Cinzel', serif;
      font-size: 10px;
      color: var(--text-mid);
      margin-bottom: 5px;
    }
    
    .arg-text {
      font-size: 15px;
      line-height: 1.4;
    }
    
    .arg-response {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed var(--frame-highlight);
      font-size: 13px;
      color: var(--sacred-green);
    }
    
    /* Response selection panel */
    .response-panel {
      background: var(--bg-mid);
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .response-panel-title {
      font-family: 'Cinzel', serif;
      font-size: 12px;
      color: var(--gold);
      text-align: center;
      margin-bottom: 12px;
    }
    
    .response-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    
    .response-btn {
      padding: 12px 8px;
      background: var(--bg-deep);
      border: 2px solid var(--frame-highlight);
      border-radius: 6px;
      color: var(--text-light);
      font-family: 'Cinzel', serif;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .response-btn:hover:not(:disabled) {
      border-color: var(--gold);
      transform: translateY(-2px);
    }
    
    .response-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .response-btn .btn-icon {
      display: block;
      font-size: 18px;
      margin-bottom: 4px;
    }
    
    /* Ready button */
    .ready-btn {
      width: 100%;
      padding: 15px;
      margin-top: 15px;
      background: linear-gradient(135deg, var(--gold-dark), var(--gold));
      border: none;
      border-radius: 8px;
      color: var(--bg-deep);
      font-family: 'Cinzel', serif;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 3px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
    }
    
    .ready-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(255, 215, 0, 0.5);
    }
    
    .ready-btn:disabled {
      background: var(--frame-highlight);
      color: var(--text-mid);
      box-shadow: none;
      cursor: not-allowed;
    }
    
    /* ==================== */
    /* PHASE 2: TAP BATTLE  */
    /* ==================== */
    
    .battle-phase {
      position: absolute;
      inset: 0;
      animation: phase-in 0.5s ease-out;
    }
    
    .battle-hud {
      position: absolute;
      top: 90px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      z-index: 100;
    }
    
    .combo-display {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      color: var(--gold);
      text-shadow: 0 0 20px var(--gold);
    }
    
    .timer-display {
      font-family: 'Press Start 2P', cursive;
      font-size: 14px;
      color: var(--sacred-blue);
    }
    
    .timer-display.urgent {
      color: var(--danger-red);
      animation: blink 0.3s infinite;
    }
    
    @keyframes blink {
      50% { opacity: 0.5; }
    }
    
    .battle-area {
      position: absolute;
      top: 130px;
      left: 0;
      right: 0;
      bottom: 160px;
      overflow: hidden;
    }
    
    .battle-argument {
      position: absolute;
      padding: 10px 16px;
      background: linear-gradient(135deg, var(--danger-red), #ff6b6b);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      color: white;
      cursor: pointer;
      transition: transform 0.1s;
      box-shadow: 0 0 20px rgba(220, 53, 69, 0.5);
      max-width: 180px;
      text-align: center;
    }
    
    .battle-argument.prepared {
      background: linear-gradient(135deg, var(--sacred-blue), #6bb3ff);
      box-shadow: 0 0 20px rgba(74, 159, 255, 0.5);
    }
    
    .battle-argument:active {
      transform: scale(0.9);
    }
    
    .battle-response-zone {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 160px;
      background: linear-gradient(0deg, var(--bg-deep) 0%, transparent 100%);
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    
    .danger-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--danger-red);
      box-shadow: 0 0 15px var(--danger-red);
    }
    
    .battle-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .battle-btn {
      padding: 15px;
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      background: var(--bg-mid);
      color: var(--text-light);
      font-family: 'Cinzel', serif;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.1s;
    }
    
    .battle-btn:active {
      transform: scale(0.95);
    }
    
    .battle-btn.answer { border-color: var(--sacred-blue); }
    .battle-btn.turn { border-color: var(--sacred-green); }
    .battle-btn.question { border-color: var(--gold); }
    
    /* ==================== */
    /* PHASE 3: THE JUDGE   */
    /* ==================== */
    
    .judge-phase {
      position: absolute;
      inset: 0;
      padding: 100px 20px 20px;
      animation: phase-in 0.5s ease-out;
      display: flex;
      flex-direction: column;
    }
    
    .judge-portrait {
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
      background: var(--bg-mid);
      border: 4px solid var(--gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    }
    
    .judge-name {
      font-family: 'Cinzel', serif;
      font-size: 24px;
      text-align: center;
      color: var(--gold);
      margin-bottom: 5px;
    }
    
    .judge-paradigm {
      font-size: 14px;
      text-align: center;
      color: var(--text-mid);
      font-style: italic;
      margin-bottom: 20px;
    }
    
    .judge-speech {
      background: var(--bg-mid);
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      font-size: 16px;
      line-height: 1.6;
      text-align: center;
    }
    
    .judge-tells {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .judge-tell {
      padding: 8px 16px;
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid var(--gold);
      border-radius: 20px;
      font-size: 12px;
      color: var(--gold);
    }
    
    .final-arguments {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .final-arg-btn {
      flex: 1;
      padding: 20px;
      background: var(--bg-mid);
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      color: var(--text-light);
      font-family: 'Spectral', serif;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }
    
    .final-arg-btn:hover {
      border-color: var(--gold);
      transform: translateX(5px);
    }
    
    .final-arg-btn .arg-type {
      font-family: 'Cinzel', serif;
      font-size: 11px;
      color: var(--sacred-blue);
      margin-bottom: 5px;
      letter-spacing: 2px;
    }
    
    /* ==================== */
    /* RESULTS              */
    /* ==================== */
    
    .result-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 500;
      animation: fade-in 0.5s ease-out;
      padding: 30px;
      text-align: center;
    }
    
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .result-ballot {
      font-family: 'Cinzel', serif;
      font-size: 14px;
      color: var(--text-mid);
      letter-spacing: 4px;
      margin-bottom: 10px;
    }
    
    .result-verdict {
      font-family: 'Cinzel', serif;
      font-size: 48px;
      margin-bottom: 30px;
    }
    
    .result-verdict.victory {
      color: var(--gold);
      text-shadow: 0 0 40px var(--gold);
    }
    
    .result-verdict.defeat {
      color: var(--danger-red);
    }
    
    .result-reason {
      font-size: 18px;
      color: var(--text-light);
      max-width: 400px;
      line-height: 1.8;
      margin-bottom: 30px;
    }
    
    .result-reason em {
      color: var(--gold);
      font-style: normal;
    }
    
    .unlock-box {
      background: var(--bg-mid);
      border: 3px solid var(--gold);
      border-radius: 12px;
      padding: 25px 40px;
      margin-bottom: 30px;
      animation: unlock-glow 1s infinite;
    }
    
    @keyframes unlock-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
      50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
    }
    
    .unlock-label {
      font-family: 'Cinzel', serif;
      font-size: 12px;
      color: var(--text-mid);
      letter-spacing: 3px;
      margin-bottom: 10px;
    }
    
    .unlock-name {
      font-family: 'Cinzel', serif;
      font-size: 28px;
      color: var(--gold);
      text-shadow: 0 0 20px var(--gold);
    }
    
    .unlock-desc {
      font-size: 14px;
      color: var(--text-mid);
      margin-top: 10px;
    }
    
    .continue-btn {
      padding: 15px 40px;
      background: transparent;
      border: 2px solid var(--gold);
      border-radius: 8px;
      color: var(--gold);
      font-family: 'Cinzel', serif;
      font-size: 14px;
      letter-spacing: 3px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .continue-btn:hover {
      background: var(--gold);
      color: var(--bg-deep);
    }
    
    /* ==================== */
    /* START SCREEN         */
    /* ==================== */
    
    .start-screen {
      position: fixed;
      inset: 0;
      background: var(--bg-deep);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 500;
      padding: 30px;
      text-align: center;
    }
    
    .start-world {
      font-family: 'Cinzel', serif;
      font-size: 14px;
      color: var(--text-mid);
      letter-spacing: 4px;
      margin-bottom: 10px;
    }
    
    .start-title {
      font-family: 'Cinzel', serif;
      font-size: 36px;
      color: var(--gold);
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
      margin-bottom: 30px;
    }
    
    .start-desc {
      font-size: 16px;
      color: var(--text-light);
      max-width: 400px;
      line-height: 1.8;
      margin-bottom: 40px;
    }
    
    .start-phases {
      display: flex;
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .start-phase {
      padding: 15px 20px;
      background: var(--bg-mid);
      border: 2px solid var(--frame-highlight);
      border-radius: 8px;
      width: 140px;
    }
    
    .start-phase-num {
      font-family: 'Cinzel', serif;
      font-size: 11px;
      color: var(--text-mid);
      letter-spacing: 2px;
    }
    
    .start-phase-name {
      font-family: 'Cinzel', serif;
      font-size: 14px;
      color: var(--gold);
      margin-top: 5px;
    }
    
    .begin-btn {
      padding: 20px 60px;
      background: linear-gradient(135deg, var(--gold-dark), var(--gold));
      border: none;
      border-radius: 8px;
      color: var(--bg-deep);
      font-family: 'Cinzel', serif;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 4px;
      cursor: pointer;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
      transition: all 0.2s;
    }
    
    .begin-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
    }
    
    /* Transition effects */
    .phase-transition {
      position: fixed;
      inset: 0;
      background: var(--bg-deep);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 400;
      animation: transition-flash 1s ease-out forwards;
    }
    
    @keyframes transition-flash {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }
    
    .transition-text {
      font-family: 'Cinzel', serif;
      font-size: 32px;
      color: var(--gold);
      text-shadow: 0 0 30px var(--gold);
      animation: transition-zoom 1s ease-out;
    }
    
    @keyframes transition-zoom {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* Drop effect */
    .drop-flash {
      position: fixed;
      inset: 0;
      background: var(--danger-red);
      z-index: 300;
      animation: drop-flash 0.2s ease-out forwards;
      pointer-events: none;
    }
    
    @keyframes drop-flash {
      0% { opacity: 0.6; }
      100% { opacity: 0; }
    }
    
    /* Particles */
    .particle {
      position: absolute;
      pointer-events: none;
      z-index: 200;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      color: var(--gold);
      text-shadow: 0 0 10px var(--gold);
      animation: particle-up 0.6s ease-out forwards;
    }
    
    @keyframes particle-up {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-60px); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;
    
    // Opponent arguments for this round
    const OPPONENT_CASE = [
      { id: 1, label: "Contention 1", text: "The status quo is failing‚Äîcurrent policy causes harm.", type: "harm" },
      { id: 2, label: "Contention 2", text: "Our plan solves through federal intervention.", type: "solvency" },
      { id: 3, label: "Advantage", text: "Economic growth outweighs all other impacts.", type: "impact" },
    ];
    
    // Response options
    const RESPONSES = [
      { id: "question", name: "Question", icon: "‚ùì", desc: "Probe for weakness" },
      { id: "answer", name: "Answer", icon: "‚öîÔ∏è", desc: "Direct refutation" },
      { id: "turn", name: "Turn", icon: "üîÑ", desc: "Flip their argument" },
      { id: "concede", name: "Concede", icon: "üè≥Ô∏è", desc: "Strategic yield" },
    ];
    
    // Judge templates
    const JUDGES = [
      {
        name: "Judge Williams",
        emoji: "üë®‚Äç‚öñÔ∏è",
        paradigm: "Policy Maker",
        tells: ["Checks watch frequently", "Nods at statistics"],
        speech: "I'm ready to vote. Make it count‚ÄîI've got another round after this.",
        winningArg: "impact",
        winReason: "Your impact calculus was decisive. Real-world consequences matter.",
        loseReason: "You never showed me why your impacts outweigh. I vote on the flow.",
      },
      {
        name: "Professor Chen",
        emoji: "üë©‚Äçüè´",
        paradigm: "Kritik Judge",
        tells: ["Leans forward at philosophy", "Takes extensive notes"],
        speech: "I want to understand the deeper implications. Don't just tell me what‚Äîtell me why it matters.",
        winningArg: "framework",
        winReason: "Your framework recontextualized the entire debate. Brilliant.",
        loseReason: "You engaged on their terms. I needed you to challenge the assumptions.",
      },
      {
        name: "Coach Martinez",
        emoji: "üßî",
        paradigm: "Tabula Rasa",
        tells: ["Expressionless", "Flows everything"],
        speech: "I'll vote on whatever you win. Don't assume I know anything‚Äîprove it.",
        winningArg: "solvency",
        winReason: "Clean extensions, clear warrants. You won the line-by-line.",
        loseReason: "Dropped arguments are true arguments. You left too much on the flow.",
      },
    ];
    
    function DebateRound() {
      const [gameState, setGameState] = useState('start'); // start, flow, transition, battle, judge, result
      const [phase, setPhase] = useState(0); // 0=flow, 1=battle, 2=judge
      const [coherence, setCoherence] = useState(100);
      const [transitionText, setTransitionText] = useState('');
      
      // Flow phase state
      const [selectedArg, setSelectedArg] = useState(null);
      const [assignments, setAssignments] = useState({});
      
      // Battle phase state
      const [battleArgs, setBattleArgs] = useState([]);
      const [combo, setCombo] = useState(0);
      const [battleTimer, setBattleTimer] = useState(30);
      const [drops, setDrops] = useState(0);
      const [dropFlash, setDropFlash] = useState(false);
      const [particles, setParticles] = useState([]);
      
      // Judge phase state
      const [judge, setJudge] = useState(null);
      const [selectedFinal, setSelectedFinal] = useState(null);
      const [result, setResult] = useState(null);
      
      const battleLoopRef = useRef(null);
      const spawnRef = useRef(null);
      const argIdRef = useRef(100);
      const particleIdRef = useRef(0);
      
      // Start the round
      const startRound = useCallback(() => {
        setGameState('flow');
        setPhase(0);
        setCoherence(100);
        setSelectedArg(null);
        setAssignments({});
        setCombo(0);
        setBattleTimer(30);
        setDrops(0);
        setJudge(JUDGES[Math.floor(Math.random() * JUDGES.length)]);
        setResult(null);
      }, []);
      
      // Assign response to argument
      const assignResponse = useCallback((responseId) => {
        if (!selectedArg) return;
        setAssignments(prev => ({
          ...prev,
          [selectedArg]: responseId
        }));
        setSelectedArg(null);
      }, [selectedArg]);
      
      // Check if ready for battle
      const allAssigned = Object.keys(assignments).length === OPPONENT_CASE.length;
      
      // Transition to battle phase
      const startBattle = useCallback(() => {
        setTransitionText("SPEECHES BEGIN");
        setGameState('transition');
        
        setTimeout(() => {
          setGameState('battle');
          setPhase(1);
          setBattleTimer(30);
          setBattleArgs([]);
        }, 1000);
      }, []);
      
      // Battle phase: spawn arguments
      useEffect(() => {
        if (gameState !== 'battle') return;
        
        const spawnArg = () => {
          const template = OPPONENT_CASE[Math.floor(Math.random() * OPPONENT_CASE.length)];
          const isPrepared = assignments[template.id] !== undefined;
          
          const newArg = {
            id: argIdRef.current++,
            text: template.text.substring(0, 40) + "...",
            type: template.type,
            prepared: isPrepared,
            x: 10 + Math.random() * 80,
            y: -20,
            createdAt: Date.now(),
            duration: isPrepared ? 5000 : 3500, // Prepared args are slower
          };
          
          setBattleArgs(prev => [...prev, newArg]);
        };
        
        // Spawn initial args
        setTimeout(spawnArg, 500);
        setTimeout(spawnArg, 1200);
        
        // Continuous spawning
        spawnRef.current = setInterval(spawnArg, 2000);
        
        // Timer countdown
        battleLoopRef.current = setInterval(() => {
          setBattleTimer(prev => {
            if (prev <= 1) {
              // Transition to judge
              clearInterval(battleLoopRef.current);
              clearInterval(spawnRef.current);
              setTransitionText("TIME! JUDGE DECIDES...");
              setGameState('transition');
              setTimeout(() => {
                setGameState('judge');
                setPhase(2);
              }, 1000);
              return 0;
            }
            return prev - 1;
          });
          
          // Move arguments down and check for drops
          setBattleArgs(prev => {
            const now = Date.now();
            const updated = [];
            
            prev.forEach(arg => {
              const progress = (now - arg.createdAt) / arg.duration;
              if (progress >= 1) {
                // Dropped!
                setDrops(d => d + 1);
                setCoherence(c => Math.max(0, c - 15));
                setCombo(0);
                setDropFlash(true);
                setTimeout(() => setDropFlash(false), 200);
              } else {
                updated.push({ ...arg, progress });
              }
            });
            
            return updated;
          });
        }, 100);
        
        return () => {
          clearInterval(battleLoopRef.current);
          clearInterval(spawnRef.current);
        };
      }, [gameState, assignments]);
      
      // Handle tapping argument in battle
      const handleTapArg = useCallback((arg) => {
        setBattleArgs(prev => prev.filter(a => a.id !== arg.id));
        setCombo(prev => prev + 1);
        
        // Spawn particle
        setParticles(prev => [...prev, {
          id: particleIdRef.current++,
          x: arg.x,
          y: 50,
          text: arg.prepared ? "+150" : "+100"
        }]);
        
        setTimeout(() => {
          setParticles(prev => prev.slice(-10));
        }, 600);
      }, []);
      
      // Handle judge decision
      const makeFinalArgument = useCallback((argType) => {
        setSelectedFinal(argType);
        
        const won = argType === judge.winningArg;
        
        setTimeout(() => {
          setResult({
            won,
            reason: won ? judge.winReason : judge.loseReason,
          });
          setGameState('result');
        }, 1000);
      }, [judge]);
      
      // Render start screen
      if (gameState === 'start') {
        return (
          <div className="start-screen">
            <div className="start-world">WORLD 3</div>
            <div className="start-title">Laozi's Valley</div>
            <div className="start-desc">
              <em>"The wise yield like water, yet water carves stone."</em>
              <br /><br />
              Complete this debate round to learn <strong>THE TURN</strong>‚Äî
              the art of redirecting your opponent's strength against them.
            </div>
            
            <div className="start-phases">
              <div className="start-phase">
                <div className="start-phase-num">PHASE 1</div>
                <div className="start-phase-name">The Flow</div>
              </div>
              <div className="start-phase">
                <div className="start-phase-num">PHASE 2</div>
                <div className="start-phase-name">The Clash</div>
              </div>
              <div className="start-phase">
                <div className="start-phase-num">PHASE 3</div>
                <div className="start-phase-name">The Judge</div>
              </div>
            </div>
            
            <button className="begin-btn" onClick={startRound}>
              BEGIN ROUND
            </button>
          </div>
        );
      }
      
      // Render transition
      if (gameState === 'transition') {
        return (
          <div className="phase-transition">
            <div className="transition-text">{transitionText}</div>
          </div>
        );
      }
      
      // Render result
      if (gameState === 'result') {
        return (
          <div className="result-overlay">
            <div className="result-ballot">THE BALLOT</div>
            <div className={`result-verdict ${result.won ? 'victory' : 'defeat'}`}>
              {result.won ? 'AFFIRMATIVE' : 'NEGATIVE'}
            </div>
            
            <div className="result-reason">
              {judge.name} speaks: <em>"{result.reason}"</em>
            </div>
            
            {result.won && (
              <div className="unlock-box">
                <div className="unlock-label">NEW TECHNIQUE LEARNED</div>
                <div className="unlock-name">THE TURN</div>
                <div className="unlock-desc">Redirect opponent's arguments back at them</div>
              </div>
            )}
            
            <button className="continue-btn" onClick={() => setGameState('start')}>
              {result.won ? 'CONTINUE' : 'TRY AGAIN'}
            </button>
          </div>
        );
      }
      
      return (
        <div className="game-container">
          {/* Phase banner */}
          <div className="phase-banner">
            <div>
              <div className="phase-indicator">
                <div className={`phase-dot ${phase >= 0 ? (phase === 0 ? 'active' : 'complete') : ''}`} />
                <div className={`phase-dot ${phase >= 1 ? (phase === 1 ? 'active' : 'complete') : ''}`} />
                <div className={`phase-dot ${phase >= 2 ? 'active' : ''}`} />
              </div>
              <div className="phase-name">
                {phase === 0 && 'THE FLOW'}
                {phase === 1 && 'THE CLASH'}
                {phase === 2 && 'THE JUDGE'}
              </div>
            </div>
            <div className="round-info">
              LAOZI'S VALLEY<br />
              Round 1
            </div>
          </div>
          
          {/* Coherence bar */}
          <div className="coherence-display">
            <div className="coherence-label">COHERENCE</div>
            <div className="coherence-bar">
              <div 
                className={`coherence-fill ${coherence < 30 ? 'low' : ''}`}
                style={{ width: `${coherence}%` }}
              />
            </div>
          </div>
          
          {/* PHASE 1: THE FLOW */}
          {gameState === 'flow' && (
            <div className="flow-phase">
              <div className="flow-title">Prepare Your Responses</div>
              <div className="flow-subtitle">Study their case. Assign your strategy.</div>
              
              <div className="flow-columns">
                <div className="flow-column">
                  <div className="flow-column-header opponent-header">THEIR CASE</div>
                  {OPPONENT_CASE.map(arg => (
                    <div 
                      key={arg.id}
                      className={`argument-item ${selectedArg === arg.id ? 'selected' : ''} ${assignments[arg.id] ? 'assigned' : ''}`}
                      onClick={() => !assignments[arg.id] && setSelectedArg(arg.id)}
                    >
                      <div className="arg-label">{arg.label}</div>
                      <div className="arg-text">{arg.text}</div>
                      {assignments[arg.id] && (
                        <div className="arg-response">
                          ‚úì {RESPONSES.find(r => r.id === assignments[arg.id])?.name}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                
                <div className="flow-column">
                  <div className="flow-column-header response-header">YOUR STRATEGY</div>
                  {Object.entries(assignments).map(([argId, respId]) => {
                    const arg = OPPONENT_CASE.find(a => a.id === parseInt(argId));
                    const resp = RESPONSES.find(r => r.id === respId);
                    return (
                      <div key={argId} className="argument-item assigned">
                        <div className="arg-label">{resp?.icon} {resp?.name}</div>
                        <div className="arg-text">‚Üí {arg?.label}</div>
                      </div>
                    );
                  })}
                  {Object.keys(assignments).length === 0 && (
                    <div style={{color: 'var(--text-mid)', fontStyle: 'italic', textAlign: 'center', padding: '20px'}}>
                      Select an argument, then choose a response...
                    </div>
                  )}
                </div>
              </div>
              
              <div className="response-panel">
                <div className="response-panel-title">
                  {selectedArg 
                    ? `RESPONDING TO: ${OPPONENT_CASE.find(a => a.id === selectedArg)?.label}`
                    : 'SELECT AN ARGUMENT TO RESPOND'
                  }
                </div>
                <div className="response-buttons">
                  {RESPONSES.map(resp => (
                    <button 
                      key={resp.id}
                      className="response-btn"
                      disabled={!selectedArg}
                      onClick={() => assignResponse(resp.id)}
                    >
                      <span className="btn-icon">{resp.icon}</span>
                      {resp.name}
                    </button>
                  ))}
                </div>
              </div>
              
              <button 
                className="ready-btn"
                disabled={!allAssigned}
                onClick={startBattle}
              >
                {allAssigned ? 'BEGIN SPEECHES ‚Üí' : `ASSIGN ALL RESPONSES (${Object.keys(assignments).length}/3)`}
              </button>
            </div>
          )}
          
          {/* PHASE 2: BATTLE */}
          {gameState === 'battle' && (
            <div className="battle-phase">
              <div className="battle-hud">
                <div className="combo-display">{combo}x COMBO</div>
                <div className={`timer-display ${battleTimer < 10 ? 'urgent' : ''}`}>
                  {battleTimer}s
                </div>
              </div>
              
              <div className="battle-area">
                {battleArgs.map(arg => (
                  <div
                    key={arg.id}
                    className={`battle-argument ${arg.prepared ? 'prepared' : ''}`}
                    style={{
                      left: `${arg.x}%`,
                      top: `${(arg.progress || 0) * 100}%`,
                      transform: 'translate(-50%, 0)',
                    }}
                    onClick={() => handleTapArg(arg)}
                  >
                    {arg.text}
                  </div>
                ))}
                
                {particles.map(p => (
                  <div
                    key={p.id}
                    className="particle"
                    style={{ left: `${p.x}%`, top: `${p.y}%` }}
                  >
                    {p.text}
                  </div>
                ))}
              </div>
              
              <div className="battle-response-zone">
                <div className="danger-line" />
                <div className="battle-buttons">
                  <button className="battle-btn answer">‚öîÔ∏è ANSWER</button>
                  <button className="battle-btn turn">üîÑ TURN</button>
                  <button className="battle-btn question">‚ùì QUESTION</button>
                </div>
              </div>
              
              {dropFlash && <div className="drop-flash" />}
            </div>
          )}
          
          {/* PHASE 3: JUDGE */}
          {gameState === 'judge' && judge && (
            <div className="judge-phase">
              <div className="judge-portrait">{judge.emoji}</div>
              <div className="judge-name">{judge.name}</div>
              <div className="judge-paradigm">Paradigm: {judge.paradigm}</div>
              
              <div className="judge-speech">"{judge.speech}"</div>
              
              <div className="judge-tells">
                {judge.tells.map((tell, i) => (
                  <div key={i} className="judge-tell">üí° {tell}</div>
                ))}
              </div>
              
              <div style={{fontFamily: 'Cinzel', fontSize: '12px', color: 'var(--text-mid)', textAlign: 'center', marginBottom: '15px', letterSpacing: '2px'}}>
                MAKE YOUR CLOSING ARGUMENT
              </div>
              
              <div className="final-arguments">
                <button 
                  className="final-arg-btn"
                  onClick={() => makeFinalArgument('impact')}
                >
                  <div className="arg-type">IMPACT CALCULUS</div>
                  "Our impacts outweigh‚Äîscope, magnitude, and probability all favor the affirmative."
                </button>
                
                <button 
                  className="final-arg-btn"
                  onClick={() => makeFinalArgument('solvency')}
                >
                  <div className="arg-type">SOLVENCY EXTENSION</div>
                  "Extend our solvency evidence‚Äîthey never answered the mechanism."
                </button>
                
                <button 
                  className="final-arg-btn"
                  onClick={() => makeFinalArgument('framework')}
                >
                  <div className="arg-type">FRAMEWORK</div>
                  "Before you evaluate impacts, consider the ethical framework we've established."
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }
    
    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DebateRound />);
  </script>
</body>
</html>
