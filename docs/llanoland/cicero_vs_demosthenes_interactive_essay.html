<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cicero ↔ Demosthenes — The Audience vs The Tournament</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0A1024;
      --ink:#EAF0FF;
      --muted:#A6B0D6;
      --glass: rgba(255,255,255,0.06);
      --glass2: rgba(255,255,255,0.10);
      --stroke: rgba(255,255,255,0.14);
      --shadow: 0 18px 80px rgba(0,0,0,0.55);
      --accentA:#8B5CF6;
      --accentB:#22D3EE;
      --accentC:#34D399;
      --warn:#FBBF24;
      --danger:#FB7185;
    }

    html, body { height: 100%; background: radial-gradient(1200px 700px at 10% 10%, #111a3b 0%, var(--bg0) 45%, #05060B 100%); color: var(--ink); }

    .noise::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:0.06;
      mix-blend-mode:overlay;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="280" height="280"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch"/></filter><rect width="280" height="280" filter="url(%23n)" opacity="0.45"/></svg>');
      background-size:280px 280px;
    }

    .gridbg{
      background:
        radial-gradient(600px 300px at 70% 20%, rgba(34,211,238,0.13) 0%, rgba(34,211,238,0.00) 60%),
        radial-gradient(720px 420px at 20% 75%, rgba(139,92,246,0.18) 0%, rgba(139,92,246,0.00) 60%),
        linear-gradient(to bottom, rgba(255,255,255,0.04), rgba(255,255,255,0.00) 40%);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.04) 100%);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: var(--shadow);
      border-radius: 18px;
      backdrop-filter: blur(12px);
    }

    .chip{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      padding: 0.35rem 0.6rem;
    }

    .btn{
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      border-radius: 999px;
    }
    .btn:hover{ background: rgba(255,255,255,0.10); transform: translateY(-1px); border-color: rgba(255,255,255,0.22); }
    .btn:active{ transform: translateY(0px) scale(0.99); }

    .btnSolid{
      background: linear-gradient(90deg, rgba(139,92,246,0.88), rgba(34,211,238,0.88));
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 10px 40px rgba(34,211,238,0.14);
    }
    .btnSolid:hover{ filter: brightness(1.06); transform: translateY(-1px); }

    .focusRing:focus{ outline: none; box-shadow: 0 0 0 3px rgba(34,211,238,0.25); }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .gradientText{
      background: linear-gradient(90deg, #EAF0FF 0%, rgba(34,211,238,0.92) 35%, rgba(139,92,246,0.92) 70%, #EAF0FF 100%);
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }

    .ringPulse{
      position: relative;
    }
    .ringPulse::after{
      content:"";
      position:absolute;
      inset:-8px;
      border-radius: 999px;
      border:1px solid rgba(34,211,238,0.22);
      opacity: 0;
      transform: scale(0.98);
      animation: pulse 2.2s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes pulse{
      0%{ opacity:0; transform: scale(0.98); }
      20%{ opacity:0.65; }
      55%{ opacity:0.0; transform: scale(1.08); }
      100%{ opacity:0; transform: scale(1.08); }
    }

    input[type="range"]{
      -webkit-appearance:none;
      appearance:none;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(139,92,246,0.90), rgba(34,211,238,0.90));
      outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      appearance:none;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.35);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    input[type="range"]::-moz-range-thumb{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.35);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .kbd{
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      border-bottom-color: rgba(255,255,255,0.10);
      border-right-color: rgba(255,255,255,0.10);
      padding: 0.15rem 0.45rem;
      border-radius: 8px;
      font-size: 0.75rem;
    }

    .spark{
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, rgba(255,255,255,0.00) 55%),
                  linear-gradient(135deg, rgba(34,211,238,0.18), rgba(139,92,246,0.18));
      border:1px solid rgba(255,255,255,0.12);
    }

    .tooltip{
      position:absolute;
      z-index: 50;
      transform: translate(-50%, -110%);
      pointer-events:none;
      opacity:0;
      transition: opacity .12s ease, transform .12s ease;
    }
    .tooltip.show{ opacity:1; transform: translate(-50%, -125%); }

    .squish{ transform: translateZ(0); }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .ringPulse::after { animation: none; }
      .btn { transition: none; }
    }
  </style>
</head>
<body class="noise">
  <div class="min-h-screen">

    <!-- Header -->
    <header class="relative overflow-hidden">
      <div class="absolute inset-0 gridbg"></div>
      <div class="absolute inset-0 opacity-70">
        <img
          class="w-full h-full object-cover"
          src="/gen?prompt=minimalist%20editorial%20illustration%2C%20ancient%20Greek%20amphitheater%20morphing%20into%20a%20sterile%20empty%20classroom%2C%20soft%20neon%20cyan%20and%20violet%20rim%20lighting%2C%20subtle%20grain%2C%20high%20contrast%2C%20clean%20geometric%20shapes%2C%20no%20text&aspect=16:9"
          alt="Amphitheater morphing into classroom"
        />
      </div>
      <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/50 to-[#070A12]"></div>

      <div class="relative mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 pt-10 pb-8">
        <div class="flex flex-col gap-6">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-2xl spark"></div>
              <div>
                <div class="text-xs text-[color:var(--muted)]">Interactive visual essay</div>
                <div class="text-sm font-semibold tracking-wide">Audience ↔ Tournament</div>
              </div>
            </div>

            <div class="flex items-center gap-2">
              <a class="btn px-4 py-2 text-sm focusRing" target="_blank" href="https://www.youtube.com/watch?v=GDFrSadZ-pY" rel="noreferrer">
                Watch episode
              </a>
              <button id="btnFocus" class="btn btnSolid px-4 py-2 text-sm font-semibold focusRing ringPulse" type="button">
                Jump to the “march”
              </button>
            </div>
          </div>

          <div class="grid lg:grid-cols-12 gap-6 items-end">
            <div class="lg:col-span-8">
              <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight">
                <span class="gradientText">Cicero</span>
                <span class="text-white/70"> ↔ </span>
                <span class="gradientText">Demosthenes</span>
                <span class="text-white/70">:</span>
                <span class="block mt-2">When speech wins applause…</span>
                <span class="block">and when speech moves feet.</span>
              </h1>
              <p class="mt-4 text-base sm:text-lg text-white/75 max-w-2xl">
                Slide between admiration and action. Watch debate drift from public audience to tournament monoculture.
              </p>
            </div>

            <div class="lg:col-span-4">
              <div class="card p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-white/60">Lens</div>
                    <div class="font-semibold">Oratory vs. Mobilization</div>
                  </div>
                  <div class="flex -space-x-2">
                    <img class="w-11 h-11 rounded-full object-cover border border-white/15" src="/image?query=Cicero%20Roman%20orator%20portrait" alt="Cicero portrait thumbnail" />
                    <img class="w-11 h-11 rounded-full object-cover border border-white/15" src="/image?query=Demosthenes%20Greek%20orator%20statue" alt="Demosthenes statue thumbnail" />
                  </div>
                </div>

                <div class="mt-3 flex flex-wrap gap-2">
                  <span class="chip text-xs text-white/75">public audience</span>
                  <span class="chip text-xs text-white/75">mimesis</span>
                  <span class="chip text-xs text-white/75">tournament logic</span>
                  <span class="chip text-xs text-white/75">model collapse</span>
                </div>

                <div class="mt-4 text-xs text-white/60">
                  Controls: <span class="kbd">Tab</span> focus • <span class="kbd">←</span>/<span class="kbd">→</span> tweak sliders
                </div>
              </div>
            </div>
          </div>

          <nav class="mt-2 flex flex-wrap gap-2">
            <button data-jump="#scene1" class="btn px-3 py-2 text-sm focusRing">1) Cicero↔Demosthenes</button>
            <button data-jump="#scene2" class="btn px-3 py-2 text-sm focusRing">2) Debate ecology</button>
            <button data-jump="#scene3" class="btn px-3 py-2 text-sm focusRing">3) Optimize for who?</button>
            <button data-jump="#scene4" class="btn px-3 py-2 text-sm focusRing">4) Mimesis collapse</button>
            <button data-jump="#scene5" class="btn px-3 py-2 text-sm focusRing">5) Build a public format</button>
          </nav>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 pb-14">

      <!-- Scene 1 -->
      <section id="scene1" class="mt-8">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-wrap items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/60">Scene 1</div>
              <h2 class="text-2xl sm:text-3xl font-bold">Make it impressive… or make it move.</h2>
            </div>
            <div class="flex items-center gap-2">
              <span class="chip text-xs text-white/70">live typography</span>
              <span class="chip text-xs text-white/70">crowd motion</span>
            </div>
          </div>

          <div class="mt-5 grid lg:grid-cols-12 gap-6">
            <div class="lg:col-span-7">
              <div class="flex items-center justify-between">
                <div class="text-sm text-white/70">Admiration</div>
                <div class="text-sm text-white/70">Action</div>
              </div>
              <input id="speechSlider" class="w-full mt-2 focusRing" type="range" min="0" max="100" value="35" />

              <div class="mt-5 rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-5">
                <div class="flex items-center justify-between gap-3">
                  <div class="text-xs text-white/60">Same claim, different delivery</div>
                  <div id="speechTag" class="chip text-xs text-white/75">leaning Cicero</div>
                </div>
                <div id="speechText" class="mt-3 text-lg sm:text-xl leading-snug font-semibold"></div>

                <div class="mt-4 grid sm:grid-cols-2 gap-3">
                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Audience reaction</div>
                    <div class="mt-2 flex items-center gap-3">
                      <div class="w-full h-2 rounded-full bg-white/10 overflow-hidden">
                        <div id="applauseBar" class="h-full rounded-full" style="width: 45%; background: linear-gradient(90deg, rgba(139,92,246,0.95), rgba(34,211,238,0.95));"></div>
                      </div>
                      <div id="applauseLabel" class="text-sm font-semibold">Applause</div>
                    </div>
                  </div>

                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Outcome</div>
                    <div id="outcome" class="mt-2 text-sm text-white/80"></div>
                  </div>
                </div>
              </div>

              <div class="mt-4 flex flex-wrap gap-2">
                <button id="btnAdmire" class="btn px-3 py-2 text-sm focusRing" type="button">Snap to admiration</button>
                <button id="btnAct" class="btn px-3 py-2 text-sm focusRing" type="button">Snap to action</button>
                <button id="btnSpeak" class="btn btnSolid px-3 py-2 text-sm font-semibold focusRing" type="button">Read it aloud</button>
              </div>
              <div class="mt-2 text-xs text-white/55">Uses your device’s speech synthesis (if available). No audio is stored.</div>
            </div>

            <div class="lg:col-span-5">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-white/60">Crowd</div>
                    <div class="font-semibold">From claps to footsteps</div>
                  </div>
                  <div id="marchBadge" class="chip text-xs text-white/75">still seated</div>
                </div>
                <canvas id="crowdCanvas" class="mt-3 w-full rounded-xl border border-white/10 bg-black/30" width="560" height="260" aria-label="Crowd motion visualization" role="img"></canvas>
                <div class="mt-3 grid grid-cols-3 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Clarity</div>
                    <div id="metricClarity" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Energy</div>
                    <div id="metricEnergy" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Commitment</div>
                    <div id="metricCommit" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                </div>
              </div>

              <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="text-xs text-white/60">A screen-shot line</div>
                <div id="quoteCard1" class="mt-2 text-base sm:text-lg font-semibold leading-snug">“If your speech only earns compliments, you built a mirror. If it earns movement, you built a door.”</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Scene 2 -->
      <section id="scene2" class="mt-8">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-wrap items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/60">Scene 2</div>
              <h2 class="text-2xl sm:text-3xl font-bold">Debate’s ecology: many formats → one monoculture.</h2>
            </div>
            <div class="flex items-center gap-2">
              <span class="chip text-xs text-white/70">scrubbable timeline</span>
              <span class="chip text-xs text-white/70">click for tradeoffs</span>
            </div>
          </div>

          <div class="mt-5 grid lg:grid-cols-12 gap-6">
            <div class="lg:col-span-8">
              <div class="flex items-center justify-between">
                <div class="text-sm text-white/70">Year</div>
                <div class="text-sm font-semibold"><span id="yearLabel">1900</span></div>
              </div>
              <input id="yearSlider" class="w-full mt-2 focusRing" type="range" min="1700" max="2025" value="1900" step="1" />

              <div class="mt-4 rounded-2xl border border-white/10 bg-black/30 p-4">
                <svg id="timelineSvg" class="w-full h-[290px]" viewBox="0 0 860 290" role="img" aria-label="Timeline of debate formats"></svg>
                <div class="mt-3 flex flex-wrap gap-2">
                  <span class="chip text-xs text-white/70">bubble size = conceptual prevalence</span>
                  <span class="chip text-xs text-white/70">ring = audience centrality</span>
                  <span class="chip text-xs text-white/70">click bubbles</span>
                </div>
              </div>
            </div>

            <div class="lg:col-span-4">
              <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Selected</div>
                    <div id="formatTitle" class="text-lg font-semibold">—</div>
                  </div>
                  <div id="formatChips" class="flex flex-wrap gap-1 justify-end"></div>
                </div>
                <div id="formatDesc" class="mt-3 text-sm text-white/75 leading-relaxed">Click a bubble to see what it optimized for.</div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Audience</div>
                    <div id="formatAudience" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Throughput</div>
                    <div id="formatThroughput" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                </div>
              </div>

              <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="text-xs text-white/60">Screen-shot line</div>
                <div class="mt-2 text-base sm:text-lg font-semibold leading-snug">“When a format becomes the whole sport, it starts eating the skill it was meant to teach.”</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Scene 3 -->
      <section id="scene3" class="mt-8">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-wrap items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/60">Scene 3</div>
              <h2 class="text-2xl sm:text-3xl font-bold">Optimize for the judge… or for the crowd?</h2>
            </div>
            <div class="flex items-center gap-2">
              <span class="chip text-xs text-white/70">live argument morph</span>
              <span class="chip text-xs text-white/70">comprehension meters</span>
            </div>
          </div>

          <div class="mt-5 grid lg:grid-cols-12 gap-6">
            <div class="lg:col-span-5">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Target</div>
                    <div class="font-semibold">Choose the optimization loop</div>
                  </div>
                  <div class="flex gap-2">
                    <button id="modeAudience" class="btn btnSolid px-3 py-2 text-sm font-semibold focusRing" type="button">Audience</button>
                    <button id="modeJudge" class="btn px-3 py-2 text-sm focusRing" type="button">Judge</button>
                  </div>
                </div>

                <div class="mt-4">
                  <div class="flex items-center justify-between">
                    <div class="text-sm text-white/70">Complexity</div>
                    <div class="text-sm font-semibold"><span id="complexityLabel">55</span>/100</div>
                  </div>
                  <input id="complexity" class="w-full mt-2 focusRing" type="range" min="0" max="100" value="55" />
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Public comprehension</div>
                    <div class="mt-2 w-full h-2 rounded-full bg-white/10 overflow-hidden">
                      <div id="meterPublic" class="h-full rounded-full" style="width:60%; background: linear-gradient(90deg, rgba(52,211,153,0.95), rgba(34,211,238,0.95));"></div>
                    </div>
                    <div id="meterPublicLabel" class="mt-2 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Judge satisfaction</div>
                    <div class="mt-2 w-full h-2 rounded-full bg-white/10 overflow-hidden">
                      <div id="meterJudge" class="h-full rounded-full" style="width:55%; background: linear-gradient(90deg, rgba(139,92,246,0.95), rgba(251,191,36,0.95));"></div>
                    </div>
                    <div id="meterJudgeLabel" class="mt-2 text-sm font-semibold">—</div>
                  </div>
                </div>

                <div class="mt-4 text-xs text-white/60">Tip: Flip targets and watch the same claim become two different species of argument.</div>
              </div>

              <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="text-xs text-white/60">Screen-shot line</div>
                <div class="mt-2 text-base sm:text-lg font-semibold leading-snug">“Judge-facing speech is a local optimum. Public persuasion is a different landscape.”</div>
              </div>
            </div>

            <div class="lg:col-span-7">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4 sm:p-5">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Argument (live)</div>
                    <div id="argTag" class="mt-1 chip text-xs text-white/75 inline-flex">Audience mode</div>
                  </div>
                  <div class="text-xs text-white/55">Generated from the same core claim</div>
                </div>

                <div id="argBox" class="mt-3 text-base sm:text-lg leading-relaxed"></div>

                <div class="mt-5 grid sm:grid-cols-3 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Jargon density</div>
                    <div id="jargon" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Narrative</div>
                    <div id="narrative" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Clash</div>
                    <div id="clash" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Scene 4 -->
      <section id="scene4" class="mt-8">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-wrap items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/60">Scene 4</div>
              <h2 class="text-2xl sm:text-3xl font-bold">Closed-loop mimesis → argument “model collapse.”</h2>
            </div>
            <div class="flex items-center gap-2">
              <span class="chip text-xs text-white/70">evolution sim</span>
              <span class="chip text-xs text-white/70">entropy graph</span>
            </div>
          </div>

          <div class="mt-5 grid lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Selection pressure</div>
                    <div class="font-semibold">Who decides the winners?</div>
                  </div>
                </div>

                <div class="mt-4">
                  <div class="flex items-center justify-between">
                    <div class="text-sm text-white/70">Audience pressure</div>
                    <div class="text-sm font-semibold"><span id="audPressureLabel">35</span>/100</div>
                  </div>
                  <input id="audPressure" class="w-full mt-2 focusRing" type="range" min="0" max="100" value="35" />
                </div>

                <div class="mt-4 flex flex-wrap gap-2">
                  <button id="stepGen" class="btn btnSolid px-3 py-2 text-sm font-semibold focusRing" type="button">Run 1 generation</button>
                  <button id="autoGen" class="btn px-3 py-2 text-sm focusRing" type="button">Auto: off</button>
                  <button id="resetGen" class="btn px-3 py-2 text-sm focusRing" type="button">Reset</button>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Generation</div>
                    <div id="genLabel" class="mt-1 text-sm font-semibold">0</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Public clarity</div>
                    <div id="clarityLabel" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Diversity</div>
                    <div id="divLabel" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Insider-ness</div>
                    <div id="insiderLabel" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                </div>

                <div class="mt-4 text-xs text-white/60">
                  If you only copy winners inside a closed circuit, language compresses into shorthand.
                </div>
              </div>

              <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="text-xs text-white/60">Screen-shot line</div>
                <div class="mt-2 text-base sm:text-lg font-semibold leading-snug">“A closed loop of imitation doesn’t preserve persuasion — it distills it into code.”</div>
              </div>
            </div>

            <div class="lg:col-span-8">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Population</div>
                    <div class="font-semibold">Argument specimens</div>
                  </div>
                  <div class="text-xs text-white/55">Each card has traits: clarity / jargon / novelty</div>
                </div>

                <div class="mt-3 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2" id="popGrid" aria-label="Argument population grid"></div>

                <div class="mt-4 grid sm:grid-cols-2 gap-3">
                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Entropy (diversity)</div>
                    <canvas id="entropyCanvas" class="mt-2 w-full rounded-lg border border-white/10 bg-black/30" width="760" height="160" aria-label="Entropy graph" role="img"></canvas>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-black/30 p-3">
                    <div class="text-xs text-white/60">Public comprehension</div>
                    <canvas id="compCanvas" class="mt-2 w-full rounded-lg border border-white/10 bg-black/30" width="760" height="160" aria-label="Comprehension graph" role="img"></canvas>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- Scene 5 -->
      <section id="scene5" class="mt-8">
        <div class="card p-5 sm:p-6">
          <div class="flex flex-wrap items-end justify-between gap-3">
            <div>
              <div class="text-xs text-white/60">Scene 5</div>
              <h2 class="text-2xl sm:text-3xl font-bold">Design a modern public debate: a “contract” you can share.</h2>
            </div>
            <div class="flex items-center gap-2">
              <span class="chip text-xs text-white/70">format builder</span>
              <span class="chip text-xs text-white/70">shareable hash</span>
            </div>
          </div>

          <div class="mt-5 grid lg:grid-cols-12 gap-6">
            <div class="lg:col-span-6">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4 sm:p-5">
                <div class="text-xs text-white/60">Choose the contract</div>

                <div class="mt-4 grid sm:grid-cols-2 gap-3">
                  <div>
                    <label class="text-sm text-white/70">Audience type</label>
                    <select id="audType" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="community">Community audience</option>
                      <option value="civic">Civic stakeholders</option>
                      <option value="students">Students + families</option>
                      <option value="online">Online public stream</option>
                    </select>
                  </div>
                  <div>
                    <label class="text-sm text-white/70">Venue</label>
                    <select id="venue" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="auditorium">Auditorium</option>
                      <option value="townhall">Town hall</option>
                      <option value="library">Library forum</option>
                      <option value="campus">Campus theater</option>
                    </select>
                  </div>

                  <div>
                    <label class="text-sm text-white/70">Decision rule</label>
                    <select id="judgeRule" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="public">Public vote</option>
                      <option value="hybrid">Hybrid: public + expert</option>
                      <option value="expert">Expert panel</option>
                    </select>
                  </div>

                  <div>
                    <label class="text-sm text-white/70">Reward</label>
                    <select id="reward" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="civic">Civic impact pledge</option>
                      <option value="publication">Publication + replay</option>
                      <option value="scholarship">Scholarship pool</option>
                      <option value="trophy">Trophy</option>
                    </select>
                  </div>

                  <div>
                    <label class="text-sm text-white/70">Evidence norms</label>
                    <select id="evidence" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="public">Publicly legible citations</option>
                      <option value="mixed">Mixed: expert appendix</option>
                      <option value="strict">Strict technical standard</option>
                    </select>
                  </div>

                  <div>
                    <label class="text-sm text-white/70">Format length</label>
                    <select id="length" class="mt-2 w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white focusRing">
                      <option value="short">Short (high reach)</option>
                      <option value="medium" selected>Medium (balanced)</option>
                      <option value="long">Long (deep)</option>
                    </select>
                  </div>
                </div>

                <div class="mt-4">
                  <div class="flex items-center justify-between">
                    <div class="text-sm text-white/70">Audience centrality</div>
                    <div class="text-sm font-semibold"><span id="audCentLabel">70</span>/100</div>
                  </div>
                  <input id="audCent" class="w-full mt-2 focusRing" type="range" min="0" max="100" value="70" />
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Public persuasion</div>
                    <div class="mt-2 w-full h-2 rounded-full bg-white/10 overflow-hidden">
                      <div id="scorePers" class="h-full rounded-full" style="width:70%; background: linear-gradient(90deg, rgba(52,211,153,0.95), rgba(34,211,238,0.95));"></div>
                    </div>
                    <div id="scorePersLabel" class="mt-2 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Pedagogy</div>
                    <div class="mt-2 w-full h-2 rounded-full bg-white/10 overflow-hidden">
                      <div id="scorePed" class="h-full rounded-full" style="width:65%; background: linear-gradient(90deg, rgba(139,92,246,0.95), rgba(34,211,238,0.95));"></div>
                    </div>
                    <div id="scorePedLabel" class="mt-2 text-sm font-semibold">—</div>
                  </div>
                </div>

                <div class="mt-4 flex flex-wrap gap-2">
                  <button id="btnShare" class="btn btnSolid px-3 py-2 text-sm font-semibold focusRing" type="button">Copy share link</button>
                  <button id="btnRandomize" class="btn px-3 py-2 text-sm focusRing" type="button">Remix</button>
                </div>
                <div id="shareStatus" class="mt-2 text-xs text-white/60"></div>
              </div>
            </div>

            <div class="lg:col-span-6">
              <div class="rounded-2xl border border-white/10 bg-black/30 p-4 sm:p-5">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <div class="text-xs text-white/60">Your format card</div>
                    <div id="formatName" class="text-xl font-extrabold">The Public Contract</div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-white/60">Hash</div>
                    <div id="formatHash" class="mono text-sm font-semibold text-white/85">—</div>
                  </div>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Audience</div>
                    <div id="cardAudience" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Venue</div>
                    <div id="cardVenue" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Decision</div>
                    <div id="cardDecision" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                  <div class="rounded-xl border border-white/10 bg-white/5 p-3">
                    <div class="text-xs text-white/60">Reward</div>
                    <div id="cardReward" class="mt-1 text-sm font-semibold">—</div>
                  </div>
                </div>

                <div class="mt-4 rounded-xl border border-white/10 bg-white/5 p-4">
                  <div class="text-xs text-white/60">Contract clause</div>
                  <div id="clause" class="mt-2 text-base sm:text-lg font-semibold leading-snug">—</div>
                </div>

                <div class="mt-4 rounded-xl border border-white/10 bg-white/5 p-4" id="marchMoment">
                  <div class="flex items-start justify-between gap-3">
                    <div>
                      <div class="text-xs text-white/60">Demosthenes moment</div>
                      <div class="text-lg font-bold">Does your format produce movement?</div>
                    </div>
                    <div id="marchScore" class="chip text-xs text-white/80">—</div>
                  </div>
                  <div class="mt-3">
                    <canvas id="marchCanvas" class="w-full rounded-xl border border-white/10 bg-black/30" width="760" height="220" aria-label="March momentum visualization" role="img"></canvas>
                  </div>
                </div>

                <div class="mt-4 flex flex-wrap gap-2">
                  <a class="btn px-3 py-2 text-sm focusRing" target="_blank" rel="noreferrer" href="https://www.youtube.com/watch?v=GDFrSadZ-pY">Open episode</a>
                  <button id="btnTop" class="btn px-3 py-2 text-sm focusRing" type="button">Back to top</button>
                </div>
              </div>

              <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
                <div class="text-xs text-white/60">One-liner</div>
                <div class="mt-2 text-base sm:text-lg font-semibold leading-snug">“Bring back the audience, and debate remembers what it was for.”</div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <footer class="mt-10 text-xs text-white/55">
        <div class="card p-4">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div>
              Built as an interactive lens on the episode’s themes: audience-centered debate, tournament monoculture, and closed-loop mimesis.
            </div>
            <div class="text-white/60">
              Keyboard-friendly • No local storage • Single-file
            </div>
          </div>
        </div>
      </footer>

    </main>
  </div>

  <script>
    (function(){
      "use strict";

      // ---------- Utilities ----------
      function clamp01(x){ return Math.max(0, Math.min(1, x)); }
      function lerp(a,b,t){ return a + (b-a)*t; }
      function fmtPct(x){ return Math.round(x) + "%"; }
      function smoothstep(t){ t = clamp01(t); return t*t*(3 - 2*t); }

      // Deterministic RNG (no storage, no external calls)
      function mulberry32(seed){
        return function(){
          let t = seed += 0x6D2B79F5;
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }

      function textToHash(str){
        // FNV-1a 32-bit
        let h = 0x811c9dc5;
        for (let i=0;i<str.length;i++){
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 0x01000193);
        }
        // base36 compact
        return (h >>> 0).toString(36).padStart(7,'0');
      }

      function setWidth(el, pct){ el.style.width = fmtPct(pct); }

      // ---------- Navigation ----------
      document.querySelectorAll('[data-jump]').forEach(btn => {
        btn.addEventListener('click', () => {
          const sel = btn.getAttribute('data-jump');
          const target = document.querySelector(sel);
          if(target) target.scrollIntoView({behavior:'smooth', block:'start'});
        });
      });
      const btnTop = document.getElementById('btnTop');
      if(btnTop){ btnTop.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'})); }

      const btnFocus = document.getElementById('btnFocus');
      if(btnFocus){
        btnFocus.addEventListener('click', ()=>{
          const el = document.getElementById('marchMoment');
          if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
        });
      }

      // ---------- Scene 1: Speech slider ----------
      const speechSlider = document.getElementById('speechSlider');
      const speechText = document.getElementById('speechText');
      const speechTag = document.getElementById('speechTag');
      const applauseBar = document.getElementById('applauseBar');
      const applauseLabel = document.getElementById('applauseLabel');
      const outcome = document.getElementById('outcome');
      const marchBadge = document.getElementById('marchBadge');
      const metricClarity = document.getElementById('metricClarity');
      const metricEnergy = document.getElementById('metricEnergy');
      const metricCommit = document.getElementById('metricCommit');
      const btnAdmire = document.getElementById('btnAdmire');
      const btnAct = document.getElementById('btnAct');
      const btnSpeak = document.getElementById('btnSpeak');

      const speechA = {
        title: "Cicero-leaning",
        lines: [
          "Citizens, let us consider the argument with care—",
          "and choose the course that best preserves our dignity.",
          "If we speak wisely, the city will remember our reason."
        ],
        emphasis: ["consider", "care", "dignity", "wisely", "reason"],
      };
      const speechB = {
        title: "Demosthenes-leaning",
        lines: [
          "Citizens, the time to decide is now—",
          "stand with each other, and take the street with purpose.",
          "If we speak together, the city will change its course."
        ],
        emphasis: ["now", "stand", "together", "take", "purpose", "change"],
      };

      let speechT = 0.35;

      function renderSpeech(){
        const tRaw = (parseFloat(speechSlider.value) || 0) / 100;
        const t = smoothstep(tRaw);
        speechT = t;

        // Typography morph: crossfade + emphasis blend
        const a = speechA.lines.join(" ");
        const b = speechB.lines.join(" ");

        // Blend by keeping sentence structure stable: show both with opacity
        const wA = clamp01(1 - t*1.05);
        const wB = clamp01(t*1.05);

        const size = lerp(20, 28, t);
        const letter = lerp(0.15, 0.45, t);
        const weight = Math.round(lerp(650, 850, t));

        const tag = t < 0.5 ? "leaning Cicero" : "leaning Demosthenes";
        speechTag.textContent = tag;

        // Bars/labels
        const applause = lerp(65, 35, t);
        const movement = lerp(25, 85, t);
        setWidth(applauseBar, lerp(45, 78, t));
        applauseLabel.textContent = t < 0.52 ? "Applause" : "Footsteps";

        outcome.textContent = t < 0.52
          ? "The room is impressed. People quote you later."
          : "The room shifts. People coordinate and act.";

        marchBadge.textContent = t < 0.58 ? "still seated" : "in motion";

        // Metrics
        const clarity = Math.round(lerp(78, 72, t));
        const energy = Math.round(lerp(44, 92, t));
        const commit = Math.round(lerp(30, 86, t));
        metricClarity.textContent = clarity + "/100";
        metricEnergy.textContent = energy + "/100";
        metricCommit.textContent = commit + "/100";

        // Emphasis mapping
        function emphasize(txt, words, strength){
          let out = txt;
          // escape minimal
          words.forEach((w)=>{
            const re = new RegExp("\\b" + w.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&') + "\\b", "gi");
            out = out.replace(re, (m)=>{
              const glow = lerp(0.0, 0.25, strength);
              const underline = lerp(0.10, 0.40, strength);
              return `<span style="font-weight:${Math.round(lerp(650, 900, strength))}; color: rgba(234,240,255,1); text-shadow: 0 0 ${Math.round(18*glow)}px rgba(34,211,238,${glow}); border-bottom: ${Math.round(2*underline)}px solid rgba(34,211,238,${0.35 + 0.35*strength});">${m}</span>`;
            });
          });
          return out;
        }

        const aHtml = emphasize(a, speechA.emphasis, 1 - t);
        const bHtml = emphasize(b, speechB.emphasis, t);

        speechText.innerHTML = `
          <div style="position:relative">
            <div style="opacity:${wA.toFixed(3)}; position:${wB>0.2?'absolute':'relative'}; inset:0; filter:saturate(${(1.0 - t*0.12).toFixed(3)});">
              ${aHtml}
            </div>
            <div style="opacity:${wB.toFixed(3)}; position:relative; filter:saturate(${(1.0 + t*0.20).toFixed(3)});">
              ${bHtml}
            </div>
          </div>
        `;

        speechText.style.fontSize = size + "px";
        speechText.style.letterSpacing = letter + "px";
        speechText.style.fontWeight = String(weight);
        speechText.style.lineHeight = t < 0.55 ? "1.35" : "1.20";
      }

      if(btnAdmire) btnAdmire.addEventListener('click', ()=>{ speechSlider.value = 10; renderSpeech(); });
      if(btnAct) btnAct.addEventListener('click', ()=>{ speechSlider.value = 90; renderSpeech(); });

      // Speech synthesis
      function speakCurrent(){
        try{
          if(!('speechSynthesis' in window)) return;
          const t = speechT;
          const text = t < 0.5 ? speechA.lines.join(' ') : speechB.lines.join(' ');
          window.speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(text);
          u.rate = lerp(0.95, 1.1, t);
          u.pitch = lerp(0.95, 1.08, t);
          window.speechSynthesis.speak(u);
        }catch(e){ console.error(e); }
      }
      if(btnSpeak) btnSpeak.addEventListener('click', speakCurrent);

      // Crowd canvas
      const crowdCanvas = document.getElementById('crowdCanvas');
      const cctx = crowdCanvas ? crowdCanvas.getContext('2d') : null;
      let crowd = [];
      function initCrowd(){
        if(!crowdCanvas || !cctx) return;
        const w = crowdCanvas.width;
        const h = crowdCanvas.height;
        const rng = mulberry32(12345);
        crowd = [];
        const cols = 34;
        const rows = 16;
        for(let y=0;y<rows;y++){
          for(let x=0;x<cols;x++){
            const px = (x + 0.5) * (w/cols) + (rng()-0.5)*6;
            const py = (y + 0.5) * (h/rows) + (rng()-0.5)*6;
            const r = 2.0 + rng()*2.2;
            crowd.push({x:px, y:py, ox:px, oy:py, r:r, phase:rng()*Math.PI*2, hue: rng()});
          }
        }
      }
      initCrowd();

      let lastTime = performance.now();
      function drawCrowd(tNow){
        if(!crowdCanvas || !cctx) return;
        const dt = Math.min(0.05, (tNow - lastTime)/1000);
        lastTime = tNow;

        const w = crowdCanvas.width;
        const h = crowdCanvas.height;

        const t = speechT;
        const move = smoothstep(Math.max(0, (t - 0.35) / 0.65));

        cctx.clearRect(0,0,w,h);

        // background
        const g = cctx.createLinearGradient(0,0,w,h);
        g.addColorStop(0, 'rgba(139,92,246,0.14)');
        g.addColorStop(0.55, 'rgba(34,211,238,0.10)');
        g.addColorStop(1, 'rgba(0,0,0,0.25)');
        cctx.fillStyle = g;
        cctx.fillRect(0,0,w,h);

        // stage line
        cctx.strokeStyle = 'rgba(255,255,255,0.10)';
        cctx.lineWidth = 1;
        cctx.beginPath();
        cctx.moveTo(24, 26);
        cctx.lineTo(w-24, 26);
        cctx.stroke();

        // motion field: swirl -> flow
        const flowX = lerp(0.0, 70.0, move);
        const wave = 0.8 + 1.8*move;

        for(const p of crowd){
          const jitter = (1 - move) * 9;
          p.phase += dt * lerp(0.8, 2.4, t);
          const jx = Math.cos(p.phase + p.x*0.02) * jitter;
          const jy = Math.sin(p.phase + p.y*0.02) * jitter;

          // marching drift to the right, with lane-based staggering
          const lane = (p.oy / h);
          const stagger = (lane*lane) * 0.6 + p.hue*0.18;
          const mx = flowX * (0.55 + 0.55*stagger) * move;
          const my = Math.sin(p.ox*0.015 + tNow*0.0012 + lane*6) * 6 * move;

          const x = p.ox + jx + mx;
          const y = p.oy + jy + my;

          const r = p.r * lerp(0.95, 1.25, move);

          // glow
          const glowA = lerp(0.06, 0.35, move);
          cctx.fillStyle = `rgba(234,240,255,${0.55 + 0.25*move})`;
          cctx.beginPath();
          cctx.arc(x,y,r,0,Math.PI*2);
          cctx.fill();

          cctx.fillStyle = `rgba(34,211,238,${glowA})`;
          cctx.beginPath();
          cctx.arc(x,y,r*2.1,0,Math.PI*2);
          cctx.fill();

          // footsteps as tiny slashes when moving
          if(move > 0.25 && (p.hue > 0.55)){
            const fx = x - 8 - (p.hue*7);
            const fy = y + 8;
            cctx.strokeStyle = `rgba(251,191,36,${0.12 + 0.22*move})`;
            cctx.lineWidth = 1;
            cctx.beginPath();
            cctx.moveTo(fx, fy);
            cctx.lineTo(fx + 10, fy - 3);
            cctx.stroke();
          }
        }

        // marching arrow
        const arrowA = move;
        if(arrowA > 0.03){
          const ax = lerp(w*0.35, w*0.72, arrowA);
          const ay = 42;
          cctx.strokeStyle = `rgba(34,211,238,${0.22 + 0.35*arrowA})`;
          cctx.lineWidth = 2;
          cctx.beginPath();
          cctx.moveTo(w*0.22, ay);
          cctx.lineTo(ax, ay);
          cctx.stroke();
          cctx.beginPath();
          cctx.moveTo(ax, ay);
          cctx.lineTo(ax-10, ay-6);
          cctx.lineTo(ax-10, ay+6);
          cctx.closePath();
          cctx.fillStyle = `rgba(34,211,238,${0.18 + 0.30*arrowA})`;
          cctx.fill();
        }

        requestAnimationFrame(drawCrowd);
      }

      // Start render loop
      if(crowdCanvas && cctx){ requestAnimationFrame(drawCrowd); }

      if(speechSlider){
        speechSlider.addEventListener('input', renderSpeech);
        renderSpeech();
      }

      // ---------- Scene 2: Timeline ----------
      const timelineData = [
        {
          id: 'mimesis',
          name: 'Mimesis pedagogy',
          year0: 1700,
          year1: 1900,
          peak: 1820,
          audience: 0.75,
          throughput: 0.35,
          tags: ['modeling','speeches'],
          desc: 'Students learned by copying strong forms: model speeches, imitation, repetition. The skill target is delivery to real listeners.'
        },
        {
          id: 'pleabooks',
          name: 'Plea books',
          year0: 1750,
          year1: 1900,
          peak: 1840,
          audience: 0.70,
          throughput: 0.40,
          tags: ['law','templates'],
          desc: 'Legal rhetoric used collections of successful pleas (case-patterns) to model arguments — a pragmatic mimesis library.'
        },
        {
          id: 'columbian',
          name: 'Columbian Orator',
          year0: 1797,
          year1: 1920,
          peak: 1855,
          audience: 0.78,
          throughput: 0.38,
          tags: ['memorize','perform'],
          desc: 'Text-driven performance training: memorize and deliver speeches without recordings; interpret emotion and intensity from print.'
        },
        {
          id: 'logic',
          name: 'Formal logic / disposition',
          year0: 1700,
          year1: 1870,
          peak: 1775,
          audience: 0.35,
          throughput: 0.30,
          tags: ['syllogism','tests'],
          desc: 'Early university debate education tested formal reasoning: syllogisms, Aristotelian structure. Later drifted toward writing assessments.'
        },
        {
          id: 'societies',
          name: 'Literary societies',
          year0: 1820,
          year1: 1910,
          peak: 1870,
          audience: 0.62,
          throughput: 0.45,
          tags: ['student-run','clubs'],
          desc: 'Students organized debates in societies (social infrastructure). Debating was part of civic formation, not just competition.'
        },
        {
          id: 'triangular',
          name: 'Triangular leagues',
          year0: 1890,
          year1: 1935,
          peak: 1915,
          audience: 0.92,
          throughput: 0.35,
          tags: ['public','auditoriums'],
          desc: 'Intercollegiate public debates (e.g., Yale/Harvard/Princeton) as community events — popular audiences, real stakes, real persuasion.'
        },
        {
          id: 'tournament',
          name: 'Tournament model',
          year0: 1923,
          year1: 2025,
          peak: 1970,
          audience: 0.22,
          throughput: 0.92,
          tags: ['brackets','judges'],
          desc: 'Invented to increase “debates per debater” (throughput). Over time it became synonymous with debate itself, centering expert judging over public audiences.'
        },
        {
          id: 'contract',
          name: 'Contract / audience debates',
          year0: 1890,
          year1: 2025,
          peak: 1910,
          audience: 0.86,
          throughput: 0.40,
          tags: ['rules','public'],
          desc: 'Audience-centered formats (including contract debates) treat the public as the primary feedback. They train persuasion, not only adjudication.'
        }
      ];

      const yearSlider = document.getElementById('yearSlider');
      const yearLabel = document.getElementById('yearLabel');
      const timelineSvg = document.getElementById('timelineSvg');
      const formatTitle = document.getElementById('formatTitle');
      const formatDesc = document.getElementById('formatDesc');
      const formatChips = document.getElementById('formatChips');
      const formatAudience = document.getElementById('formatAudience');
      const formatThroughput = document.getElementById('formatThroughput');

      function bubblePrevalence(d, year){
        // Conceptual prevalence curve: gaussian-ish centered at peak, clipped to active years.
        if(year < d.year0 || year > d.year1) return 0;
        const span = Math.max(40, (d.year1 - d.year0) * 0.45);
        const dx = (year - d.peak) / span;
        const v = Math.exp(-dx*dx);
        return v;
      }

      function renderTimeline(){
        try{
          if(!timelineSvg || !yearSlider) return;
          const year = parseInt(yearSlider.value, 10);
          yearLabel.textContent = String(year);

          // Clear
          while(timelineSvg.firstChild) timelineSvg.removeChild(timelineSvg.firstChild);

          const W = 860, H = 290;
          const padL = 40, padR = 26, padT = 24, padB = 42;

          const minY = 1700, maxY = 2025;

          function xFor(y){
            return padL + ( (y - minY) / (maxY - minY) ) * (W - padL - padR);
          }

          // Axis
          const axis = document.createElementNS('http://www.w3.org/2000/svg','path');
          axis.setAttribute('d', `M ${padL} ${H-padB} L ${W-padR} ${H-padB}`);
          axis.setAttribute('stroke', 'rgba(255,255,255,0.18)');
          axis.setAttribute('stroke-width', '1');
          timelineSvg.appendChild(axis);

          // Ticks
          const ticks = [1700,1750,1800,1850,1900,1950,2000,2025];
          ticks.forEach(tk=>{
            const x = xFor(tk);
            const p = document.createElementNS('http://www.w3.org/2000/svg','path');
            p.setAttribute('d', `M ${x} ${H-padB} L ${x} ${H-padB+8}`);
            p.setAttribute('stroke', 'rgba(255,255,255,0.18)');
            p.setAttribute('stroke-width', '1');
            timelineSvg.appendChild(p);

            const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
            txt.setAttribute('x', x);
            txt.setAttribute('y', H-18);
            txt.setAttribute('fill', 'rgba(234,240,255,0.70)');
            txt.setAttribute('font-size', '12');
            txt.setAttribute('text-anchor', 'middle');
            txt.textContent = String(tk);
            timelineSvg.appendChild(txt);
          });

          // Current year marker
          const cx = xFor(year);
          const cyLine = document.createElementNS('http://www.w3.org/2000/svg','path');
          cyLine.setAttribute('d', `M ${cx} ${padT} L ${cx} ${H-padB}`);
          cyLine.setAttribute('stroke', 'rgba(34,211,238,0.35)');
          cyLine.setAttribute('stroke-width', '2');
          timelineSvg.appendChild(cyLine);

          // Layout rows
          const rows = 3;
          const laneY = [padT+58, padT+128, padT+198];

          // Create bubbles
          timelineData.forEach((d, i)=>{
            const base = bubblePrevalence(d, year);
            const activity = base;

            const x = xFor(d.peak);
            const y = laneY[i % rows];

            const r = 10 + activity*32;

            // halo ring shows audience centrality
            const ring = document.createElementNS('http://www.w3.org/2000/svg','circle');
            ring.setAttribute('cx', x);
            ring.setAttribute('cy', y);
            ring.setAttribute('r', r + 7);
            ring.setAttribute('fill', 'none');
            ring.setAttribute('stroke', `rgba(34,211,238,${0.05 + d.audience*0.26})`);
            ring.setAttribute('stroke-width', String(1.5));
            ring.setAttribute('opacity', activity > 0 ? '1' : '0');
            timelineSvg.appendChild(ring);

            const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
            c.setAttribute('cx', x);
            c.setAttribute('cy', y);
            c.setAttribute('r', r);
            const hue = (d.id === 'tournament') ? 'rgba(139,92,246,' : 'rgba(34,211,238,';
            c.setAttribute('fill', `${hue}${0.10 + activity*0.26})`);
            c.setAttribute('stroke', 'rgba(255,255,255,0.18)');
            c.setAttribute('stroke-width', String(1));
            c.setAttribute('opacity', activity > 0 ? String(0.55 + activity*0.45) : '0');
            c.style.cursor = activity > 0 ? 'pointer' : 'default';
            c.dataset.id = d.id;
            timelineSvg.appendChild(c);

            const label = document.createElementNS('http://www.w3.org/2000/svg','text');
            label.setAttribute('x', x);
            label.setAttribute('y', y + r + 18);
            label.setAttribute('fill', 'rgba(234,240,255,0.75)');
            label.setAttribute('font-size', '12');
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('opacity', activity > 0.12 ? '1' : '0');
            label.textContent = d.name;
            timelineSvg.appendChild(label);

            // Active range segment
            const x0 = xFor(d.year0);
            const x1 = xFor(d.year1);
            const seg = document.createElementNS('http://www.w3.org/2000/svg','path');
            seg.setAttribute('d', `M ${x0} ${y} L ${x1} ${y}`);
            seg.setAttribute('stroke', 'rgba(255,255,255,0.10)');
            seg.setAttribute('stroke-width', String(1));
            seg.setAttribute('opacity', activity > 0 ? '1' : '0');
            timelineSvg.insertBefore(seg, ring);

            // Click behavior
            c.addEventListener('click', ()=>{
              if(activity <= 0) return;
              selectFormat(d.id);
            });
          });

          // Default selection: pick most active at year
          const active = timelineData
            .map(d => ({d, v: bubblePrevalence(d, year)}))
            .sort((a,b)=>b.v-a.v);
          if(active.length && active[0].v > 0.06){
            selectFormat(active[0].d.id);
          }

        }catch(e){ console.error(e); }
      }

      function selectFormat(id){
        const d = timelineData.find(x=>x.id===id);
        if(!d) return;
        formatTitle.textContent = d.name;

        // chips
        formatChips.innerHTML = '';
        d.tags.forEach(t=>{
          const s = document.createElement('span');
          s.className = 'chip text-[11px] text-white/75';
          s.textContent = t;
          formatChips.appendChild(s);
        });

        formatDesc.textContent = d.desc;
        formatAudience.textContent = Math.round(d.audience*100) + '/100';
        formatThroughput.textContent = Math.round(d.throughput*100) + '/100';
      }

      if(yearSlider){
        yearSlider.addEventListener('input', renderTimeline);
        renderTimeline();
      }

      // ---------- Scene 3: Optimization morph ----------
      const modeAudience = document.getElementById('modeAudience');
      const modeJudge = document.getElementById('modeJudge');
      const complexity = document.getElementById('complexity');
      const complexityLabel = document.getElementById('complexityLabel');
      const argBox = document.getElementById('argBox');
      const argTag = document.getElementById('argTag');
      const meterPublic = document.getElementById('meterPublic');
      const meterJudge = document.getElementById('meterJudge');
      const meterPublicLabel = document.getElementById('meterPublicLabel');
      const meterJudgeLabel = document.getElementById('meterJudgeLabel');
      const jargonEl = document.getElementById('jargon');
      const narrativeEl = document.getElementById('narrative');
      const clashEl = document.getElementById('clash');

      const coreClaim = {
        topic: "Debate training should aim at persuading real audiences, not just winning adjudicated rounds.",
        stake: "If you train only for tournaments, you optimize for judges and lose the public.",
      };

      let mode = 'audience';

      function setMode(m){
        mode = m;
        if(m === 'audience'){
          modeAudience.classList.add('btnSolid');
          modeAudience.classList.add('font-semibold');
          modeJudge.classList.remove('btnSolid');
          argTag.textContent = 'Audience mode';
        } else {
          modeJudge.classList.add('btnSolid');
          modeJudge.classList.add('font-semibold');
          modeAudience.classList.remove('btnSolid');
          argTag.textContent = 'Judge mode';
        }
        renderArgument();
      }

      if(modeAudience) modeAudience.addEventListener('click', ()=> setMode('audience'));
      if(modeJudge) modeJudge.addEventListener('click', ()=> setMode('judge'));

      function renderArgument(){
        try{
          const c = parseInt(complexity.value,10);
          complexityLabel.textContent = String(c);

          const t = c/100;

          // Build text
          let txt = '';
          let jargon = 0;
          let narrative = 0;
          let clash = 0;

          if(mode === 'audience'){
            const hook = [
              "Imagine you walk into a room of neighbors who disagree — not judges.",
              "Your job isn’t to impress; it’s to earn trust, then earn movement.",
            ];
            const spine = [
              "When debate becomes a tournament-only practice, speakers learn to optimize for the ballot.",
              "That creates arguments that travel well inside the circuit — and die outside it.",
              "If we want civic speech, we need audience-centered formats again."
            ];
            const detail = [
              "Keep the evidence legible. Make the stakes shared. Let the public be the pressure test.",
              "Then your rhetoric doesn’t just win — it works."
            ];

            narrative = Math.round(lerp(85, 60, t));
            clash = Math.round(lerp(70, 80, t));
            jargon = Math.round(lerp(10, 35, t));

            txt = `
              <p class="text-white/85">${hook[0]}</p>
              <p class="mt-3 text-white/80">${hook[1]}</p>
              <p class="mt-4 text-white/85 font-semibold">${coreClaim.topic}</p>
              <div class="mt-4 space-y-2 text-white/75">
                <p>${spine[0]}</p>
                <p>${spine[1]}</p>
                <p>${spine[2]}</p>
              </div>
              <p class="mt-4 text-white/80">${detail[0]}</p>
              <p class="mt-2 text-white/80">${detail[1]}</p>
            `;

          } else {
            // Judge mode: compress + jargon + dense linkage
            const terms = [
              "tournament model", "adjudication", "procedural", "flow", "tech", "framework", "standards", "interpretation",
              "modeling loop", "closed circuit", "optimization target", "in-group legibility"
            ];
            const abbrev = ["(i)","(ii)","(iii)","(iv)"];
            const dens = Math.round(lerp(0, 7, t));
            const pick = (n)=> terms.slice(0, n).join(", ");

            jargon = Math.round(lerp(40, 92, t));
            narrative = Math.round(lerp(35, 10, t));
            clash = Math.round(lerp(78, 92, t));

            const p1 = `Claim: debate-as-tournament collapses rhetorical training into judge-facing optimization.`;
            const p2 = `Mechanism: throughput incentives + adjudication primacy shift the objective function (public persuasion → ballot maximization).`;
            const p3 = `Result: argument distributions drift toward insider legibility via iterative mimesis (${pick(4 + dens)}).`;
            const p4 = `Impact: public comprehensibility decreases while procedural performance increases; the activity becomes self-referential.`;
            const p5 = `Standard: restore audience-centered constraint sets (contract/public formats) to re-anchor the persuasion objective.`;

            txt = `
              <div class="text-white/80 mono text-[13px] leading-relaxed">
                <p><span class="text-white/90 font-semibold">${abbrev[0]}</span> ${p1}</p>
                <p class="mt-2"><span class="text-white/90 font-semibold">${abbrev[1]}</span> ${p2}</p>
                <p class="mt-2"><span class="text-white/90 font-semibold">${abbrev[2]}</span> ${p3}</p>
                <p class="mt-2"><span class="text-white/90 font-semibold">${abbrev[3]}</span> ${p4}</p>
                <p class="mt-3 text-white/85 font-semibold">${p5}</p>
              </div>
            `;
          }

          argBox.innerHTML = txt;

          // Meters: public drops with jargon + complexity in judge mode; judge satisfaction increases
          let publicScore, judgeScore;
          if(mode === 'audience'){
            publicScore = clamp01(0.86 - (t*0.25)) * 100;
            judgeScore = clamp01(0.55 + (t*0.22)) * 100;
          } else {
            publicScore = clamp01(0.62 - (t*0.45)) * 100;
            judgeScore = clamp01(0.70 + (t*0.26)) * 100;
          }

          setWidth(meterPublic, publicScore);
          setWidth(meterJudge, judgeScore);

          meterPublicLabel.textContent = Math.round(publicScore) + '/100';
          meterJudgeLabel.textContent = Math.round(judgeScore) + '/100';

          jargonEl.textContent = jargon + '/100';
          narrativeEl.textContent = narrative + '/100';
          clashEl.textContent = clash + '/100';

        }catch(e){ console.error(e); }
      }

      if(complexity){
        complexity.addEventListener('input', renderArgument);
      }
      setMode('audience');
      renderArgument();

      // ---------- Scene 4: Mimesis collapse sim ----------
      const audPressure = document.getElementById('audPressure');
      const audPressureLabel = document.getElementById('audPressureLabel');
      const stepGen = document.getElementById('stepGen');
      const autoGenBtn = document.getElementById('autoGen');
      const resetGen = document.getElementById('resetGen');
      const popGrid = document.getElementById('popGrid');
      const genLabel = document.getElementById('genLabel');
      const clarityLabel = document.getElementById('clarityLabel');
      const divLabel = document.getElementById('divLabel');
      const insiderLabel = document.getElementById('insiderLabel');
      const entropyCanvas = document.getElementById('entropyCanvas');
      const compCanvas = document.getElementById('compCanvas');

      const ectx = entropyCanvas ? entropyCanvas.getContext('2d') : null;
      const pctx = compCanvas ? compCanvas.getContext('2d') : null;

      let gen = 0;
      let auto = false;
      let pop = [];
      let historyEntropy = [];
      let historyComp = [];

      function makeSpecimen(rng, i){
        // Traits in [0,1]
        const clarity = clamp01(0.35 + rng()*0.6);
        const jargon = clamp01(rng()*0.95);
        const novelty = clamp01(rng()*0.95);
        const speed = clamp01(rng()*0.95);
        const trick = clamp01(rng()*0.95);
        // public comprehensibility starts high when clarity high and jargon low
        const comp = clamp01(0.55*clarity + 0.20*(1-jargon) + 0.10*(1-speed) + 0.15*(1-trick));
        return { id: i, clarity, jargon, novelty, speed, trick, comp };
      }

      function computeFitness(s, audiencePressure){
        // Weighted objective: audience rewards clarity & comp; tournament rewards speed, trick, jargon-y compression
        const a = audiencePressure;
        const t = 1 - a;
        const audienceFit = 0.55*s.comp + 0.30*s.clarity + 0.15*s.novelty;
        const tournamentFit = 0.35*s.speed + 0.30*s.trick + 0.25*s.jargon + 0.10*s.novelty;
        return a*audienceFit + t*tournamentFit;
      }

      function recomputeComp(s){
        s.comp = clamp01(0.55*s.clarity + 0.20*(1-s.jargon) + 0.10*(1-s.speed) + 0.15*(1-s.trick));
      }

      function entropy(pop){
        // Discretize into buckets by rounded trait vector
        const counts = new Map();
        for(const s of pop){
          const key = [
            Math.round(s.clarity*4),
            Math.round(s.jargon*4),
            Math.round(s.speed*4),
            Math.round(s.trick*4)
          ].join('-');
          counts.set(key, (counts.get(key)||0) + 1);
        }
        const N = pop.length;
        let H = 0;
        counts.forEach((c)=>{
          const p = c / N;
          H -= p * Math.log2(p);
        });
        // Normalize by max log2(N)
        const Hmax = Math.log2(Math.max(2, counts.size));
        return Hmax > 0 ? clamp01(H / Hmax) : 0;
      }

      function initPopulation(){
        const rng = mulberry32(20250216);
        gen = 0;
        pop = [];
        const N = 24;
        for(let i=0;i<N;i++) pop.push(makeSpecimen(rng, i));
        historyEntropy = [];
        historyComp = [];
        pushHistory();
        renderPopulation();
        drawGraphs();
      }

      function pushHistory(){
        const e = entropy(pop);
        const c = pop.reduce((a,s)=>a+s.comp,0)/pop.length;
        historyEntropy.push(e);
        historyComp.push(c);

        genLabel.textContent = String(gen);
        clarityLabel.textContent = Math.round(c*100) + '/100';
        divLabel.textContent = Math.round(e*100) + '/100';
        // Insider-ness: high when jargon+speed+trick dominate
        const ins = pop.reduce((a,s)=>a + (0.35*s.jargon + 0.35*s.speed + 0.30*s.trick),0)/pop.length;
        insiderLabel.textContent = Math.round(ins*100) + '/100';
      }

      function evolveOne(){
        const a = parseInt(audPressure.value,10)/100;

        // Select winners
        const scored = pop.map(s=>({s, f: computeFitness(s, a)})).sort((x,y)=>y.f-x.f);
        const keep = scored.slice(0, 10).map(x=>x.s);

        // Reproduce with mutation (closed-loop imitation)
        const rng = mulberry32(98765 + gen*101);
        const next = [];
        for(let i=0;i<pop.length;i++){
          const parent = keep[Math.floor(rng()*keep.length)];
          const child = {...parent, id: i};

          // Mutation magnitude grows when audience pressure is low (tournament circuit gets stranger)
          const mag = lerp(0.06, 0.16, (1-a));
          // Drift direction: toward tournament traits when audience pressure low
          const drift = (1-a);

          child.clarity = clamp01(child.clarity + (rng()-0.5)*mag - drift*0.05);
          child.jargon = clamp01(child.jargon + (rng()-0.45)*mag + drift*0.08);
          child.speed = clamp01(child.speed + (rng()-0.45)*mag + drift*0.08);
          child.trick = clamp01(child.trick + (rng()-0.45)*mag + drift*0.07);
          child.novelty = clamp01(child.novelty + (rng()-0.5)*mag*0.8);

          // Reintroduce audience constraint reduces jargon/speed/trick, boosts clarity
          if(a > 0.55){
            const k = (a - 0.55) / 0.45;
            child.clarity = clamp01(child.clarity + 0.08*k);
            child.jargon = clamp01(child.jargon - 0.10*k);
            child.speed = clamp01(child.speed - 0.08*k);
            child.trick = clamp01(child.trick - 0.06*k);
          }

          recomputeComp(child);
          next.push(child);
        }

        pop = next;
        gen++;
        pushHistory();
        renderPopulation();
        drawGraphs();
      }

      function traitColor(s){
        // Blend: clarity (green/cyan) vs insider (violet/amber)
        const ins = clamp01(0.35*s.jargon + 0.35*s.speed + 0.30*s.trick);
        const cl = s.clarity;
        const a = 0.18 + 0.42*cl;
        const b = 0.18 + 0.42*ins;
        // Use rgba strings
        const c1 = `rgba(52,211,153,${a.toFixed(3)})`;
        const c2 = `rgba(139,92,246,${b.toFixed(3)})`;
        return {c1,c2};
      }

      function renderPopulation(){
        if(!popGrid) return;
        popGrid.innerHTML = '';
        const a = parseInt(audPressure.value,10)/100;

        pop.forEach(s=>{
          const d = document.createElement('div');
          d.className = 'rounded-xl border border-white/10 bg-white/5 p-3';
          const {c1,c2} = traitColor(s);
          d.style.background = `linear-gradient(135deg, ${c2}, ${c1})`;

          const comp = Math.round(s.comp*100);
          const cl = Math.round(s.clarity*100);
          const ins = Math.round((0.35*s.jargon + 0.35*s.speed + 0.30*s.trick)*100);

          d.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="text-xs text-white/70">specimen</div>
              <div class="mono text-xs text-white/80">#${String(s.id).padStart(2,'0')}</div>
            </div>
            <div class="mt-2 text-sm font-semibold">${comp >= 60 ? 'Legible' : (comp >= 40 ? 'Compressed' : 'Alien')}</div>
            <div class="mt-2 grid grid-cols-3 gap-1 text-[11px] text-white/80">
              <div>clar ${cl}</div>
              <div>comp ${comp}</div>
              <div>in ${ins}</div>
            </div>
          `;

          d.addEventListener('click', ()=>{
            // On click, briefly highlight & show in console (no UI wall)
            d.style.outline = '2px solid rgba(34,211,238,0.55)';
            setTimeout(()=>{ d.style.outline = 'none'; }, 260);
          });

          popGrid.appendChild(d);
        });

        audPressureLabel.textContent = String(Math.round(a*100));
      }

      function drawLineGraph(ctx, values, colorA, colorB){
        if(!ctx) return;
        const w = ctx.canvas.width;
        const h = ctx.canvas.height;
        ctx.clearRect(0,0,w,h);

        // bg
        const bg = ctx.createLinearGradient(0,0,w,h);
        bg.addColorStop(0,'rgba(255,255,255,0.04)');
        bg.addColorStop(1,'rgba(0,0,0,0.20)');
        ctx.fillStyle = bg;
        ctx.fillRect(0,0,w,h);

        // grid
        ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        ctx.lineWidth = 1;
        for(let i=1;i<5;i++){
          const y = (i/5)*h;
          ctx.beginPath();
          ctx.moveTo(0,y);
          ctx.lineTo(w,y);
          ctx.stroke();
        }

        if(values.length < 2) return;
        const max = 1;
        const min = 0;

        // area
        const grad = ctx.createLinearGradient(0,0,w,0);
        grad.addColorStop(0,colorA);
        grad.addColorStop(1,colorB);

        ctx.beginPath();
        for(let i=0;i<values.length;i++){
          const x = (i/(values.length-1))* (w-20) + 10;
          const v = values[i];
          const y = (1 - (v-min)/(max-min)) * (h-22) + 11;
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.strokeStyle = grad;
        ctx.lineWidth = 3;
        ctx.stroke();

        // points
        for(let i=0;i<values.length;i++){
          const x = (i/(values.length-1))* (w-20) + 10;
          const v = values[i];
          const y = (1 - v) * (h-22) + 11;
          ctx.fillStyle = 'rgba(234,240,255,0.85)';
          ctx.beginPath();
          ctx.arc(x,y,2.2,0,Math.PI*2);
          ctx.fill();
        }
      }

      function drawGraphs(){
        drawLineGraph(ectx, historyEntropy, 'rgba(34,211,238,0.95)', 'rgba(139,92,246,0.95)');
        drawLineGraph(pctx, historyComp, 'rgba(52,211,153,0.95)', 'rgba(34,211,238,0.95)');
      }

      let autoTimer = null;
      function setAuto(on){
        auto = on;
        autoGenBtn.textContent = on ? 'Auto: on' : 'Auto: off';
        if(on){
          autoTimer = setInterval(()=>{ evolveOne(); }, 420);
        } else {
          if(autoTimer) clearInterval(autoTimer);
          autoTimer = null;
        }
      }

      if(audPressure){
        audPressure.addEventListener('input', ()=>{
          audPressureLabel.textContent = audPressure.value;
          renderPopulation();
        });
      }
      if(stepGen) stepGen.addEventListener('click', evolveOne);
      if(autoGenBtn) autoGenBtn.addEventListener('click', ()=> setAuto(!auto));
      if(resetGen) resetGen.addEventListener('click', ()=>{ setAuto(false); initPopulation(); });

      initPopulation();

      // ---------- Scene 5: Contract builder ----------
      const audType = document.getElementById('audType');
      const venue = document.getElementById('venue');
      const judgeRule = document.getElementById('judgeRule');
      const reward = document.getElementById('reward');
      const evidence = document.getElementById('evidence');
      const length = document.getElementById('length');
      const audCent = document.getElementById('audCent');
      const audCentLabel = document.getElementById('audCentLabel');

      const scorePers = document.getElementById('scorePers');
      const scorePed = document.getElementById('scorePed');
      const scorePersLabel = document.getElementById('scorePersLabel');
      const scorePedLabel = document.getElementById('scorePedLabel');

      const formatName = document.getElementById('formatName');
      const formatHash = document.getElementById('formatHash');
      const cardAudience = document.getElementById('cardAudience');
      const cardVenue = document.getElementById('cardVenue');
      const cardDecision = document.getElementById('cardDecision');
      const cardReward = document.getElementById('cardReward');
      const clause = document.getElementById('clause');
      const marchCanvas = document.getElementById('marchCanvas');
      const mctx = marchCanvas ? marchCanvas.getContext('2d') : null;
      const marchScore = document.getElementById('marchScore');
      const btnShare = document.getElementById('btnShare');
      const shareStatus = document.getElementById('shareStatus');
      const btnRandomize = document.getElementById('btnRandomize');

      function labelOf(selectEl){
        const opt = selectEl.options[selectEl.selectedIndex];
        return opt ? opt.textContent.trim() : '';
      }

      function computeScores(){
        const a = parseInt(audCent.value,10)/100;
        audCentLabel.textContent = String(Math.round(a*100));

        // Map categorical choices to coefficients
        const audTypeV = audType.value;
        const venueV = venue.value;
        const judgeV = judgeRule.value;
        const rewardV = reward.value;
        const evidenceV = evidence.value;
        const lengthV = length.value;

        let pers = 0.50 + 0.50*a;
        let ped = 0.55 + 0.35*a;

        // Audience type
        if(audTypeV === 'community') { pers += 0.06; ped += 0.02; }
        if(audTypeV === 'civic') { pers += 0.08; ped += 0.01; }
        if(audTypeV === 'students') { ped += 0.06; }
        if(audTypeV === 'online') { pers += 0.03; ped += 0.01; }

        // Venue
        if(venueV === 'auditorium') { pers += 0.04; }
        if(venueV === 'townhall') { pers += 0.06; }
        if(venueV === 'library') { ped += 0.05; }
        if(venueV === 'campus') { ped += 0.03; }

        // Decision rule (judge vs public)
        if(judgeV === 'public') { pers += 0.10; ped += 0.02; }
        if(judgeV === 'hybrid') { pers += 0.07; ped += 0.05; }
        if(judgeV === 'expert') { ped += 0.06; pers -= 0.03; }

        // Reward
        if(rewardV === 'civic') { pers += 0.10; }
        if(rewardV === 'publication') { pers += 0.05; ped += 0.04; }
        if(rewardV === 'scholarship') { ped += 0.05; pers += 0.02; }
        if(rewardV === 'trophy') { ped += 0.02; pers -= 0.04; }

        // Evidence norms
        if(evidenceV === 'public') { pers += 0.08; ped += 0.02; }
        if(evidenceV === 'mixed') { pers += 0.05; ped += 0.05; }
        if(evidenceV === 'strict') { ped += 0.08; pers -= 0.02; }

        // Length
        if(lengthV === 'short') { pers += 0.05; ped -= 0.02; }
        if(lengthV === 'medium') { pers += 0.03; ped += 0.03; }
        if(lengthV === 'long') { ped += 0.08; pers -= 0.02; }

        pers = clamp01(pers);
        ped = clamp01(ped);

        return {pers, ped};
      }

      function buildClause(pers, ped){
        const aLabel = labelOf(audType);
        const vLabel = labelOf(venue);
        const dLabel = labelOf(judgeRule);
        const eLabel = labelOf(evidence);

        const force = pers >= 0.78 ? "must" : (pers >= 0.62 ? "should" : "may");
        const publicness = pers >= 0.72 ? "in language the room can repeat" : "with an accessible summary";
        const proof = eLabel.toLowerCase().includes('public') ? "with citations a neighbor can check" : "with a public-facing summary and technical appendix";

        return `${force.toUpperCase()}: Every claim is argued for ${aLabel.toLowerCase()} in a ${vLabel.toLowerCase()} — decided by ${dLabel.toLowerCase()} — ${publicness}, ${proof}.`;
      }

      function nameFromConfig(pers, ped){
        const a = audType.value;
        const d = judgeRule.value;
        const r = reward.value;
        const v = venue.value;

        const A = {
          community: "Neighbors",
          civic: "Stakeholders",
          students: "Families",
          online: "Public Stream"
        }[a] || "Public";

        const D = {
          public: "Ballot",
          hybrid: "Jury",
          expert: "Panel"
        }[d] || "Decision";

        const R = {
          civic: "Pledge",
          publication: "Replay",
          scholarship: "Scholar",
          trophy: "Cup"
        }[r] || "Prize";

        const V = {
          auditorium: "Hall",
          townhall: "Forum",
          library: "Salon",
          campus: "Theater"
        }[v] || "Forum";

        const intensity = pers >= 0.78 ? "March" : (pers >= 0.62 ? "Move" : "Speak");

        return `${A} ${V}: ${intensity} ${D} / ${R}`;
      }

      function drawMarch(pers, ped){
        if(!mctx || !marchCanvas) return;
        const w = marchCanvas.width;
        const h = marchCanvas.height;
        mctx.clearRect(0,0,w,h);

        // Background
        const bg = mctx.createLinearGradient(0,0,w,h);
        bg.addColorStop(0,'rgba(139,92,246,0.14)');
        bg.addColorStop(0.5,'rgba(34,211,238,0.12)');
        bg.addColorStop(1,'rgba(0,0,0,0.25)');
        mctx.fillStyle = bg;
        mctx.fillRect(0,0,w,h);

        // Momentum
        const momentum = clamp01(0.62*pers + 0.38*ped);
        const lanes = 6;
        const dots = 150;
        const rng = mulberry32(7777);

        // Central trail
        const centerY = h*0.50;
        mctx.strokeStyle = `rgba(34,211,238,${0.14 + 0.32*momentum})`;
        mctx.lineWidth = 2;
        mctx.beginPath();
        mctx.moveTo(w*0.10, centerY);
        mctx.bezierCurveTo(w*0.30, centerY-40, w*0.55, centerY+40, w*0.84, centerY);
        mctx.stroke();

        // Dots: seated vs marching
        for(let i=0;i<dots;i++){
          const lane = Math.floor(rng()*lanes);
          const ly = (lane+0.5)*(h/lanes);
          const baseX = (rng()*0.75 + 0.10) * w;

          // When momentum high, dots shift right with coherence
          const drift = lerp(0.0, w*0.18, smoothstep((momentum-0.45)/0.55));
          const coherence = smoothstep((momentum-0.30)/0.70);
          const x = baseX + drift*coherence + Math.sin((i*0.6)+(lane*1.7))*6*coherence;
          const y = ly + Math.cos((i*0.45)+(lane*1.3))*4*coherence;

          const r = 1.2 + rng()*2.2;
          const glow = (rng() > 0.72) ? 1 : 0;

          mctx.fillStyle = `rgba(234,240,255,${0.25 + 0.65*coherence})`;
          mctx.beginPath();
          mctx.arc(x,y,r,0,Math.PI*2);
          mctx.fill();

          if(glow){
            mctx.fillStyle = `rgba(52,211,153,${0.06 + 0.20*coherence})`;
            mctx.beginPath();
            mctx.arc(x,y,r*2.6,0,Math.PI*2);
            mctx.fill();
          }
        }

        // Arrow to "march"
        const ax = lerp(w*0.45, w*0.86, momentum);
        const ay = h*0.18;
        mctx.strokeStyle = `rgba(251,191,36,${0.12 + 0.35*momentum})`;
        mctx.lineWidth = 2;
        mctx.beginPath();
        mctx.moveTo(w*0.20, ay);
        mctx.lineTo(ax, ay);
        mctx.stroke();
        mctx.fillStyle = `rgba(251,191,36,${0.10 + 0.30*momentum})`;
        mctx.beginPath();
        mctx.moveTo(ax, ay);
        mctx.lineTo(ax-12, ay-7);
        mctx.lineTo(ax-12, ay+7);
        mctx.closePath();
        mctx.fill();

        // Text-like glyph blocks (no actual text)
        for(let i=0;i<4;i++){
          const x0 = w*0.08;
          const y0 = h*0.72 + i*10;
          const len = lerp(w*0.18, w*0.44, momentum) * (0.65 + 0.25*i/4);
          mctx.fillStyle = `rgba(255,255,255,${0.06 + 0.10*momentum})`;
          mctx.fillRect(x0, y0, len, 5);
        }

        // Score badge
        const score = Math.round(momentum*100);
        marchScore.textContent = `Momentum ${score}/100`;
      }

      function updateCard(){
        try{
          const {pers, ped} = computeScores();

          const persScore = Math.round(pers*100);
          const pedScore = Math.round(ped*100);

          setWidth(scorePers, persScore);
          setWidth(scorePed, pedScore);

          scorePersLabel.textContent = persScore + '/100';
          scorePedLabel.textContent = pedScore + '/100';

          cardAudience.textContent = labelOf(audType);
          cardVenue.textContent = labelOf(venue);
          cardDecision.textContent = labelOf(judgeRule);
          cardReward.textContent = labelOf(reward);

          const nm = nameFromConfig(pers, ped);
          formatName.textContent = nm;

          const clauseText = buildClause(pers, ped);
          clause.textContent = clauseText;

          const hash = textToHash([audType.value, venue.value, judgeRule.value, reward.value, evidence.value, length.value, audCent.value].join('|'));
          formatHash.textContent = hash;

          drawMarch(pers, ped);

          // Update URL hash (no storage)
          const payload = encodeURIComponent([audType.value, venue.value, judgeRule.value, reward.value, evidence.value, length.value, audCent.value].join(','));
          window.location.hash = `f=${hash}&cfg=${payload}`;

        }catch(e){ console.error(e); }
      }

      function applyFromHash(){
        try{
          const h = window.location.hash || '';
          const m = h.match(/cfg=([^&]+)/);
          if(!m) return;
          const cfg = decodeURIComponent(m[1]).split(',');
          if(cfg.length < 7) return;
          const [a,v,j,r,e,l,c] = cfg;

          // Validate against known options
          function setIfExists(sel, val){
            const el = document.getElementById(sel);
            if(!el) return;
            const ok = Array.from(el.options).some(o => o.value === val);
            if(ok) el.value = val;
          }
          setIfExists('audType', a);
          setIfExists('venue', v);
          setIfExists('judgeRule', j);
          setIfExists('reward', r);
          setIfExists('evidence', e);
          setIfExists('length', l);
          if(audCent){
            const n = parseInt(c,10);
            if(Number.isFinite(n)) audCent.value = String(Math.max(0, Math.min(100, n)));
          }

        }catch(e){ console.error(e); }
      }

      function wire(el){ if(el) el.addEventListener('change', updateCard); }
      wire(audType); wire(venue); wire(judgeRule); wire(reward); wire(evidence); wire(length);
      if(audCent) audCent.addEventListener('input', updateCard);

      if(btnShare){
        btnShare.addEventListener('click', async ()=>{
          try{
            const url = window.location.href;
            await navigator.clipboard.writeText(url);
            shareStatus.textContent = 'Link copied.';
            setTimeout(()=>{ shareStatus.textContent = ''; }, 1400);
          }catch(e){
            console.error(e);
            shareStatus.textContent = 'Copy failed (clipboard not available).';
            setTimeout(()=>{ shareStatus.textContent = ''; }, 1800);
          }
        });
      }

      if(btnRandomize){
        btnRandomize.addEventListener('click', ()=>{
          try{
            const rng = mulberry32(Math.floor(Math.random()*1e9));
            const pick = (sel)=>{
              const el = document.getElementById(sel);
              if(!el) return;
              const opts = Array.from(el.options);
              el.selectedIndex = Math.floor(rng()*opts.length);
            };
            pick('audType');
            pick('venue');
            pick('judgeRule');
            pick('reward');
            pick('evidence');
            pick('length');
            if(audCent) audCent.value = String(Math.round(rng()*100));
            updateCard();
          }catch(e){ console.error(e); }
        });
      }

      applyFromHash();
      updateCard();

      // Ensure Scene 1 first render
      renderSpeech();

    })();
  </script>
</body>
</html>
