<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Insurance Analyzer - Brazos Built Right</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Legal document inspired background */
        .legal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000 0%, #0a0a1a 50%, #000 100%);
            z-index: -2;
        }

        .legal-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            z-index: -1;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 40px, #007AFF 40px, #007AFF 41px),
                repeating-linear-gradient(90deg, transparent, transparent 40px, #007AFF 40px, #007AFF 41px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 60px;
            padding-top: 40px;
        }

        .header h1 {
            font-size: 56px;
            font-weight: 700;
            letter-spacing: -3px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #007AFF, #AF52DE);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            font-size: 20px;
            color: #8e8e93;
        }

        /* Contract Input Section */
        .input-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
        }

        .input-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contract-textarea {
            width: 100%;
            min-height: 200px;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            color: #fff;
            font-size: 14px;
            font-family: 'SF Mono', monospace;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .contract-textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 20px rgba(0,122,255,0.2);
        }

        .sample-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .sample-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sample-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .analyze-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto 0;
            padding: 16px;
            background: linear-gradient(135deg, #007AFF, #0051D5);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,122,255,0.3);
        }

        /* Analysis Results */
        .results-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-section.active {
            display: block;
        }

        /* Compliance Dashboard */
        .compliance-dashboard {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .compliance-score {
            text-align: center;
            margin-bottom: 40px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
        }

        .score-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .score-background {
            fill: none;
            stroke: rgba(255,255,255,0.1);
            stroke-width: 15;
        }

        .score-progress {
            fill: none;
            stroke-width: 15;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: 700;
        }

        .score-label {
            font-size: 20px;
            color: #8e8e93;
        }

        .compliance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .compliance-item {
            padding: 16px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .compliance-item.met {
            background: rgba(52,199,89,0.1);
            border: 1px solid rgba(52,199,89,0.3);
        }

        .compliance-item.not-met {
            background: rgba(255,59,48,0.1);
            border: 1px solid rgba(255,59,48,0.3);
        }

        .compliance-item.partial {
            background: rgba(255,149,0,0.1);
            border: 1px solid rgba(255,149,0,0.3);
        }

        .compliance-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .compliance-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .compliance-status {
            font-size: 12px;
            color: #8e8e93;
        }

        /* Requirements Breakdown */
        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .requirement-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            transition: all 0.3s ease;
        }

        .requirement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--req-color);
            border-radius: 16px 16px 0 0;
        }

        .requirement-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .requirement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .requirement-type {
            font-size: 18px;
            font-weight: 600;
        }

        .requirement-priority {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-critical {
            background: rgba(255,59,48,0.2);
            color: #FF3B30;
        }

        .priority-required {
            background: rgba(255,149,0,0.2);
            color: #FF9500;
        }

        .priority-recommended {
            background: rgba(52,199,89,0.2);
            color: #34C759;
        }

        .requirement-details {
            font-size: 14px;
            color: #8e8e93;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .requirement-values {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .value-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .value-label {
            font-size: 14px;
            color: #8e8e93;
        }

        .value-amount {
            font-size: 14px;
            font-weight: 600;
            color: #007AFF;
        }

        /* Gap Analysis */
        .gap-analysis {
            background: linear-gradient(135deg, rgba(255,59,48,0.1), rgba(255,149,0,0.1));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }

        .gap-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .gap-list {
            display: grid;
            gap: 16px;
        }

        .gap-item {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .gap-icon {
            font-size: 28px;
        }

        .gap-content {
            flex: 1;
        }

        .gap-description {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .gap-impact {
            font-size: 14px;
            color: #8e8e93;
        }

        .gap-action {
            padding: 10px 20px;
            background: rgba(255,59,48,0.2);
            border: 1px solid #FF3B30;
            border-radius: 8px;
            color: #FF3B30;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gap-action:hover {
            background: rgba(255,59,48,0.3);
            transform: scale(1.05);
        }

        /* Clauses Parser */
        .clauses-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }

        .clause-item {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clause-item:hover {
            background: rgba(0,0,0,0.5);
            transform: translateX(8px);
        }

        .clause-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .clause-type {
            font-size: 16px;
            font-weight: 600;
        }

        .clause-tag {
            padding: 4px 8px;
            background: rgba(0,122,255,0.2);
            border-radius: 4px;
            font-size: 12px;
            color: #007AFF;
        }

        .clause-text {
            font-size: 14px;
            color: #8e8e93;
            line-height: 1.6;
            font-style: italic;
        }

        .clause-interpretation {
            margin-top: 12px;
            padding: 12px;
            background: rgba(52,199,89,0.1);
            border-left: 3px solid #34C759;
            border-radius: 4px;
        }

        .interpretation-label {
            font-size: 12px;
            font-weight: 600;
            color: #34C759;
            margin-bottom: 4px;
        }

        .interpretation-text {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Action Plan */
        .action-plan {
            background: linear-gradient(135deg, rgba(52,199,89,0.1), rgba(0,122,255,0.1));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }

        .action-timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 30px;
            top: 40px;
            bottom: 40px;
            width: 2px;
            background: linear-gradient(180deg, #007AFF, #34C759);
        }

        .action-step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }

        .step-dot {
            position: absolute;
            left: 20px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000;
            border: 3px solid #007AFF;
        }

        .step-content {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .step-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 14px;
            color: #8e8e93;
            margin-bottom: 12px;
        }

        .step-deadline {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(0,122,255,0.2);
            border-radius: 6px;
            font-size: 14px;
            color: #007AFF;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .requirements-grid {
                grid-template-columns: 1fr;
            }
            .compliance-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .header h1 {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="legal-bg"></div>
    <div class="legal-pattern"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Contract Insurance Analyzer</h1>
            <p>Paste any contract to instantly see insurance requirements and gaps</p>
        </header>

        <!-- Contract Input -->
        <div class="input-section">
            <h2 class="input-title">
                <span>📄</span>
                <span>Paste Contract Insurance Section</span>
            </h2>
            
            <textarea class="contract-textarea" id="contract-input" placeholder="Paste the insurance requirements section from any contract, bid document, or RFP...

Example: 'Contractor shall maintain General Liability insurance with limits of not less than $2,000,000 per occurrence and $4,000,000 aggregate...'"></textarea>
            
            <div class="sample-buttons">
                <button class="sample-btn" onclick="loadSample('residential')">Load Residential Sample</button>
                <button class="sample-btn" onclick="loadSample('commercial')">Load Commercial Sample</button>
                <button class="sample-btn" onclick="loadSample('government')">Load Government Sample</button>
                <button class="sample-btn" onclick="loadSample('gc-sub')">Load GC Subcontract</button>
            </div>
            
            <button class="analyze-btn" onclick="analyzeContract()">Analyze Requirements</button>
        </div>

        <!-- Analysis Results -->
        <div class="results-section" id="results">
            <!-- Compliance Dashboard -->
            <div class="compliance-dashboard">
                <div class="compliance-score">
                    <div class="score-circle">
                        <svg class="score-svg">
                            <circle class="score-background" cx="100" cy="100" r="80"></circle>
                            <circle class="score-progress" id="score-progress" cx="100" cy="100" r="80"
                                    stroke="#34C759" stroke-dasharray="502" stroke-dashoffset="502"></circle>
                        </svg>
                        <div class="score-text" id="compliance-score">0%</div>
                    </div>
                    <div class="score-label">Current Compliance Level</div>
                </div>
                
                <div class="compliance-grid" id="compliance-grid">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Requirements Breakdown -->
            <div class="requirements-grid" id="requirements-grid">
                <!-- Dynamically populated -->
            </div>

            <!-- Gap Analysis -->
            <div class="gap-analysis">
                <h2 class="gap-title">
                    <span>⚠️</span>
                    <span>Critical Coverage Gaps</span>
                </h2>
                <div class="gap-list" id="gap-list">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Important Clauses -->
            <div class="clauses-section">
                <h2 class="gap-title">
                    <span>🔍</span>
                    <span>Key Insurance Clauses Explained</span>
                </h2>
                <div id="clauses-list">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Action Plan -->
            <div class="action-plan">
                <h2 class="gap-title">
                    <span>✅</span>
                    <span>Your Compliance Action Plan</span>
                </h2>
                <div class="action-timeline">
                    <div class="timeline-line"></div>
                    <div id="action-steps">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample contracts
        const samples = {
            residential: `INSURANCE REQUIREMENTS:
The Contractor shall procure and maintain for the duration of the contract insurance against claims for injuries to persons or damages to property which may arise from or in connection with the performance of the work.

Minimum Insurance Requirements:
- Commercial General Liability: $1,000,000 per occurrence, $2,000,000 aggregate
- Automobile Liability: $1,000,000 combined single limit
- Workers Compensation: Statutory limits
- Umbrella Liability: Not required for residential projects under $500,000

Additional Insured: Property owner must be named as additional insured on General Liability policy.
Certificate of Insurance required before work commences.`,

            commercial: `ARTICLE 11 - INSURANCE AND BONDS
11.1 CONTRACTOR'S LIABILITY INSURANCE
The Contractor shall purchase and maintain insurance of the following types of coverage and limits of liability:

11.1.1 Commercial General Liability (CGL) with policy limits of not less than $2,000,000 per occurrence and $4,000,000 in the aggregate for bodily injury and property damage, including coverage for:
- Premises-Operations
- Products-Completed Operations  
- Personal and Advertising Injury
- Contractual Liability explicitly covering the indemnity provisions

11.1.2 Automobile Liability covering all owned, hired, and non-owned vehicles with limits of $1,000,000 CSL

11.1.3 Workers Compensation at statutory limits and Employers Liability of $1,000,000/$1,000,000/$1,000,000

11.1.4 Umbrella/Excess Liability of $5,000,000 per occurrence and aggregate

11.1.5 Pollution Liability of $2,000,000 per occurrence for projects involving hazardous materials

11.2 ADDITIONAL INSURED STATUS
Owner, Architect, and their consultants shall be Additional Insureds on all policies except Workers Compensation. Coverage shall be primary and non-contributory.

11.3 WAIVER OF SUBROGATION required on all policies in favor of Owner`,

            government: `SECTION 7 - INSURANCE REQUIREMENTS
7.1 MINIMUM INSURANCE COVERAGE
The Contractor shall obtain and maintain in force during the entire period of performance:

a) Commercial General Liability Insurance
   - Each Occurrence: $2,000,000
   - General Aggregate: $4,000,000  
   - Products/Completed Operations: $4,000,000
   - Personal & Advertising Injury: $2,000,000
   - Fire Damage (any one fire): $100,000
   - Medical Expense (any one person): $10,000

b) Commercial Automobile Liability
   - Combined Single Limit: $1,000,000
   - Must include all owned, hired, and non-owned automobiles

c) Workers' Compensation and Employers Liability
   - Workers Compensation: Statutory
   - Employers Liability: $1,000,000 each accident/disease/policy limit

d) Environmental/Pollution Liability (City of College Station Requirement)
   - Each Occurrence: $5,000,000
   - Aggregate: $10,000,000
   - Must include coverage for transportation, disposal, and completed operations

e) Professional Liability (if design services provided)
   - Each Claim: $1,000,000
   - Aggregate: $2,000,000

f) Umbrella/Excess Liability
   - Each Occurrence: $5,000,000
   - Aggregate: $5,000,000

7.2 ADDITIONAL REQUIREMENTS
- City must be named Additional Insured with primary and non-contributory coverage
- Waiver of Subrogation in favor of City
- 30-day Notice of Cancellation
- Insurance carrier must be rated A- VII or better by A.M. Best
- Deductibles exceeding $10,000 must be disclosed and approved`,

            'gc-sub': `SUBCONTRACT INSURANCE REQUIREMENTS

Prior to commencing Work, Subcontractor shall obtain and continuously maintain:

GENERAL LIABILITY INSURANCE
$1,000,000 Each Occurrence
$2,000,000 General Aggregate (per project)
$2,000,000 Products/Completed Operations Aggregate
Including: Premises/Operations, Products/Completed Operations, Contractual Liability, Personal Injury, Advertising Injury, and XCU coverage

AUTOMOBILE LIABILITY
$1,000,000 Combined Single Limit
Coverage for all owned, hired, and non-owned vehicles

WORKERS COMPENSATION
Part One: Statutory Benefits
Part Two: $1,000,000 Each Accident/Disease/Policy Limit

EXCESS/UMBRELLA LIABILITY
$2,000,000 per occurrence and aggregate
Must be excess over General Liability, Auto, and Employers Liability

ADDITIONAL PROVISIONS:
1. General Contractor and Owner as Additional Insured on GL and Excess
2. Waiver of Subrogation on all policies
3. Primary and Non-contributory clause
4. Completed Operations coverage for 3 years after project completion
5. Notice of Cancellation: 30 days (10 days for non-payment)
6. Certificates due before mobilization
7. Subcontractor responsible for all deductibles

SPECIAL REQUIREMENTS FOR FENCE/DECK CONTRACTORS:
- Installation Floater for materials in transit
- Care, Custody, and Control coverage
- Riggers Liability if using cranes
- Environmental Liability if using treated lumber`
        };

        // Current insurance coverage (what Brazos Built Right has)
        const currentCoverage = {
            generalLiability: { 
                perOccurrence: 500000, 
                aggregate: 1000000,
                completed: false,
                fire: 50000,
                medical: 5000
            },
            autoLiability: {
                combinedLimit: 0,
                owned: false,
                hired: false,
                nonOwned: false
            },
            workersComp: {
                hasPolicy: true,
                statutory: true,
                employersLiability: 100000
            },
            umbrella: {
                hasPolicy: false,
                limit: 0
            },
            pollution: {
                hasPolicy: false,
                perOccurrence: 0,
                aggregate: 0
            },
            professional: {
                hasPolicy: false,
                limit: 0
            }
        };

        // Load sample contract
        function loadSample(type) {
            document.getElementById('contract-input').value = samples[type];
        }

        // Analyze contract
        function analyzeContract() {
            const contractText = document.getElementById('contract-input').value;
            if (!contractText.trim()) {
                alert('Please paste a contract or load a sample first.');
                return;
            }

            // Parse requirements from contract
            const requirements = parseRequirements(contractText);
            
            // Calculate compliance
            const compliance = calculateCompliance(requirements);
            
            // Show results
            displayResults(requirements, compliance);
        }

        // Parse insurance requirements from contract text
        function parseRequirements(text) {
            const requirements = {
                generalLiability: {
                    required: false,
                    perOccurrence: 0,
                    aggregate: 0,
                    completed: false,
                    additional: []
                },
                autoLiability: {
                    required: false,
                    limit: 0
                },
                workersComp: {
                    required: false,
                    statutory: false,
                    employersLiability: 0
                },
                umbrella: {
                    required: false,
                    limit: 0
                },
                pollution: {
                    required: false,
                    perOccurrence: 0,
                    aggregate: 0
                },
                professional: {
                    required: false,
                    limit: 0
                },
                additionalInsured: false,
                waiverSubrogation: false,
                primaryNonContributory: false,
                noticeCancellation: 0,
                carrierRating: ''
            };

            // Parse GL requirements
            const glMatch = text.match(/general liability[^$]*?\$?([\d,]+(?:,\d{3})*)/gi);
            if (glMatch) {
                requirements.generalLiability.required = true;
                const amounts = text.match(/\$?([\d,]+(?:,\d{3})*)/g);
                if (amounts) {
                    const nums = amounts.map(a => parseInt(a.replace(/[$,]/g, '')));
                    requirements.generalLiability.perOccurrence = Math.max(...nums.filter(n => n >= 500000 && n <= 5000000));
                    requirements.generalLiability.aggregate = Math.max(...nums.filter(n => n >= 1000000));
                }
            }

            // Parse Auto requirements
            if (/auto/i.test(text)) {
                requirements.autoLiability.required = true;
                const autoMatch = text.match(/auto[^$]*?\$?([\d,]+(?:,\d{3})*)/i);
                if (autoMatch) {
                    requirements.autoLiability.limit = parseInt(autoMatch[1].replace(/[$,]/g, ''));
                }
            }

            // Parse Workers Comp
            if (/workers?\s*comp/i.test(text)) {
                requirements.workersComp.required = true;
                requirements.workersComp.statutory = /statutory/i.test(text);
                const empMatch = text.match(/employers?\s*liability[^$]*?\$?([\d,]+(?:,\d{3})*)/i);
                if (empMatch) {
                    requirements.workersComp.employersLiability = parseInt(empMatch[1].replace(/[$,]/g, ''));
                }
            }

            // Parse Umbrella
            if (/umbrella|excess/i.test(text)) {
                const umbrellaMatch = text.match(/umbrella|excess[^$]*?\$?([\d,]+(?:,\d{3})*)/i);
                if (umbrellaMatch) {
                    requirements.umbrella.required = true;
                    requirements.umbrella.limit = parseInt(umbrellaMatch[1].replace(/[$,]/g, ''));
                }
            }

            // Parse Pollution
            if (/pollution|environmental/i.test(text)) {
                requirements.pollution.required = true;
                const pollutionNums = text.match(/pollution|environmental[^$]*?\$?([\d,]+(?:,\d{3})*)[^$]*?\$?([\d,]+(?:,\d{3})*)/i);
                if (pollutionNums) {
                    requirements.pollution.perOccurrence = 5000000; // College Station requirement
                    requirements.pollution.aggregate = 10000000;
                }
            }

            // Parse additional requirements
            requirements.additionalInsured = /additional insured/i.test(text);
            requirements.waiverSubrogation = /waiver of subrogation/i.test(text);
            requirements.primaryNonContributory = /primary and non-contributory/i.test(text);
            
            const noticeMatch = text.match(/(\d+)\s*day.*notice/i);
            if (noticeMatch) {
                requirements.noticeCancellation = parseInt(noticeMatch[1]);
            }

            const ratingMatch = text.match(/A[-+]?\s*(?:VII|VI|V|IV|III|II|I|X|IX|VIII)?/);
            if (ratingMatch) {
                requirements.carrierRating = ratingMatch[0];
            }

            return requirements;
        }

        // Calculate compliance score
        function calculateCompliance(requirements) {
            let totalPoints = 0;
            let earnedPoints = 0;
            const gaps = [];

            // Check GL compliance
            if (requirements.generalLiability.required) {
                totalPoints += 20;
                if (currentCoverage.generalLiability.perOccurrence >= requirements.generalLiability.perOccurrence) {
                    earnedPoints += 10;
                } else {
                    gaps.push({
                        type: 'General Liability Limit',
                        required: requirements.generalLiability.perOccurrence,
                        current: currentCoverage.generalLiability.perOccurrence,
                        gap: requirements.generalLiability.perOccurrence - currentCoverage.generalLiability.perOccurrence
                    });
                }
                if (currentCoverage.generalLiability.aggregate >= requirements.generalLiability.aggregate) {
                    earnedPoints += 10;
                }
            }

            // Check Auto compliance
            if (requirements.autoLiability.required) {
                totalPoints += 15;
                if (currentCoverage.autoLiability.combinedLimit >= requirements.autoLiability.limit) {
                    earnedPoints += 15;
                } else {
                    gaps.push({
                        type: 'Auto Liability',
                        required: requirements.autoLiability.limit,
                        current: currentCoverage.autoLiability.combinedLimit,
                        gap: requirements.autoLiability.limit
                    });
                }
            }

            // Check Workers Comp
            if (requirements.workersComp.required) {
                totalPoints += 15;
                if (currentCoverage.workersComp.hasPolicy) {
                    earnedPoints += 10;
                    if (currentCoverage.workersComp.employersLiability >= requirements.workersComp.employersLiability) {
                        earnedPoints += 5;
                    }
                }
            }

            // Check Umbrella
            if (requirements.umbrella.required) {
                totalPoints += 20;
                if (currentCoverage.umbrella.limit >= requirements.umbrella.limit) {
                    earnedPoints += 20;
                } else {
                    gaps.push({
                        type: 'Umbrella Policy',
                        required: requirements.umbrella.limit,
                        current: 0,
                        gap: requirements.umbrella.limit
                    });
                }
            }

            // Check Pollution
            if (requirements.pollution.required) {
                totalPoints += 20;
                if (currentCoverage.pollution.perOccurrence >= requirements.pollution.perOccurrence) {
                    earnedPoints += 20;
                } else {
                    gaps.push({
                        type: 'Pollution Liability',
                        required: requirements.pollution.perOccurrence,
                        current: 0,
                        gap: requirements.pollution.perOccurrence,
                        critical: true
                    });
                }
            }

            // Check additional requirements
            if (requirements.additionalInsured) totalPoints += 5;
            if (requirements.waiverSubrogation) totalPoints += 5;

            const score = totalPoints > 0 ? Math.round((earnedPoints / totalPoints) * 100) : 0;

            return { score, gaps, totalPoints, earnedPoints };
        }

        // Display results
        function displayResults(requirements, compliance) {
            // Show results section
            document.getElementById('results').classList.add('active');

            // Animate compliance score
            setTimeout(() => {
                const progress = document.getElementById('score-progress');
                const offset = 502 - (502 * compliance.score / 100);
                progress.style.strokeDashoffset = offset;
                
                // Update score color
                if (compliance.score >= 80) {
                    progress.style.stroke = '#34C759';
                } else if (compliance.score >= 60) {
                    progress.style.stroke = '#FF9500';
                } else {
                    progress.style.stroke = '#FF3B30';
                }
                
                // Animate score number
                animateNumber('compliance-score', compliance.score, '%');
            }, 100);

            // Update compliance grid
            updateComplianceGrid(requirements);

            // Update requirements cards
            updateRequirementsGrid(requirements);

            // Update gap analysis
            updateGapAnalysis(compliance.gaps);

            // Update clauses
            updateClauses(requirements);

            // Update action plan
            updateActionPlan(compliance.gaps, requirements);

            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Update compliance grid
        function updateComplianceGrid(requirements) {
            const grid = document.getElementById('compliance-grid');
            grid.innerHTML = '';

            const items = [
                { name: 'GL Insurance', status: requirements.generalLiability.required ? (currentCoverage.generalLiability.perOccurrence >= requirements.generalLiability.perOccurrence ? 'met' : 'not-met') : 'na', icon: '🛡️' },
                { name: 'Auto Liability', status: requirements.autoLiability.required ? (currentCoverage.autoLiability.combinedLimit > 0 ? 'partial' : 'not-met') : 'na', icon: '🚚' },
                { name: 'Workers Comp', status: requirements.workersComp.required ? 'met' : 'na', icon: '👷' },
                { name: 'Umbrella', status: requirements.umbrella.required ? 'not-met' : 'na', icon: '☂️' },
                { name: 'Pollution', status: requirements.pollution.required ? 'not-met' : 'na', icon: '⚠️' },
                { name: 'Additional Insured', status: requirements.additionalInsured ? 'partial' : 'na', icon: '➕' }
            ];

            items.forEach(item => {
                if (item.status !== 'na') {
                    const div = document.createElement('div');
                    div.className = `compliance-item ${item.status}`;
                    div.innerHTML = `
                        <div class="compliance-icon">${item.icon}</div>
                        <div class="compliance-name">${item.name}</div>
                        <div class="compliance-status">${item.status === 'met' ? 'Compliant' : item.status === 'partial' ? 'Partial' : 'Gap'}</div>
                    `;
                    grid.appendChild(div);
                }
            });
        }

        // Update requirements grid
        function updateRequirementsGrid(requirements) {
            const grid = document.getElementById('requirements-grid');
            grid.innerHTML = '';

            if (requirements.generalLiability.required) {
                const card = createRequirementCard(
                    'General Liability',
                    'Protects against third-party claims for bodily injury and property damage.',
                    {
                        'Per Occurrence': '$' + requirements.generalLiability.perOccurrence.toLocaleString(),
                        'Aggregate': '$' + requirements.generalLiability.aggregate.toLocaleString(),
                        'Your Coverage': '$' + currentCoverage.generalLiability.perOccurrence.toLocaleString()
                    },
                    currentCoverage.generalLiability.perOccurrence >= requirements.generalLiability.perOccurrence ? 'recommended' : 'critical',
                    '#FF3B30'
                );
                grid.appendChild(card);
            }

            if (requirements.autoLiability.required) {
                const card = createRequirementCard(
                    'Commercial Auto',
                    'Covers vehicles used for business purposes.',
                    {
                        'Required Limit': '$' + requirements.autoLiability.limit.toLocaleString(),
                        'Your Coverage': currentCoverage.autoLiability.combinedLimit > 0 ? '$' + currentCoverage.autoLiability.combinedLimit.toLocaleString() : 'None'
                    },
                    'critical',
                    '#FF9500'
                );
                grid.appendChild(card);
            }

            if (requirements.pollution.required) {
                const card = createRequirementCard(
                    'Pollution Liability',
                    'Critical for College Station - covers environmental damage.',
                    {
                        'Per Occurrence': '$5,000,000',
                        'Aggregate': '$10,000,000',
                        'Your Coverage': 'None'
                    },
                    'critical',
                    '#AF52DE'
                );
                grid.appendChild(card);
            }
        }

        // Create requirement card
        function createRequirementCard(type, description, values, priority, color) {
            const card = document.createElement('div');
            card.className = 'requirement-card';
            card.style.setProperty('--req-color', color);
            
            let valuesHtml = '';
            for (const [label, amount] of Object.entries(values)) {
                valuesHtml += `
                    <div class="value-item">
                        <span class="value-label">${label}</span>
                        <span class="value-amount">${amount}</span>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="requirement-header">
                    <div class="requirement-type">${type}</div>
                    <div class="requirement-priority priority-${priority}">${priority}</div>
                </div>
                <div class="requirement-details">${description}</div>
                <div class="requirement-values">${valuesHtml}</div>
            `;
            
            return card;
        }

        // Update gap analysis
        function updateGapAnalysis(gaps) {
            const list = document.getElementById('gap-list');
            list.innerHTML = '';

            if (gaps.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #34C759;">✅ No critical gaps identified!</div>';
                return;
            }

            gaps.forEach(gap => {
                const item = document.createElement('div');
                item.className = 'gap-item';
                item.innerHTML = `
                    <div class="gap-icon">${gap.critical ? '🚨' : '⚠️'}</div>
                    <div class="gap-content">
                        <div class="gap-description">${gap.type}: Need $${gap.gap.toLocaleString()} more coverage</div>
                        <div class="gap-impact">Contract requires $${gap.required.toLocaleString()}, you have $${gap.current.toLocaleString()}</div>
                    </div>
                    <button class="gap-action" onclick="alert('Contact broker to add ${gap.type} coverage')">Fix Now</button>
                `;
                list.appendChild(item);
            });
        }

        // Update clauses
        function updateClauses(requirements) {
            const list = document.getElementById('clauses-list');
            list.innerHTML = '';

            const clauses = [];
            
            if (requirements.additionalInsured) {
                clauses.push({
                    type: 'Additional Insured',
                    text: 'Owner and General Contractor must be named as Additional Insureds on your policy.',
                    interpretation: 'This means if they get sued for something you did, your insurance covers them too. This is standard but increases your risk.'
                });
            }

            if (requirements.waiverSubrogation) {
                clauses.push({
                    type: 'Waiver of Subrogation',
                    text: 'Contractor waives all rights against Owner for recovery of damages.',
                    interpretation: 'Your insurance company cannot sue the owner to recover money they pay out on a claim, even if the owner was partially at fault.'
                });
            }

            if (requirements.primaryNonContributory) {
                clauses.push({
                    type: 'Primary & Non-Contributory',
                    text: 'Coverage shall be primary and non-contributory with any insurance maintained by Owner.',
                    interpretation: 'Your insurance pays first, before the owner\'s insurance, even if you\'re both at fault. This significantly increases your exposure.'
                });
            }

            clauses.forEach(clause => {
                const item = document.createElement('div');
                item.className = 'clause-item';
                item.innerHTML = `
                    <div class="clause-header">
                        <div class="clause-type">${clause.type}</div>
                        <div class="clause-tag">Important</div>
                    </div>
                    <div class="clause-text">"${clause.text}"</div>
                    <div class="clause-interpretation">
                        <div class="interpretation-label">What this means for you:</div>
                        <div class="interpretation-text">${clause.interpretation}</div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Update action plan
        function updateActionPlan(gaps, requirements) {
            const steps = document.getElementById('action-steps');
            steps.innerHTML = '';

            const actions = [
                {
                    title: 'Contact Insurance Broker',
                    description: 'Send this analysis to your broker and request quotes for missing coverage.',
                    deadline: 'Within 24 hours'
                },
                {
                    title: 'Secure Critical Coverage',
                    description: gaps.find(g => g.critical) ? 
                        `Priority: Add Pollution Liability ($5M/$10M) - College Station requirement!` :
                        'Add missing coverage based on contract requirements.',
                    deadline: 'Within 3 days'
                },
                {
                    title: 'Update Certificates',
                    description: 'Request updated certificates showing additional insureds and waiver of subrogation.',
                    deadline: 'Before contract signing'
                },
                {
                    title: 'Document Everything',
                    description: 'Keep copies of all insurance documents, certificates, and endorsements.',
                    deadline: 'Ongoing'
                }
            ];

            actions.forEach(action => {
                const step = document.createElement('div');
                step.className = 'action-step';
                step.innerHTML = `
                    <div class="step-dot"></div>
                    <div class="step-content">
                        <div class="step-title">${action.title}</div>
                        <div class="step-description">${action.description}</div>
                        <span class="step-deadline">${action.deadline}</span>
                    </div>
                `;
                steps.appendChild(step);
            });
        }

        // Animate number
        function animateNumber(elementId, target, suffix = '') {
            const element = document.getElementById(elementId);
            let current = 0;
            const increment = target / 30;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current) + suffix;
            }, 30);
        }

        // Initialize with a sample
        window.addEventListener('load', () => {
            // Auto-load government sample as it's most comprehensive
            loadSample('government');
        });
    </script>
</body>
</html>