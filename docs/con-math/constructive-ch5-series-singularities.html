<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Power Series & Singularities — Chapter 5</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@300;400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --taylor-blue: #3B82F6;
      --laurent-pink: #EC4899;
      --pole-amber: #F59E0B;
      --essential-red: #EF4444;
      --series-green: #22C55E;
      --background: #FAF8F5;
      --background-dark: #0F0F12;
      --ink: #1A1A1A;
      --ink-light: #FAF8F5;
      
      --display: 'Crimson Text', serif;
      --body: 'Source Sans Pro', sans-serif;
      --mono: 'JetBrains Mono', monospace;
      
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--body);
      background: var(--background);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .opening {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: linear-gradient(135deg, var(--taylor-blue) 0%, #2563EB 100%);
      color: var(--ink-light);
    }

    .opening-content {
      text-align: center;
      max-width: 800px;
    }

    .chapter-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.2s forwards;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.3s forwards;
    }

    .main-title {
      font-family: var(--display);
      font-size: clamp(2rem, 6vw, 3.5rem);
      font-weight: 400;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.4s forwards;
    }

    .subtitle {
      font-size: 1.15rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.6s forwards;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .narrative-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }

    .narrative-section.dark {
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .narrative-content {
      max-width: 650px;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
    }

    .narrative-content.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .narrative-content p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .math-display {
      font-family: var(--mono);
      font-size: 0.95rem;
      background: rgba(59, 130, 246, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 1.5rem 0;
      border-left: 3px solid var(--taylor-blue);
    }

    .dark .math-display {
      background: rgba(59, 130, 246, 0.15);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: #666;
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Taylor Series Section */
    .taylor-section {
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #F5F3F0 0%, var(--background) 100%);
    }

    .taylor-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .taylor-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .taylor-canvas-container {
      height: 350px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #taylorCanvas {
      width: 100%;
      height: 100%;
    }

    .taylor-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .control-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input[type="range"] {
      width: 150px;
      accent-color: var(--taylor-blue);
    }

    .slider-value {
      font-family: var(--mono);
      font-size: 0.9rem;
      min-width: 40px;
      color: var(--taylor-blue);
    }

    .taylor-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 700px) {
      .taylor-info { grid-template-columns: 1fr; }
    }

    .info-card {
      background: #FAFAFA;
      padding: 1.2rem;
      border-radius: 10px;
      text-align: center;
    }

    .info-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 0.3rem;
    }

    .info-value {
      font-family: var(--mono);
      font-size: 0.95rem;
    }

    /* Singularities Section */
    .sing-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .sing-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .sing-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .sing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 800px) {
      .sing-grid { grid-template-columns: 1fr; }
    }

    .sing-card {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .sing-card.removable {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid var(--series-green);
    }

    .sing-card.pole {
      background: rgba(245, 158, 11, 0.15);
      border: 2px solid var(--pole-amber);
    }

    .sing-card.essential {
      background: rgba(239, 68, 68, 0.15);
      border: 2px solid var(--essential-red);
    }

    .sing-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .sing-title {
      font-family: var(--display);
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .sing-example {
      font-family: var(--mono);
      font-size: 0.85rem;
      color: #9CA3AF;
      margin-bottom: 0.5rem;
    }

    .sing-desc {
      font-size: 0.85rem;
      color: #9CA3AF;
    }

    /* Laurent Series Section */
    .laurent-section {
      padding: 4rem 2rem;
      background: var(--background);
    }

    .laurent-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .laurent-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .laurent-canvas-container {
      height: 300px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #laurentCanvas {
      width: 100%;
      height: 100%;
    }

    .laurent-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .laurent-btn {
      padding: 0.8rem 1.2rem;
      border: 2px solid var(--laurent-pink);
      border-radius: 8px;
      background: transparent;
      color: var(--laurent-pink);
      font-family: var(--mono);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .laurent-btn:hover {
      background: rgba(236, 72, 153, 0.15);
    }

    .laurent-btn.active {
      background: var(--laurent-pink);
      color: white;
    }

    .laurent-formula {
      background: rgba(236, 72, 153, 0.1);
      padding: 1.5rem;
      border-radius: 12px;
      border-left: 3px solid var(--laurent-pink);
      text-align: center;
    }

    .laurent-formula p {
      font-family: var(--mono);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .laurent-formula p:last-child { margin-bottom: 0; }

    /* Picard Section */
    .picard-section {
      min-height: 80vh;
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #1A1A20 0%, var(--background-dark) 100%);
      color: var(--ink-light);
    }

    .picard-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .picard-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .picard-theorem {
      background: rgba(239, 68, 68, 0.15);
      border: 2px solid var(--essential-red);
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .picard-theorem h3 {
      font-family: var(--display);
      font-size: 1.4rem;
      color: var(--essential-red);
      margin-bottom: 1rem;
    }

    .picard-theorem p {
      font-size: 1rem;
      color: #9CA3AF;
    }

    .picard-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 600px) {
      .picard-comparison { grid-template-columns: 1fr; }
    }

    .picard-card {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .picard-card.pole {
      background: rgba(245, 158, 11, 0.1);
      border: 2px solid var(--pole-amber);
    }

    .picard-card.essential {
      background: rgba(239, 68, 68, 0.1);
      border: 2px solid var(--essential-red);
    }

    .picard-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #9CA3AF;
      margin-bottom: 0.5rem;
    }

    .picard-behavior {
      font-size: 0.95rem;
      color: var(--ink-light);
    }

    /* Navigation */
    .next-section {
      padding: 4rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--taylor-blue) 0%, #2563EB 100%);
      color: var(--ink-light);
      text-align: center;
    }

    .next-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .next-title {
      font-family: var(--display);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .next-description {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 500px;
    }
  </style>
</head>
<body>

  <!-- Opening -->
  <section class="opening">
    <div class="opening-content">
      <p class="chapter-label">Chapter 5: Complex Analysis</p>
      <p class="section-label">Sections 5 & 6: Series and Singularities</p>
      <h1 class="main-title">Power Series & Singularities</h1>
      <p class="subtitle">Analytic functions equal their Taylor series. Near singularities, behavior ranges from tame (poles) to wild (essential).</p>
    </div>
  </section>

  <!-- Narrative: Taylor Series -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>Every differentiable function has a <strong>Taylor series</strong> that converges to it:</p>
      <div class="math-display">
        <strong>Theorem 4.15:</strong><br><br>
        f(z) = Σ_{n=0}^∞ aₙ(z - z₀)ⁿ<br><br>
        where aₙ = f⁽ⁿ⁾(z₀)/n!
      </div>
      <p>The series converges on the largest disk centered at z₀ contained in the domain of f.</p>
    </div>
  </section>

  <!-- Taylor Series Visualization -->
  <section class="taylor-section">
    <div class="section-header">
      <h2 class="section-title">Taylor Series Convergence</h2>
      <p class="section-subtitle">Watch partial sums approach the function exp(z)</p>
    </div>

    <div class="taylor-container">
      <div class="taylor-panel">
        <div class="taylor-canvas-container">
          <canvas id="taylorCanvas"></canvas>
        </div>

        <div class="taylor-controls">
          <div class="control-group">
            <span class="control-label">Number of terms N</span>
            <div class="slider-container">
              <input type="range" id="termsSlider" min="1" max="15" step="1" value="5">
              <span class="slider-value" id="termsValue">5</span>
            </div>
          </div>
        </div>

        <div class="taylor-info">
          <div class="info-card">
            <p class="info-label">Function</p>
            <p class="info-value" style="color: var(--taylor-blue);">exp(z)</p>
          </div>
          <div class="info-card">
            <p class="info-label">Partial Sum</p>
            <p class="info-value" id="partialSum" style="color: var(--series-green);">Σ zⁿ/n!</p>
          </div>
          <div class="info-card">
            <p class="info-label">Convergence</p>
            <p class="info-value" id="convergence" style="color: var(--pole-amber);">Entire plane</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Singularities -->
  <section class="sing-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Types of Singularities</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">What happens when f is not defined at z₀?</p>
    </div>

    <div class="sing-container">
      <div class="sing-panel">
        <div class="sing-grid">
          <div class="sing-card removable">
            <div class="sing-icon" style="color: var(--series-green);">◦</div>
            <h3 class="sing-title" style="color: var(--series-green);">Removable</h3>
            <p class="sing-example">sin(z)/z at z = 0</p>
            <p class="sing-desc">Can be filled in continuously. All negative Laurent coefficients vanish.</p>
          </div>
          <div class="sing-card pole">
            <div class="sing-icon" style="color: var(--pole-amber);">∞</div>
            <h3 class="sing-title" style="color: var(--pole-amber);">Pole</h3>
            <p class="sing-example">1/z² at z = 0</p>
            <p class="sing-desc">|f(z)| → ∞ as z → z₀. Finitely many negative powers in Laurent series.</p>
          </div>
          <div class="sing-card essential">
            <div class="sing-icon" style="color: var(--essential-red);">?</div>
            <h3 class="sing-title" style="color: var(--essential-red);">Essential</h3>
            <p class="sing-example">exp(1/z) at z = 0</p>
            <p class="sing-desc">Wild behavior! Infinitely many negative powers. Takes almost all values.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Laurent Series -->
  <section class="laurent-section">
    <div class="section-header">
      <h2 class="section-title">Laurent Series</h2>
      <p class="section-subtitle">Power series with negative powers for annuli</p>
    </div>

    <div class="laurent-container">
      <div class="laurent-panel">
        <div class="laurent-canvas-container">
          <canvas id="laurentCanvas"></canvas>
        </div>

        <div class="laurent-controls">
          <button class="laurent-btn active" data-func="1/z">1/z (pole order 1)</button>
          <button class="laurent-btn" data-func="1/z2">1/z² (pole order 2)</button>
          <button class="laurent-btn" data-func="exp1/z">exp(1/z) (essential)</button>
        </div>

        <div class="laurent-formula">
          <p><strong>Theorem 6.2:</strong> In an annulus { r₁ < |z - z₀| < r₂ },</p>
          <p>f(z) = Σ_{n=-∞}^∞ aₙ(z - z₀)ⁿ</p>
          <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">Negative powers describe behavior near z₀</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Picard's Theorem -->
  <section class="picard-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Picard's Theorem</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">Essential singularities have dramatic behavior</p>
    </div>

    <div class="picard-container">
      <div class="picard-panel">
        <div class="picard-theorem">
          <h3>Theorem 6.21 (Picard)</h3>
          <p>Near an essential singularity, a differentiable function takes every complex value, with at most <em>one</em> exception.</p>
        </div>

        <div class="picard-comparison">
          <div class="picard-card pole">
            <p class="picard-label" style="color: var(--pole-amber);">Near a Pole</p>
            <p class="picard-behavior">|f(z)| → ∞<br>Misses neighborhood of 0</p>
          </div>
          <div class="picard-card essential">
            <p class="picard-label" style="color: var(--essential-red);">Near Essential Singularity</p>
            <p class="picard-behavior">f takes almost ALL values!<br>Arbitrarily often, in any neighborhood</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: FTA -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>The <strong>Fundamental Theorem of Algebra</strong> follows constructively:</p>
      <div class="math-display">
        <strong>Theorem 5.10:</strong><br><br>
        If p(z) = a₀zⁿ + a₁zⁿ⁻¹ + ... + aₙ has degree ≥ k,<br>
        then p has at least k roots (counting multiplicity).
      </div>
      <p>The proof uses the maximum principle and careful estimates to <em>locate</em> zeros constructively.</p>
    </div>
  </section>

  <!-- Navigation -->
  <section class="next-section">
    <p class="next-label">Chapter 5 Complete</p>
    <h3 class="next-title">Complex Analysis Mastered</h3>
    <p class="next-description">From the geometry of i through Cauchy's formula to singularities and power series. The foundations of analytic function theory.</p>
  </section>

  <script>
    // Scroll animations
    const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -10% 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, observerOptions);
    document.querySelectorAll('[data-animate], .narrative-content').forEach(el => observer.observe(el));

    function setupCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      return { ctx, width: rect.width, height: rect.height };
    }

    // ============================================
    // TAYLOR SERIES VISUALIZATION
    // ============================================
    
    const taylorCanvas = document.getElementById('taylorCanvas');
    let numTerms = 5;

    function factorial(n) {
      if (n <= 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) result *= i;
      return result;
    }

    function expTaylor(x, n) {
      let sum = 0;
      for (let k = 0; k <= n; k++) {
        sum += Math.pow(x, k) / factorial(k);
      }
      return sum;
    }

    function drawTaylor() {
      const { ctx, width, height } = setupCanvas(taylorCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      const scaleX = width / 8;
      const scaleY = height / 6;

      // Grid
      ctx.strokeStyle = '#E5E5E5';
      ctx.lineWidth = 1;
      for (let i = -4; i <= 4; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX + i * scaleX, 0);
        ctx.lineTo(centerX + i * scaleX, height);
        ctx.stroke();
      }
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(0, centerY - i * scaleY);
        ctx.lineTo(width, centerY - i * scaleY);
        ctx.stroke();
      }

      // Axes
      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, centerY);
      ctx.lineTo(width, centerY);
      ctx.moveTo(centerX, 0);
      ctx.lineTo(centerX, height);
      ctx.stroke();

      // True function exp(x)
      ctx.strokeStyle = '#3B82F6';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let px = 0; px <= width; px++) {
        const x = (px - centerX) / scaleX;
        const y = Math.exp(x);
        const py = centerY - y * scaleY;
        if (px === 0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.stroke();

      // Taylor approximation
      ctx.strokeStyle = '#22C55E';
      ctx.lineWidth = 3;
      ctx.setLineDash([6, 4]);
      ctx.beginPath();
      for (let px = 0; px <= width; px++) {
        const x = (px - centerX) / scaleX;
        const y = expTaylor(x, numTerms);
        const py = centerY - y * scaleY;
        if (py < 0 || py > height) continue;
        if (px === 0 || !isFinite(py)) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.stroke();
      ctx.setLineDash([]);

      // Labels
      ctx.fillStyle = '#3B82F6';
      ctx.font = '12px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText('exp(x)', width - 60, 30);

      ctx.fillStyle = '#22C55E';
      ctx.fillText(`Sₙ(x)`, width - 60, 50);

      // Update info
      document.getElementById('partialSum').textContent = `Σ zⁿ/n! (N=${numTerms})`;
    }

    document.getElementById('termsSlider').addEventListener('input', (e) => {
      numTerms = parseInt(e.target.value);
      document.getElementById('termsValue').textContent = numTerms;
      drawTaylor();
    });

    // ============================================
    // LAURENT SERIES VISUALIZATION
    // ============================================
    
    const laurentCanvas = document.getElementById('laurentCanvas');
    let currentFunc = '1/z';

    const funcInfo = {
      '1/z': {
        name: '1/z',
        laurent: 'z⁻¹',
        type: 'Simple pole'
      },
      '1/z2': {
        name: '1/z²',
        laurent: 'z⁻²',
        type: 'Pole of order 2'
      },
      'exp1/z': {
        name: 'exp(1/z)',
        laurent: 'Σ z⁻ⁿ/n!',
        type: 'Essential singularity'
      }
    };

    function drawLaurent() {
      const { ctx, width, height } = setupCanvas(laurentCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      const scale = Math.min(width, height) / 5;

      // Grid
      ctx.strokeStyle = '#E5E5E5';
      ctx.lineWidth = 1;
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX + i * scale, 0);
        ctx.lineTo(centerX + i * scale, height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, centerY - i * scale);
        ctx.lineTo(width, centerY - i * scale);
        ctx.stroke();
      }

      // Axes
      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, centerY);
      ctx.lineTo(width, centerY);
      ctx.moveTo(centerX, 0);
      ctx.lineTo(centerX, height);
      ctx.stroke();

      // Annulus for Laurent series (show inner and outer circles)
      const r1 = 0.5, r2 = 2;
      
      ctx.strokeStyle = 'rgba(236, 72, 153, 0.5)';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.arc(centerX, centerY, r1 * scale, 0, Math.PI * 2);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(centerX, centerY, r2 * scale, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);

      // Fill annulus
      ctx.fillStyle = 'rgba(236, 72, 153, 0.1)';
      ctx.beginPath();
      ctx.arc(centerX, centerY, r2 * scale, 0, Math.PI * 2);
      ctx.arc(centerX, centerY, r1 * scale, 0, Math.PI * 2, true);
      ctx.fill();

      // Singularity at origin
      const singColor = currentFunc === 'exp1/z' ? '#EF4444' : '#F59E0B';
      ctx.fillStyle = singColor;
      ctx.beginPath();
      ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'white';
      ctx.font = 'bold 10px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('×', centerX, centerY + 4);

      // Labels
      ctx.fillStyle = '#EC4899';
      ctx.font = '11px "JetBrains Mono"';
      ctx.fillText('Annulus: r₁ < |z| < r₂', centerX, height - 20);

      ctx.fillStyle = singColor;
      ctx.fillText(funcInfo[currentFunc].type, centerX, 25);
    }

    document.querySelectorAll('.laurent-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.laurent-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFunc = btn.dataset.func;
        drawLaurent();
      });
    });

    // Initialize
    drawTaylor();
    drawLaurent();

    window.addEventListener('resize', () => {
      drawTaylor();
      drawLaurent();
    });
  </script>
</body>
</html>
