<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Integrable Sets & Measurable Functions — Chapter 6</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@300;400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --interior-green: #22C55E;
      --exterior-red: #EF4444;
      --boundary-amber: #F59E0B;
      --simple-purple: #8B5CF6;
      --measure-blue: #3B82F6;
      --background: #FAF8F5;
      --background-dark: #0F0F12;
      --ink: #1A1A1A;
      --ink-light: #FAF8F5;
      
      --display: 'Crimson Text', serif;
      --body: 'Source Sans Pro', sans-serif;
      --mono: 'JetBrains Mono', monospace;
      
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--body);
      background: var(--background);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .opening {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: linear-gradient(135deg, var(--interior-green) 0%, #16A34A 100%);
      color: var(--ink-light);
    }

    .opening-content {
      text-align: center;
      max-width: 800px;
    }

    .chapter-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.2s forwards;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.3s forwards;
    }

    .main-title {
      font-family: var(--display);
      font-size: clamp(2rem, 6vw, 3.5rem);
      font-weight: 400;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.4s forwards;
    }

    .subtitle {
      font-size: 1.15rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.6s forwards;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .narrative-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }

    .narrative-section.dark {
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .narrative-content {
      max-width: 650px;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
    }

    .narrative-content.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .narrative-content p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .math-display {
      font-family: var(--mono);
      font-size: 0.9rem;
      background: rgba(34, 197, 94, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: left;
      margin: 1.5rem 0;
      border-left: 3px solid var(--interior-green);
    }

    .dark .math-display {
      background: rgba(34, 197, 94, 0.15);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: #666;
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Complemented Set Section */
    .comp-section {
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #F5F3F0 0%, var(--background) 100%);
    }

    .comp-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .comp-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .comp-canvas-container {
      height: 350px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #compCanvas {
      width: 100%;
      height: 100%;
    }

    .comp-legend {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: var(--mono);
      font-size: 0.85rem;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }

    .comp-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 700px) {
      .comp-info { grid-template-columns: 1fr; }
    }

    .info-card {
      background: #FAFAFA;
      padding: 1.2rem;
      border-radius: 10px;
      text-align: center;
    }

    .info-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 0.3rem;
    }

    .info-value {
      font-family: var(--mono);
      font-size: 1rem;
    }

    /* Characteristic Function Section */
    .char-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .char-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .char-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .char-canvas-container {
      height: 300px;
      margin-bottom: 1.5rem;
    }

    #charCanvas {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #0A0A0F;
    }

    .char-formula {
      text-align: center;
      padding: 1.5rem;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 12px;
      border: 2px solid var(--measure-blue);
    }

    .char-formula p {
      font-family: var(--mono);
      font-size: 1.1rem;
      color: var(--measure-blue);
      margin-bottom: 0.5rem;
    }

    .char-formula p:last-child { margin-bottom: 0; }

    /* Simple Functions Section */
    .simple-section {
      padding: 4rem 2rem;
      background: var(--background);
    }

    .simple-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .simple-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .simple-canvas-container {
      height: 300px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #simpleCanvas {
      width: 100%;
      height: 100%;
    }

    .simple-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .control-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input[type="range"] {
      width: 150px;
      accent-color: var(--simple-purple);
    }

    .slider-value {
      font-family: var(--mono);
      font-size: 0.9rem;
      min-width: 40px;
      color: var(--simple-purple);
    }

    .simple-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    @media (max-width: 600px) {
      .simple-info { grid-template-columns: 1fr; }
    }

    /* Measurable Functions Section */
    .meas-section {
      min-height: 80vh;
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #1A1A20 0%, var(--background-dark) 100%);
      color: var(--ink-light);
    }

    .meas-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .meas-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .meas-definition {
      background: rgba(139, 92, 246, 0.15);
      border: 2px solid var(--simple-purple);
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    .meas-definition h3 {
      font-family: var(--display);
      font-size: 1.3rem;
      color: var(--simple-purple);
      margin-bottom: 0.5rem;
    }

    .meas-definition p {
      font-size: 0.95rem;
      color: #9CA3AF;
    }

    .meas-theorem {
      background: rgba(245, 158, 11, 0.15);
      border: 2px solid var(--boundary-amber);
      padding: 1.5rem;
      border-radius: 12px;
    }

    .meas-theorem h3 {
      font-family: var(--display);
      font-size: 1.2rem;
      color: var(--boundary-amber);
      margin-bottom: 0.5rem;
    }

    .meas-theorem p {
      font-size: 0.95rem;
      color: #9CA3AF;
    }

    /* Navigation */
    .next-section {
      padding: 4rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--interior-green) 0%, #16A34A 100%);
      color: var(--ink-light);
      text-align: center;
    }

    .next-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .next-title {
      font-family: var(--display);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .next-description {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 500px;
    }
  </style>
</head>
<body>

  <!-- Opening -->
  <section class="opening">
    <div class="opening-content">
      <p class="chapter-label">Chapter 6: Integration</p>
      <p class="section-label">Sections 3 & 7: Integrable Sets</p>
      <h1 class="main-title">Complemented Sets & Simple Functions</h1>
      <p class="subtitle">A set is integrable when its characteristic function is. Simple functions — finite sums of characteristic functions — approximate all measurable functions.</p>
    </div>
  </section>

  <!-- Narrative: Complemented Sets -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>In constructive analysis, a set A needs explicit information about both what's <em>in</em> A and what's <em>out</em> of A.</p>
      <div class="math-display">
        <strong>Definition:</strong> A <em>complemented set</em> is a pair<br><br>
        A = (A¹, A⁰)<br><br>
        where A¹ = "interior" (definitely in A)<br>
        and A⁰ = "exterior" (definitely not in A)
      </div>
      <p>The <strong>characteristic function</strong> χ_A takes value 1 on A¹, value 0 on A⁰, and is undefined elsewhere.</p>
    </div>
  </section>

  <!-- Complemented Set Visualization -->
  <section class="comp-section">
    <div class="section-header">
      <h2 class="section-title">Complemented Sets in the Plane</h2>
      <p class="section-subtitle">Interior A¹, exterior A⁰, and the undecided region</p>
    </div>

    <div class="comp-container">
      <div class="comp-panel">
        <div class="comp-canvas-container">
          <canvas id="compCanvas"></canvas>
        </div>

        <div class="comp-legend">
          <div class="legend-item">
            <div class="legend-color" style="background: var(--interior-green);"></div>
            <span>A¹ (Interior)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: var(--exterior-red);"></div>
            <span>A⁰ (Exterior)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: var(--boundary-amber);"></div>
            <span>Undecided</span>
          </div>
        </div>

        <div class="comp-info">
          <div class="info-card">
            <p class="info-label">χ_A on A¹</p>
            <p class="info-value" style="color: var(--interior-green);">1</p>
          </div>
          <div class="info-card">
            <p class="info-label">χ_A on A⁰</p>
            <p class="info-value" style="color: var(--exterior-red);">0</p>
          </div>
          <div class="info-card">
            <p class="info-label">χ_A elsewhere</p>
            <p class="info-value" style="color: var(--boundary-amber);">undefined</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Characteristic Function -->
  <section class="char-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Measure of an Integrable Set</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">μ(A) = I(χ_A) when χ_A is integrable</p>
    </div>

    <div class="char-container">
      <div class="char-panel">
        <div class="char-canvas-container">
          <canvas id="charCanvas"></canvas>
        </div>

        <div class="char-formula">
          <p><strong>Definition 3.2:</strong> μ(A) = I(χ_A)</p>
          <p style="font-size: 0.9rem; color: #9CA3AF;">The measure is the integral of the characteristic function</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Simple Functions -->
  <section class="simple-section">
    <div class="section-header">
      <h2 class="section-title">Simple Functions</h2>
      <p class="section-subtitle">Finite linear combinations of characteristic functions</p>
    </div>

    <div class="simple-container">
      <div class="simple-panel">
        <div class="simple-canvas-container">
          <canvas id="simpleCanvas"></canvas>
        </div>

        <div class="simple-controls">
          <div class="control-group">
            <span class="control-label">Number of Steps</span>
            <div class="slider-container">
              <input type="range" id="stepsSlider" min="2" max="10" step="1" value="4">
              <span class="slider-value" id="stepsValue">4</span>
            </div>
          </div>
        </div>

        <div class="simple-info">
          <div class="info-card">
            <p class="info-label">Simple Function</p>
            <p class="info-value" style="color: var(--simple-purple);">Σ cᵢ χ_Aᵢ</p>
          </div>
          <div class="info-card">
            <p class="info-label">Integral</p>
            <p class="info-value" id="simpleIntegral" style="color: var(--measure-blue);">—</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Measurable Functions -->
  <section class="meas-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Measurable Functions</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">Limits of simple functions</p>
    </div>

    <div class="meas-container">
      <div class="meas-panel">
        <div class="meas-definition">
          <h3>Definition 7.1</h3>
          <p>A function f is <strong>measurable</strong> if for each integrable set A and each ε > 0, there exists an integrable set B with B¹ ⊆ A¹ and μ(A - B) < ε, such that f is uniformly continuous on B¹.</p>
        </div>

        <div class="meas-theorem">
          <h3>Lemma 7.5</h3>
          <p>Let f be a nonnegative, bounded, measurable function. Then there exists an increasing sequence (xₙ) of nonnegative simple functions converging to f almost uniformly.</p>
          <p style="margin-top: 0.5rem;"><em>Simple functions approximate measurable ones from below.</em></p>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: Products -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>Measurable functions form an algebra:</p>
      <div class="math-display">
        <strong>Theorem 7.11:</strong><br><br>
        If f and g are measurable functions, then:<br>
        • f + g is measurable<br>
        • f · g is measurable<br>
        • |f| is measurable<br>
        • max(f, g) and min(f, g) are measurable
      </div>
      <p>The class of measurable functions is closed under the operations we care about.</p>
    </div>
  </section>

  <!-- Navigation -->
  <section class="next-section">
    <p class="next-label">Coming Next</p>
    <h3 class="next-title">Convergence Theorems & Fubini</h3>
    <p class="next-description">Monotone and dominated convergence. Product integrals and iterated integration.</p>
  </section>

  <script>
    // Scroll animations
    const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -10% 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, observerOptions);
    document.querySelectorAll('[data-animate], .narrative-content').forEach(el => observer.observe(el));

    function setupCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      return { ctx, width: rect.width, height: rect.height };
    }

    // ============================================
    // COMPLEMENTED SET VISUALIZATION
    // ============================================
    
    const compCanvas = document.getElementById('compCanvas');

    function drawComp() {
      const { ctx, width, height } = setupCanvas(compCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      const outerR = Math.min(width, height) * 0.35;
      const innerR = outerR * 0.7;
      const boundaryW = outerR * 0.15;

      // Exterior (entire canvas except set)
      ctx.fillStyle = 'rgba(239, 68, 68, 0.2)';
      ctx.fillRect(0, 0, width, height);

      // Boundary region (ring)
      ctx.fillStyle = 'rgba(245, 158, 11, 0.4)';
      ctx.beginPath();
      ctx.arc(centerX, centerY, outerR, 0, Math.PI * 2);
      ctx.fill();

      // Interior
      ctx.fillStyle = 'rgba(34, 197, 94, 0.4)';
      ctx.beginPath();
      ctx.arc(centerX, centerY, innerR, 0, Math.PI * 2);
      ctx.fill();

      // Draw circles
      ctx.strokeStyle = var(--interior-green);
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(centerX, centerY, innerR, 0, Math.PI * 2);
      ctx.stroke();

      ctx.strokeStyle = '#F59E0B';
      ctx.setLineDash([6, 4]);
      ctx.beginPath();
      ctx.arc(centerX, centerY, outerR, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);

      // Labels
      ctx.fillStyle = '#22C55E';
      ctx.font = 'bold 14px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('A¹', centerX, centerY);

      ctx.fillStyle = '#F59E0B';
      ctx.fillText('?', centerX + innerR + boundaryW / 2, centerY);

      ctx.fillStyle = '#EF4444';
      ctx.fillText('A⁰', centerX + outerR + 30, centerY);
    }

    // ============================================
    // CHARACTERISTIC FUNCTION VISUALIZATION
    // ============================================
    
    const charCanvas = document.getElementById('charCanvas');

    function drawChar() {
      const { ctx, width, height } = setupCanvas(charCanvas);

      ctx.fillStyle = '#0A0A0F';
      ctx.fillRect(0, 0, width, height);

      const marginX = 60, marginY = 40;
      const plotW = width - 2 * marginX;
      const plotH = height - 2 * marginY;

      // Axes
      ctx.strokeStyle = '#444';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(marginX, marginY);
      ctx.lineTo(marginX, height - marginY);
      ctx.lineTo(width - marginX, height - marginY);
      ctx.stroke();

      // Grid lines
      ctx.strokeStyle = '#222';
      ctx.lineWidth = 1;
      const yMid = marginY + plotH / 2;
      ctx.beginPath();
      ctx.moveTo(marginX, yMid);
      ctx.lineTo(width - marginX, yMid);
      ctx.stroke();

      // Set A = [1, 3] on interval [0, 4]
      const xRange = [0, 4];
      const yRange = [-0.2, 1.4];

      function toPixelX(x) {
        return marginX + (x - xRange[0]) / (xRange[1] - xRange[0]) * plotW;
      }
      function toPixelY(y) {
        return height - marginY - (y - yRange[0]) / (yRange[1] - yRange[0]) * plotH;
      }

      // Draw characteristic function
      // χ_A = 1 on [1, 3], 0 elsewhere

      // Fill under curve
      ctx.fillStyle = 'rgba(34, 197, 94, 0.3)';
      ctx.fillRect(toPixelX(1), toPixelY(1), toPixelX(3) - toPixelX(1), toPixelY(0) - toPixelY(1));

      // Draw step
      ctx.strokeStyle = '#22C55E';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(toPixelX(0), toPixelY(0));
      ctx.lineTo(toPixelX(1), toPixelY(0));
      ctx.lineTo(toPixelX(1), toPixelY(1));
      ctx.lineTo(toPixelX(3), toPixelY(1));
      ctx.lineTo(toPixelX(3), toPixelY(0));
      ctx.lineTo(toPixelX(4), toPixelY(0));
      ctx.stroke();

      // Labels
      ctx.fillStyle = '#888';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('0', toPixelX(0), height - marginY + 20);
      ctx.fillText('1', toPixelX(1), height - marginY + 20);
      ctx.fillText('3', toPixelX(3), height - marginY + 20);
      ctx.fillText('4', toPixelX(4), height - marginY + 20);

      ctx.textAlign = 'right';
      ctx.fillText('0', marginX - 10, toPixelY(0) + 4);
      ctx.fillText('1', marginX - 10, toPixelY(1) + 4);

      // Function label
      ctx.fillStyle = '#22C55E';
      ctx.font = '12px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText('χ_A (A = [1,3])', marginX + 10, marginY + 20);

      // Measure annotation
      ctx.fillStyle = '#3B82F6';
      ctx.fillText('μ(A) = 2', toPixelX(2), toPixelY(1) - 15);
    }

    // ============================================
    // SIMPLE FUNCTIONS VISUALIZATION
    // ============================================
    
    const simpleCanvas = document.getElementById('simpleCanvas');
    let numSteps = 4;

    function drawSimple() {
      const { ctx, width, height } = setupCanvas(simpleCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const marginX = 60, marginY = 40;
      const plotW = width - 2 * marginX;
      const plotH = height - 2 * marginY;

      // Axes
      ctx.strokeStyle = '#CCC';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(marginX, marginY);
      ctx.lineTo(marginX, height - marginY);
      ctx.lineTo(width - marginX, height - marginY);
      ctx.stroke();

      const xRange = [0, 1];
      const yRange = [0, 1.2];

      function toPixelX(x) {
        return marginX + (x - xRange[0]) / (xRange[1] - xRange[0]) * plotW;
      }
      function toPixelY(y) {
        return height - marginY - (y - yRange[0]) / (yRange[1] - yRange[0]) * plotH;
      }

      // Target function: x²
      function target(x) {
        return x * x;
      }

      // Draw target
      ctx.strokeStyle = 'rgba(139, 92, 246, 0.3)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let px = 0; px <= plotW; px++) {
        const x = xRange[0] + px / plotW * (xRange[1] - xRange[0]);
        const y = target(x);
        if (px === 0) ctx.moveTo(toPixelX(x), toPixelY(y));
        else ctx.lineTo(toPixelX(x), toPixelY(y));
      }
      ctx.stroke();

      // Draw simple function approximation (step function)
      const stepW = 1 / numSteps;
      let integral = 0;

      ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
      ctx.strokeStyle = '#8B5CF6';
      ctx.lineWidth = 2;
      
      for (let i = 0; i < numSteps; i++) {
        const x0 = i * stepW;
        const x1 = (i + 1) * stepW;
        const y = target(x0); // Lower sum
        
        integral += y * stepW;

        // Fill
        ctx.fillRect(toPixelX(x0), toPixelY(y), toPixelX(x1) - toPixelX(x0), toPixelY(0) - toPixelY(y));

        // Outline
        ctx.beginPath();
        ctx.moveTo(toPixelX(x0), toPixelY(0));
        ctx.lineTo(toPixelX(x0), toPixelY(y));
        ctx.lineTo(toPixelX(x1), toPixelY(y));
        ctx.lineTo(toPixelX(x1), toPixelY(0));
        ctx.stroke();
      }

      // Labels
      ctx.fillStyle = '#888';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('0', toPixelX(0), height - marginY + 20);
      ctx.fillText('1', toPixelX(1), height - marginY + 20);

      // Legend
      ctx.fillStyle = '#8B5CF6';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText('f(x) = x²', marginX + 10, marginY + 20);
      ctx.fillText(`Simple (${numSteps} steps)`, marginX + 10, marginY + 40);

      document.getElementById('simpleIntegral').textContent = integral.toFixed(4);
    }

    document.getElementById('stepsSlider').addEventListener('input', (e) => {
      numSteps = parseInt(e.target.value);
      document.getElementById('stepsValue').textContent = numSteps;
      drawSimple();
    });

    // Initialize
    drawComp();
    drawChar();
    drawSimple();

    window.addEventListener('resize', () => {
      drawComp();
      drawChar();
      drawSimple();
    });
  </script>
</body>
</html>
