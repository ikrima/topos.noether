<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Complex Plane & Differentiation — Chapter 5</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@300;400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --complex-blue: #3B82F6;
      --real-green: #22C55E;
      --imag-pink: #EC4899;
      --exp-amber: #F59E0B;
      --conjugate-purple: #8B5CF6;
      --background: #FAF8F5;
      --background-dark: #0F0F12;
      --ink: #1A1A1A;
      --ink-light: #FAF8F5;
      
      --display: 'Crimson Text', serif;
      --body: 'Source Sans Pro', sans-serif;
      --mono: 'JetBrains Mono', monospace;
      
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--body);
      background: var(--background);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .opening {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: linear-gradient(135deg, var(--complex-blue) 0%, #1D4ED8 100%);
      color: var(--ink-light);
    }

    .opening-content {
      text-align: center;
      max-width: 800px;
    }

    .chapter-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.2s forwards;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.3s forwards;
    }

    .main-title {
      font-family: var(--display);
      font-size: clamp(2rem, 6vw, 3.5rem);
      font-weight: 400;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.4s forwards;
    }

    .subtitle {
      font-size: 1.15rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.6s forwards;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .narrative-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }

    .narrative-section.dark {
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .narrative-content {
      max-width: 650px;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
    }

    .narrative-content.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .narrative-content p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .math-display {
      font-family: var(--mono);
      font-size: 0.95rem;
      background: rgba(59, 130, 246, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 1.5rem 0;
      border-left: 3px solid var(--complex-blue);
    }

    .dark .math-display {
      background: rgba(59, 130, 246, 0.15);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: #666;
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Complex Plane Section */
    .plane-section {
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #F5F3F0 0%, var(--background) 100%);
    }

    .plane-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .plane-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .plane-canvas-container {
      height: 400px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      cursor: crosshair;
    }

    #planeCanvas {
      width: 100%;
      height: 100%;
    }

    .plane-info {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    @media (max-width: 700px) {
      .plane-info { grid-template-columns: repeat(2, 1fr); }
    }

    .info-card {
      background: #FAFAFA;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .info-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 0.3rem;
    }

    .info-value {
      font-family: var(--mono);
      font-size: 0.95rem;
    }

    /* Multiplication Section */
    .mult-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .mult-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .mult-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .mult-canvas-container {
      height: 350px;
      margin-bottom: 1.5rem;
    }

    #multCanvas {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #0A0A0F;
    }

    .mult-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 700px) {
      .mult-info { grid-template-columns: 1fr; }
    }

    .mult-card {
      background: rgba(20, 20, 30, 0.5);
      padding: 1.2rem;
      border-radius: 10px;
      text-align: center;
    }

    .mult-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #9CA3AF;
      margin-bottom: 0.3rem;
    }

    .mult-value {
      font-family: var(--mono);
      font-size: 0.95rem;
    }

    .mult-explanation {
      background: rgba(59, 130, 246, 0.1);
      padding: 1.5rem;
      border-radius: 12px;
      border-left: 3px solid var(--complex-blue);
      margin-top: 1.5rem;
    }

    .mult-explanation p {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }

    .mult-explanation p:last-child { margin-bottom: 0; }

    /* Exponential Section */
    .exp-section {
      padding: 4rem 2rem;
      background: var(--background);
    }

    .exp-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .exp-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .exp-canvas-container {
      height: 320px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #expCanvas {
      width: 100%;
      height: 100%;
    }

    .exp-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .control-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input[type="range"] {
      width: 120px;
      accent-color: var(--exp-amber);
    }

    .slider-value {
      font-family: var(--mono);
      font-size: 0.9rem;
      min-width: 50px;
      color: var(--exp-amber);
    }

    .exp-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 600px) {
      .exp-info { grid-template-columns: 1fr; }
    }

    .exp-card {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .exp-card.input {
      background: rgba(59, 130, 246, 0.1);
      border: 2px solid var(--complex-blue);
    }

    .exp-card.output {
      background: rgba(245, 158, 11, 0.1);
      border: 2px solid var(--exp-amber);
    }

    /* Cauchy-Riemann Section */
    .cr-section {
      min-height: 80vh;
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #1A1A20 0%, var(--background-dark) 100%);
      color: var(--ink-light);
    }

    .cr-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .cr-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .cr-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 700px) {
      .cr-grid { grid-template-columns: 1fr; }
    }

    .cr-card {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .cr-card.real {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid var(--real-green);
    }

    .cr-card.imag {
      background: rgba(236, 72, 153, 0.15);
      border: 2px solid var(--imag-pink);
    }

    .cr-name {
      font-family: var(--display);
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }

    .cr-formula {
      font-family: var(--mono);
      font-size: 1rem;
      color: #9CA3AF;
    }

    .cr-result {
      background: rgba(139, 92, 246, 0.15);
      border: 2px solid var(--conjugate-purple);
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .cr-result-title {
      font-family: var(--display);
      font-size: 1.4rem;
      color: var(--conjugate-purple);
      margin-bottom: 0.5rem;
    }

    .cr-result-eq {
      font-family: var(--mono);
      font-size: 1.1rem;
      color: var(--ink-light);
    }

    /* Navigation */
    .next-section {
      padding: 4rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--complex-blue) 0%, #1D4ED8 100%);
      color: var(--ink-light);
      text-align: center;
    }

    .next-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .next-title {
      font-family: var(--display);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .next-description {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 500px;
    }
  </style>
</head>
<body>

  <!-- Opening -->
  <section class="opening">
    <div class="opening-content">
      <p class="chapter-label">Chapter 5: Complex Analysis</p>
      <p class="section-label">Section 1: The Complex Plane</p>
      <h1 class="main-title">The Geometry of i</h1>
      <p class="subtitle">Adjoin √(-1) to the reals, and a geometric miracle unfolds. Differentiable functions become infinitely smooth.</p>
    </div>
  </section>

  <!-- Narrative: Complex Numbers -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>A <strong>complex number</strong> is an ordered pair z = (x, y) of real numbers, written as z = x + iy where i² = -1.</p>
      <div class="math-display">
        <strong>Definition 1.1:</strong><br><br>
        z = x + iy &nbsp;&nbsp; (x, y ∈ ℝ)<br><br>
        |z| = √(x² + y²) &nbsp;<em>(modulus)</em><br>
        z* = x - iy &nbsp;<em>(conjugate)</em>
      </div>
      <p>The complex plane ℂ is ℝ² with extra structure: multiplication that respects i² = -1.</p>
    </div>
  </section>

  <!-- Complex Plane Visualization -->
  <section class="plane-section">
    <div class="section-header">
      <h2 class="section-title">The Complex Plane</h2>
      <p class="section-subtitle">Click to place a complex number z = x + iy</p>
    </div>

    <div class="plane-container">
      <div class="plane-panel">
        <div class="plane-canvas-container" id="planeCanvasContainer">
          <canvas id="planeCanvas"></canvas>
        </div>

        <div class="plane-info">
          <div class="info-card">
            <p class="info-label">z = x + iy</p>
            <p class="info-value" id="zValue" style="color: var(--complex-blue);">0 + 0i</p>
          </div>
          <div class="info-card">
            <p class="info-label">|z| (modulus)</p>
            <p class="info-value" id="modValue" style="color: var(--exp-amber);">0.00</p>
          </div>
          <div class="info-card">
            <p class="info-label">arg(z)</p>
            <p class="info-value" id="argValue" style="color: var(--conjugate-purple);">0°</p>
          </div>
          <div class="info-card">
            <p class="info-label">z* (conjugate)</p>
            <p class="info-value" id="conjValue" style="color: var(--imag-pink);">0 - 0i</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Complex Multiplication -->
  <section class="mult-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Multiplication = Rotation + Scaling</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">Multiplying by z scales by |z| and rotates by arg(z)</p>
    </div>

    <div class="mult-container">
      <div class="mult-panel">
        <div class="mult-canvas-container">
          <canvas id="multCanvas"></canvas>
        </div>

        <div class="mult-info">
          <div class="mult-card">
            <p class="mult-label">z₁</p>
            <p class="mult-value" id="z1Value" style="color: var(--complex-blue);">1 + i</p>
          </div>
          <div class="mult-card">
            <p class="mult-label">z₂</p>
            <p class="mult-value" id="z2Value" style="color: var(--real-green);">1 + 0.5i</p>
          </div>
          <div class="mult-card">
            <p class="mult-label">z₁ · z₂</p>
            <p class="mult-value" id="prodValue" style="color: var(--exp-amber);">0.5 + 1.5i</p>
          </div>
        </div>

        <div class="mult-explanation">
          <p><strong>The Geometric Rule:</strong> |z₁ · z₂| = |z₁| · |z₂| and arg(z₁ · z₂) = arg(z₁) + arg(z₂)</p>
          <p>Drag the blue and green points to see multiplication in action. The product appears in amber.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Exponential Function -->
  <section class="exp-section">
    <div class="section-header">
      <h2 class="section-title">The Exponential Function</h2>
      <p class="section-subtitle">exp(z) = exp(x)(cos y + i sin y)</p>
    </div>

    <div class="exp-container">
      <div class="exp-panel">
        <div class="exp-canvas-container">
          <canvas id="expCanvas"></canvas>
        </div>

        <div class="exp-controls">
          <div class="control-group">
            <span class="control-label">Real part x</span>
            <div class="slider-container">
              <input type="range" id="expXSlider" min="-2" max="2" step="0.1" value="0">
              <span class="slider-value" id="expXValue">0.0</span>
            </div>
          </div>
          <div class="control-group">
            <span class="control-label">Imaginary part y</span>
            <div class="slider-container">
              <input type="range" id="expYSlider" min="-3.14" max="3.14" step="0.1" value="0">
              <span class="slider-value" id="expYValue">0.0</span>
            </div>
          </div>
        </div>

        <div class="exp-info">
          <div class="exp-card input">
            <p class="info-label">Input z</p>
            <p class="info-value" id="expInput" style="color: var(--complex-blue); font-size: 1.2rem;">0 + 0i</p>
          </div>
          <div class="exp-card output">
            <p class="info-label">exp(z)</p>
            <p class="info-value" id="expOutput" style="color: var(--exp-amber); font-size: 1.2rem;">1 + 0i</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Cauchy-Riemann -->
  <section class="cr-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">The Cauchy-Riemann Equations</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">The condition for complex differentiability</p>
    </div>

    <div class="cr-container">
      <div class="cr-panel">
        <div class="cr-grid">
          <div class="cr-card real">
            <h3 class="cr-name" style="color: var(--real-green);">Real Part</h3>
            <p class="cr-formula">f(z) = u(x,y) + i·v(x,y)</p>
            <p style="margin-top: 0.5rem; color: #9CA3AF; font-size: 0.9rem;">∂u/∂x = ∂v/∂y</p>
          </div>
          <div class="cr-card imag">
            <h3 class="cr-name" style="color: var(--imag-pink);">Imaginary Part</h3>
            <p class="cr-formula">f_y = i · f_x</p>
            <p style="margin-top: 0.5rem; color: #9CA3AF; font-size: 0.9rem;">∂u/∂y = -∂v/∂x</p>
          </div>
        </div>

        <div class="cr-result">
          <h3 class="cr-result-title">Theorem 2.7</h3>
          <p class="cr-result-eq">f_y = i · f_x ⟹ f is differentiable</p>
          <p style="margin-top: 1rem; color: #9CA3AF; font-size: 0.9rem;">
            Complex differentiability is far more restrictive than real differentiability.<br>
            Functions satisfying Cauchy-Riemann are <em>infinitely differentiable</em>.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: Why Complex? -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>Why is complex differentiability so special?</p>
      <div class="math-display">
        In ℝ²: f: ℝ² → ℝ² has 4 partial derivatives<br>
        In ℂ: f: ℂ → ℂ has 2 partial derivatives<br>
        Cauchy-Riemann: 2 equations link them<br><br>
        <strong>Result:</strong> Only 1 "degree of freedom" remains
      </div>
      <p>The constraint is so strong that differentiable complex functions are <strong>analytic</strong> — equal to their Taylor series.</p>
    </div>
  </section>

  <!-- Navigation -->
  <section class="next-section">
    <p class="next-label">Coming Next</p>
    <h3 class="next-title">Paths & The Cauchy Integral Theorem</h3>
    <p class="next-description">Integration along paths in the complex plane. For analytic functions, the integral depends only on endpoints.</p>
  </section>

  <script>
    // Scroll animations
    const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -10% 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, observerOptions);
    document.querySelectorAll('[data-animate], .narrative-content').forEach(el => observer.observe(el));

    function setupCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      return { ctx, width: rect.width, height: rect.height };
    }

    function formatComplex(re, im) {
      const reStr = re.toFixed(2);
      const imAbs = Math.abs(im).toFixed(2);
      const sign = im >= 0 ? '+' : '-';
      return `${reStr} ${sign} ${imAbs}i`;
    }

    // ============================================
    // COMPLEX PLANE VISUALIZATION
    // ============================================
    
    const planeCanvas = document.getElementById('planeCanvas');
    const planeContainer = document.getElementById('planeCanvasContainer');
    let currentZ = { x: 0, y: 0 };

    function drawPlane() {
      const { ctx, width, height } = setupCanvas(planeCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      const scale = Math.min(width, height) / 6;

      // Grid
      ctx.strokeStyle = '#E5E5E5';
      ctx.lineWidth = 1;
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX + i * scale, 0);
        ctx.lineTo(centerX + i * scale, height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, centerY - i * scale);
        ctx.lineTo(width, centerY - i * scale);
        ctx.stroke();
      }

      // Axes
      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, centerY);
      ctx.lineTo(width, centerY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(centerX, 0);
      ctx.lineTo(centerX, height);
      ctx.stroke();

      // Labels
      ctx.fillStyle = '#22C55E';
      ctx.font = '12px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText('Re', width - 30, centerY - 10);
      ctx.fillStyle = '#EC4899';
      ctx.fillText('Im', centerX + 10, 20);

      // Current point z
      const zx = centerX + currentZ.x * scale;
      const zy = centerY - currentZ.y * scale;

      // Modulus line
      ctx.strokeStyle = 'rgba(245, 158, 11, 0.5)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.lineTo(zx, zy);
      ctx.stroke();

      // Projection lines
      ctx.strokeStyle = 'rgba(59, 130, 246, 0.3)';
      ctx.setLineDash([4, 4]);
      ctx.beginPath();
      ctx.moveTo(zx, centerY);
      ctx.lineTo(zx, zy);
      ctx.moveTo(centerX, zy);
      ctx.lineTo(zx, zy);
      ctx.stroke();
      ctx.setLineDash([]);

      // Point z
      ctx.fillStyle = '#3B82F6';
      ctx.beginPath();
      ctx.arc(zx, zy, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'white';
      ctx.font = 'bold 10px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('z', zx, zy + 4);

      // Conjugate z*
      const conjY = centerY + currentZ.y * scale;
      ctx.fillStyle = '#EC4899';
      ctx.beginPath();
      ctx.arc(zx, conjY, 6, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#EC4899';
      ctx.font = '10px "JetBrains Mono"';
      ctx.fillText('z*', zx + 15, conjY + 4);

      // Update info
      const mod = Math.sqrt(currentZ.x * currentZ.x + currentZ.y * currentZ.y);
      const arg = Math.atan2(currentZ.y, currentZ.x) * 180 / Math.PI;
      
      document.getElementById('zValue').textContent = formatComplex(currentZ.x, currentZ.y);
      document.getElementById('modValue').textContent = mod.toFixed(2);
      document.getElementById('argValue').textContent = arg.toFixed(1) + '°';
      document.getElementById('conjValue').textContent = formatComplex(currentZ.x, -currentZ.y);
    }

    planeContainer.addEventListener('click', (e) => {
      const rect = planeCanvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const scale = Math.min(rect.width, rect.height) / 6;
      
      currentZ.x = (mx - centerX) / scale;
      currentZ.y = (centerY - my) / scale;
      drawPlane();
    });

    // ============================================
    // MULTIPLICATION VISUALIZATION
    // ============================================
    
    const multCanvas = document.getElementById('multCanvas');
    let z1 = { x: 1, y: 1 };
    let z2 = { x: 1, y: 0.5 };
    let draggingMult = null;

    function drawMult() {
      const { ctx, width, height } = setupCanvas(multCanvas);

      ctx.fillStyle = '#0A0A0F';
      ctx.fillRect(0, 0, width, height);

      const centerX = width / 2;
      const centerY = height / 2;
      const scale = Math.min(width, height) / 6;

      // Grid
      ctx.strokeStyle = '#222';
      ctx.lineWidth = 1;
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX + i * scale, 0);
        ctx.lineTo(centerX + i * scale, height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, centerY - i * scale);
        ctx.lineTo(width, centerY - i * scale);
        ctx.stroke();
      }

      // Axes
      ctx.strokeStyle = '#444';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, centerY);
      ctx.lineTo(width, centerY);
      ctx.moveTo(centerX, 0);
      ctx.lineTo(centerX, height);
      ctx.stroke();

      // Product z1 * z2
      const prod = {
        x: z1.x * z2.x - z1.y * z2.y,
        y: z1.x * z2.y + z1.y * z2.x
      };

      // Draw vectors from origin
      function drawVector(z, color, label) {
        const zx = centerX + z.x * scale;
        const zy = centerY - z.y * scale;
        
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(zx, zy);
        ctx.stroke();

        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(zx, zy, 8, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = 'white';
        ctx.font = 'bold 10px "JetBrains Mono"';
        ctx.textAlign = 'center';
        ctx.fillText(label, zx, zy + 4);
      }

      drawVector(z1, '#3B82F6', 'z₁');
      drawVector(z2, '#22C55E', 'z₂');
      drawVector(prod, '#F59E0B', '·');

      // Update info
      document.getElementById('z1Value').textContent = formatComplex(z1.x, z1.y);
      document.getElementById('z2Value').textContent = formatComplex(z2.x, z2.y);
      document.getElementById('prodValue').textContent = formatComplex(prod.x, prod.y);
    }

    multCanvas.addEventListener('mousedown', (e) => {
      const rect = multCanvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const scale = Math.min(rect.width, rect.height) / 6;

      const z1x = centerX + z1.x * scale;
      const z1y = centerY - z1.y * scale;
      const z2x = centerX + z2.x * scale;
      const z2y = centerY - z2.y * scale;

      if (Math.sqrt((mx - z1x) ** 2 + (my - z1y) ** 2) < 15) draggingMult = 'z1';
      else if (Math.sqrt((mx - z2x) ** 2 + (my - z2y) ** 2) < 15) draggingMult = 'z2';
    });

    multCanvas.addEventListener('mousemove', (e) => {
      if (!draggingMult) return;
      const rect = multCanvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const scale = Math.min(rect.width, rect.height) / 6;

      const newX = (mx - centerX) / scale;
      const newY = (centerY - my) / scale;

      if (draggingMult === 'z1') {
        z1.x = newX;
        z1.y = newY;
      } else {
        z2.x = newX;
        z2.y = newY;
      }
      drawMult();
    });

    multCanvas.addEventListener('mouseup', () => { draggingMult = null; });
    multCanvas.addEventListener('mouseleave', () => { draggingMult = null; });

    // ============================================
    // EXPONENTIAL VISUALIZATION
    // ============================================
    
    const expCanvas = document.getElementById('expCanvas');
    let expX = 0, expY = 0;

    function drawExp() {
      const { ctx, width, height } = setupCanvas(expCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const leftW = width / 2 - 20;
      const rightW = width / 2 - 20;
      const centerY = height / 2;

      // Left: Input plane
      const leftCX = leftW / 2 + 10;
      const scale1 = Math.min(leftW, height) / 8;

      ctx.strokeStyle = '#DDD';
      ctx.lineWidth = 1;
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(leftCX + i * scale1, 0);
        ctx.lineTo(leftCX + i * scale1, height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(10, centerY - i * scale1);
        ctx.lineTo(leftW, centerY - i * scale1);
        ctx.stroke();
      }

      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(10, centerY);
      ctx.lineTo(leftW, centerY);
      ctx.moveTo(leftCX, 0);
      ctx.lineTo(leftCX, height);
      ctx.stroke();

      // Input point
      const inX = leftCX + expX * scale1;
      const inY = centerY - expY * scale1;
      ctx.fillStyle = '#3B82F6';
      ctx.beginPath();
      ctx.arc(inX, inY, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#3B82F6';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('z', inX, inY - 15);

      // Arrow
      ctx.fillStyle = '#666';
      ctx.font = '20px sans-serif';
      ctx.fillText('→', width / 2, centerY);

      // Right: Output plane
      const rightCX = width / 2 + 20 + rightW / 2;
      const scale2 = Math.min(rightW, height) / 8;

      ctx.strokeStyle = '#DDD';
      ctx.lineWidth = 1;
      for (let i = -3; i <= 3; i++) {
        ctx.beginPath();
        ctx.moveTo(width / 2 + 20 + i * scale2 + rightW / 2, 0);
        ctx.lineTo(width / 2 + 20 + i * scale2 + rightW / 2, height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(width / 2 + 20, centerY - i * scale2);
        ctx.lineTo(width - 10, centerY - i * scale2);
        ctx.stroke();
      }

      ctx.strokeStyle = '#999';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(width / 2 + 20, centerY);
      ctx.lineTo(width - 10, centerY);
      ctx.moveTo(rightCX, 0);
      ctx.lineTo(rightCX, height);
      ctx.stroke();

      // Output point exp(z)
      const expReal = Math.exp(expX) * Math.cos(expY);
      const expImag = Math.exp(expX) * Math.sin(expY);
      const outX = rightCX + expReal * scale2;
      const outY = centerY - expImag * scale2;

      // Unit circle for reference
      ctx.strokeStyle = 'rgba(245, 158, 11, 0.3)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(rightCX, centerY, scale2, 0, Math.PI * 2);
      ctx.stroke();

      ctx.fillStyle = '#F59E0B';
      ctx.beginPath();
      ctx.arc(outX, outY, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#F59E0B';
      ctx.font = '11px "JetBrains Mono"';
      ctx.fillText('exp(z)', outX, outY - 15);

      // Labels
      ctx.fillStyle = '#666';
      ctx.font = '10px "JetBrains Mono"';
      ctx.fillText('Input', leftCX, 20);
      ctx.fillText('Output', rightCX, 20);

      // Update info
      document.getElementById('expInput').textContent = formatComplex(expX, expY);
      document.getElementById('expOutput').textContent = formatComplex(expReal, expImag);
    }

    document.getElementById('expXSlider').addEventListener('input', (e) => {
      expX = parseFloat(e.target.value);
      document.getElementById('expXValue').textContent = expX.toFixed(1);
      drawExp();
    });

    document.getElementById('expYSlider').addEventListener('input', (e) => {
      expY = parseFloat(e.target.value);
      document.getElementById('expYValue').textContent = expY.toFixed(1);
      drawExp();
    });

    // Initialize
    drawPlane();
    drawMult();
    drawExp();

    window.addEventListener('resize', () => {
      drawPlane();
      drawMult();
      drawExp();
    });
  </script>
</body>
</html>
