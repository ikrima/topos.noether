<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Continuity with Computational Content — Constructive Analysis Chapter 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@300;400;600&family=JetBrains Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --constructive-primary: #2D5A4A;
      --constructive-glow: #4A9D7C;
      --regular-sequence: #2563EB;
      --limit-point: #EC4899;
      --modulus-function: #F59E0B;
      --convergence-band: #10B981;
      --divergence: #EF4444;
      --continuity-color: #06B6D4;
      --lub-color: #8B5CF6;
      --fog-light: #9CA3AF;
      --background: #FAF8F5;
      --background-dark: #0F0F12;
      --ink: #1A1A1A;
      --ink-light: #FAF8F5;
      
      --display: 'Crimson Text', serif;
      --body: 'Source Sans Pro', sans-serif;
      --mono: 'JetBrains Mono', monospace;
      
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--body);
      background: var(--background);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    /* ============================================
       OPENING
       ============================================ */
    
    .opening {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: linear-gradient(180deg, var(--continuity-color) 0%, #0891B2 100%);
      color: var(--ink-light);
      position: relative;
      overflow: hidden;
    }

    .opening::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 30% 40%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(16, 185, 129, 0.1) 0%, transparent 40%);
      pointer-events: none;
    }

    .opening-content {
      text-align: center;
      max-width: 800px;
      position: relative;
      z-index: 1;
    }

    .chapter-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.2s forwards;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.3s forwards;
    }

    .main-title {
      font-family: var(--display);
      font-size: clamp(2rem, 6vw, 3.5rem);
      font-weight: 400;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.4s forwards;
    }

    .subtitle {
      font-size: 1.15rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.6s forwards;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ============================================
       NARRATIVE SECTIONS
       ============================================ */

    .narrative-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }

    .narrative-section.dark {
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .narrative-content {
      max-width: 650px;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
    }

    .narrative-content.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .narrative-content p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .math-display {
      font-family: var(--mono);
      font-size: 1rem;
      background: rgba(6, 182, 212, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 1.5rem 0;
      border-left: 3px solid var(--continuity-color);
    }

    .dark .math-display {
      background: rgba(6, 182, 212, 0.15);
    }

    /* ============================================
       MODULUS OF CONTINUITY
       ============================================ */

    .continuity-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #F5F3F0 0%, var(--background) 100%);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: #666;
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .continuity-container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .continuity-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .panel-header {
      background: var(--continuity-color);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .panel-title {
      font-family: var(--display);
      font-size: 1.3rem;
    }

    .panel-formula {
      font-family: var(--mono);
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .panel-body {
      padding: 2rem;
    }

    .continuity-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 2rem;
    }

    @media (max-width: 900px) {
      .continuity-grid {
        grid-template-columns: 1fr;
      }
    }

    .canvas-container {
      height: 350px;
      background: #FAFAFA;
      border-radius: 12px;
    }

    #continuityCanvas {
      width: 100%;
      height: 100%;
    }

    .controls-panel {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .control-card {
      background: #FAFAFA;
      padding: 1.2rem;
      border-radius: 10px;
    }

    .control-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--fog-light);
      margin-bottom: 0.6rem;
      display: block;
    }

    .function-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .fn-btn {
      padding: 0.5rem 0.7rem;
      border: 2px solid #E0E0E0;
      border-radius: 6px;
      background: white;
      font-family: var(--mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .fn-btn:hover {
      border-color: var(--continuity-color);
    }

    .fn-btn.active {
      border-color: var(--continuity-color);
      background: var(--continuity-color);
      color: white;
    }

    .slider-container {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .control-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: #E0E0E0;
      border-radius: 4px;
      outline: none;
    }

    .control-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--continuity-color);
      border-radius: 50%;
      cursor: pointer;
    }

    .slider-values {
      display: flex;
      justify-content: space-between;
      font-family: var(--mono);
      font-size: 0.8rem;
    }

    .epsilon-val { color: var(--modulus-function); }
    .delta-val { color: var(--continuity-color); }

    .output-box {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      border: 2px solid var(--continuity-color);
      text-align: center;
    }

    .output-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--fog-light);
    }

    .output-value {
      font-family: var(--mono);
      font-size: 1.4rem;
      color: var(--continuity-color);
    }

    .output-meaning {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.3rem;
    }

    /* ============================================
       CONSTRUCTIVE LUB
       ============================================ */

    .lub-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .lub-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .lub-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .lub-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .lub-subtitle {
      color: var(--fog-light);
      font-size: 1rem;
    }

    .lub-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .lub-canvas-container {
      height: 300px;
      margin-bottom: 1.5rem;
    }

    #lubCanvas {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #0A0A0F;
    }

    .lub-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .lub-btn {
      padding: 0.7rem 1.2rem;
      border: 2px solid var(--lub-color);
      border-radius: 8px;
      background: transparent;
      color: var(--lub-color);
      font-family: var(--mono);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .lub-btn:hover {
      background: rgba(139, 92, 246, 0.2);
    }

    .lub-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .lub-status {
      background: rgba(139, 92, 246, 0.15);
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .status-step {
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--lub-color);
      margin-bottom: 0.5rem;
    }

    .status-interval {
      font-family: var(--mono);
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .status-explanation {
      font-size: 0.9rem;
      color: var(--fog-light);
    }

    /* ============================================
       WEAK IVT
       ============================================ */

    .ivt-section {
      padding: 4rem 2rem;
      background: var(--background);
    }

    .ivt-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .ivt-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .ivt-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .ivt-subtitle {
      color: #666;
      font-size: 1rem;
    }

    .ivt-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .ivt-canvas-container {
      height: 300px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #ivtCanvas {
      width: 100%;
      height: 100%;
    }

    .ivt-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .ivt-slider-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .ivt-slider-label {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--fog-light);
    }

    .ivt-slider {
      width: 150px;
      height: 8px;
      -webkit-appearance: none;
      background: #E0E0E0;
      border-radius: 4px;
    }

    .ivt-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--modulus-function);
      border-radius: 50%;
      cursor: pointer;
    }

    .ivt-result {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .ivt-result.approximate {
      background: rgba(245, 158, 11, 0.1);
      border: 2px solid var(--modulus-function);
    }

    .ivt-result.exact {
      background: rgba(16, 185, 129, 0.1);
      border: 2px solid var(--convergence-band);
    }

    .result-title {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .ivt-result.approximate .result-title { color: var(--modulus-function); }
    .ivt-result.exact .result-title { color: var(--convergence-band); }

    .result-value {
      font-family: var(--mono);
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .result-explanation {
      font-size: 0.9rem;
      color: #666;
    }

    /* ============================================
       NAVIGATION
       ============================================ */

    .next-section {
      padding: 4rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, var(--continuity-color) 0%, #0891B2 100%);
      color: var(--ink-light);
      text-align: center;
    }

    .next-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .next-title {
      font-family: var(--display);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .next-description {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 500px;
    }
  </style>
</head>
<body>

  <!-- Opening -->
  <section class="opening">
    <div class="opening-content">
      <p class="chapter-label">Chapter 2: Calculus and the Real Numbers</p>
      <p class="section-label">Section 4: Continuous Functions</p>
      <h1 class="main-title">Continuity with Content</h1>
      <p class="subtitle">A continuous function comes equipped with a modulus ω(ε) that computes the required δ. No more "there exists"—we can calculate it.</p>
    </div>
  </section>

  <!-- Narrative: Introduction -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>Classical continuity says: for every ε > 0, there exists δ > 0 such that |x - y| < δ implies |f(x) - f(y)| < ε.</p>
      <p>But which δ? Classical mathematics doesn't say. The existential quantifier hides the computational content.</p>
    </div>
  </section>

  <!-- Narrative: The Definition -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <div class="math-display">
        f is continuous on [a,b] if there exists <strong>ω : ℝ⁺ → ℝ⁺</strong> such that<br><br>
        |f(x) - f(y)| < ε &nbsp;&nbsp;whenever&nbsp;&nbsp; |x - y| < ω(ε)
      </div>
      <p>The function ω is the <strong>modulus of continuity</strong>. Given any precision ε you want in the output, ω(ε) tells you exactly how precise you need to be in the input.</p>
      <p>This is uniform continuity with computational content. The modulus is not optional—it's part of what it means for f to be continuous.</p>
    </div>
  </section>

  <!-- Modulus of Continuity Visualizer -->
  <section class="continuity-section">
    <div class="section-header">
      <h2 class="section-title">The ω-Machine</h2>
      <p class="section-subtitle">See how the modulus of continuity controls function behavior</p>
    </div>

    <div class="continuity-container">
      <div class="continuity-panel">
        <div class="panel-header">
          <span class="panel-title">Modulus of Continuity</span>
          <span class="panel-formula">|x - y| < ω(ε) ⟹ |f(x) - f(y)| < ε</span>
        </div>

        <div class="panel-body">
          <div class="continuity-grid">
            <div class="canvas-container">
              <canvas id="continuityCanvas"></canvas>
            </div>

            <div class="controls-panel">
              <div class="control-card">
                <label class="control-label">Function</label>
                <div class="function-selector">
                  <button class="fn-btn active" data-fn="x2">x²</button>
                  <button class="fn-btn" data-fn="sin">sin(x)</button>
                  <button class="fn-btn" data-fn="sqrt">√x</button>
                  <button class="fn-btn" data-fn="exp">eˣ</button>
                </div>
              </div>

              <div class="control-card">
                <label class="control-label">Precision ε (output tolerance)</label>
                <div class="slider-container">
                  <input type="range" class="control-slider" id="epsSlider" 
                         min="0.02" max="0.5" step="0.02" value="0.2">
                  <div class="slider-values">
                    <span>ε =</span>
                    <span class="epsilon-val" id="epsValue">0.20</span>
                  </div>
                </div>
              </div>

              <div class="control-card">
                <label class="control-label">Test Point x₀</label>
                <div class="slider-container">
                  <input type="range" class="control-slider" id="x0Slider" 
                         min="0.2" max="1.8" step="0.05" value="1">
                  <div class="slider-values">
                    <span>x₀ =</span>
                    <span id="x0Value">1.00</span>
                  </div>
                </div>
              </div>

              <div class="output-box">
                <p class="output-label">Computed δ = ω(ε)</p>
                <p class="output-value" id="deltaOutput">δ = 0.10</p>
                <p class="output-meaning" id="deltaMeaning">
                  Stay within 0.10 of x₀ to keep output within ε
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Constructive LUB -->
  <section class="lub-section">
    <div class="lub-container">
      <div class="lub-header">
        <h2 class="lub-title">Constructive Least Upper Bound</h2>
        <p class="lub-subtitle">The supremum exists when we can decide: is y an upper bound, or is there an element above x?</p>
      </div>

      <div class="lub-panel">
        <div class="lub-canvas-container">
          <canvas id="lubCanvas"></canvas>
        </div>

        <div class="lub-controls">
          <button class="lub-btn" id="lubStep">Step</button>
          <button class="lub-btn" id="lubReset">Reset</button>
          <button class="lub-btn" id="lubAuto">Auto-Run</button>
        </div>

        <div class="lub-status" id="lubStatus">
          <p class="status-step">Step 0: Initialize</p>
          <p class="status-interval">[a, b] = [0.00, 2.00]</p>
          <p class="status-explanation">
            Finding sup{f(x) : x ∈ [0, 2]} for f(x) = sin(πx/2)
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Weak IVT -->
  <section class="ivt-section">
    <div class="ivt-container">
      <div class="ivt-header">
        <h2 class="ivt-title">The Weak Intermediate Value Theorem</h2>
        <p class="ivt-subtitle">We can find x with |f(x) - y| < ε, but not necessarily f(x) = y exactly</p>
      </div>

      <div class="ivt-panel">
        <div class="ivt-canvas-container">
          <canvas id="ivtCanvas"></canvas>
        </div>

        <div class="ivt-controls">
          <div class="ivt-slider-group">
            <label class="ivt-slider-label">Target y</label>
            <input type="range" class="ivt-slider" id="targetSlider" 
                   min="-0.8" max="0.8" step="0.05" value="0">
            <span id="targetValue" style="font-family: var(--mono); font-size: 0.85rem;">y = 0.00</span>
          </div>

          <div class="ivt-slider-group">
            <label class="ivt-slider-label">Tolerance ε</label>
            <input type="range" class="ivt-slider" id="tolSlider" 
                   min="0.02" max="0.3" step="0.02" value="0.1">
            <span id="tolValue" style="font-family: var(--mono); font-size: 0.85rem;">ε = 0.10</span>
          </div>
        </div>

        <div class="ivt-result approximate" id="ivtResult">
          <p class="result-title">Approximate Zero</p>
          <p class="result-value" id="ivtX">x ≈ 0.500</p>
          <p class="result-explanation" id="ivtExplanation">
            |f(x) - y| = 0.02 < ε ✓
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: The Gap -->
  <section class="narrative-section dark">
    <div class="narrative-content" data-animate>
      <p>The weak IVT is all we can prove constructively. To find an <em>exact</em> zero, we'd need to decide: is f(x) positive or negative at every step?</p>
      <p>This is precisely what fails for Bishop's counterexample from Chapter 1. The function's behavior near zero depends on undecidable information.</p>
      <p>But for many practical purposes, the weak form suffices. If you can make ε arbitrarily small, you can get arbitrarily close—and that's often enough.</p>
    </div>
  </section>

  <!-- Navigation -->
  <section class="next-section">
    <p class="next-label">Coming Next</p>
    <h3 class="next-title">Differentiation with Modulus</h3>
    <p class="next-description">The derivative exists with a modulus δ(ε) that bounds the linearization error.</p>
  </section>

  <script>
    // ============================================
    // SCROLL ANIMATIONS
    // ============================================
    
    const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -10% 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, observerOptions);

    document.querySelectorAll('[data-animate], .narrative-content').forEach(el => observer.observe(el));

    // ============================================
    // CANVAS UTILITIES
    // ============================================
    
    function setupCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      return { ctx, width: rect.width, height: rect.height };
    }

    // ============================================
    // FUNCTIONS
    // ============================================
    
    const functions = {
      x2: {
        f: (x) => x * x,
        df: (x) => 2 * x,
        name: 'x²',
        // For x² on [0,2], Lipschitz constant is 4
        omega: (eps, x0) => eps / (2 * Math.max(Math.abs(x0), 2))
      },
      sin: {
        f: (x) => Math.sin(x),
        df: (x) => Math.cos(x),
        name: 'sin(x)',
        // sin has Lipschitz constant 1
        omega: (eps, x0) => eps
      },
      sqrt: {
        f: (x) => Math.sqrt(Math.max(0, x)),
        df: (x) => x > 0 ? 0.5 / Math.sqrt(x) : 0,
        name: '√x',
        // sqrt is not Lipschitz at 0, but is on [0.1, 2]
        omega: (eps, x0) => x0 > 0.01 ? eps * 2 * Math.sqrt(x0) : eps * 0.1
      },
      exp: {
        f: (x) => Math.exp(x),
        df: (x) => Math.exp(x),
        name: 'eˣ',
        // exp has local Lipschitz constant e^x
        omega: (eps, x0) => eps / Math.exp(x0)
      }
    };

    let currentFn = 'x2';
    let currentEps = 0.2;
    let currentX0 = 1;

    // ============================================
    // CONTINUITY VISUALIZATION
    // ============================================
    
    const continuityCanvas = document.getElementById('continuityCanvas');
    const epsSlider = document.getElementById('epsSlider');
    const x0Slider = document.getElementById('x0Slider');
    const epsValue = document.getElementById('epsValue');
    const x0Value = document.getElementById('x0Value');
    const deltaOutput = document.getElementById('deltaOutput');
    const deltaMeaning = document.getElementById('deltaMeaning');

    function drawContinuity() {
      const { ctx, width, height } = setupCanvas(continuityCanvas);
      const fn = functions[currentFn];

      const padding = { left: 45, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - padding.left - padding.right;
      const plotHeight = height - padding.top - padding.bottom;

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      // Domain [0, 2] for most functions
      const xMin = 0, xMax = 2;
      
      // Calculate y-range
      const samples = [];
      for (let i = 0; i <= 50; i++) {
        const x = xMin + (i / 50) * (xMax - xMin);
        samples.push(fn.f(x));
      }
      let yMin = Math.min(...samples);
      let yMax = Math.max(...samples);
      const yMargin = (yMax - yMin) * 0.1;
      yMin -= yMargin;
      yMax += yMargin;

      const toScreenX = (x) => padding.left + ((x - xMin) / (xMax - xMin)) * plotWidth;
      const toScreenY = (y) => padding.top + ((yMax - y) / (yMax - yMin)) * plotHeight;

      // Compute delta
      const delta = fn.omega(currentEps, currentX0);
      const y0 = fn.f(currentX0);

      // Draw epsilon band (horizontal, around f(x₀))
      ctx.fillStyle = 'rgba(245, 158, 11, 0.15)';
      const epsBandTop = toScreenY(y0 + currentEps);
      const epsBandBottom = toScreenY(y0 - currentEps);
      ctx.fillRect(padding.left, epsBandTop, plotWidth, epsBandBottom - epsBandTop);

      // Draw delta band (vertical, around x₀)
      ctx.fillStyle = 'rgba(6, 182, 212, 0.15)';
      const deltaLeft = toScreenX(Math.max(xMin, currentX0 - delta));
      const deltaRight = toScreenX(Math.min(xMax, currentX0 + delta));
      ctx.fillRect(deltaLeft, padding.top, deltaRight - deltaLeft, plotHeight);

      // Draw axes
      ctx.strokeStyle = '#CCC';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding.left, height - padding.bottom);
      ctx.lineTo(width - padding.right, height - padding.bottom);
      ctx.moveTo(padding.left, padding.top);
      ctx.lineTo(padding.left, height - padding.bottom);
      ctx.stroke();

      // Draw function
      ctx.strokeStyle = '#2563EB';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      for (let i = 0; i <= 100; i++) {
        const x = xMin + (i / 100) * (xMax - xMin);
        const y = fn.f(x);
        const sx = toScreenX(x);
        const sy = toScreenY(y);
        if (i === 0) ctx.moveTo(sx, sy);
        else ctx.lineTo(sx, sy);
      }
      ctx.stroke();

      // Draw point at x₀
      ctx.fillStyle = '#EC4899';
      ctx.beginPath();
      ctx.arc(toScreenX(currentX0), toScreenY(y0), 7, 0, Math.PI * 2);
      ctx.fill();

      // Labels
      ctx.fillStyle = '#F59E0B';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText(`ε = ${currentEps.toFixed(2)}`, width - padding.right - 60, epsBandTop - 5);

      ctx.fillStyle = '#06B6D4';
      ctx.textAlign = 'center';
      ctx.fillText(`δ`, (deltaLeft + deltaRight) / 2, height - padding.bottom + 18);

      ctx.fillStyle = '#EC4899';
      ctx.fillText(`x₀`, toScreenX(currentX0), height - padding.bottom + 18);

      // Update display
      deltaOutput.textContent = `δ = ${delta.toFixed(4)}`;
      deltaMeaning.textContent = `Stay within ${delta.toFixed(3)} of x₀ to keep output within ε`;
    }

    epsSlider.addEventListener('input', () => {
      currentEps = parseFloat(epsSlider.value);
      epsValue.textContent = currentEps.toFixed(2);
      drawContinuity();
    });

    x0Slider.addEventListener('input', () => {
      currentX0 = parseFloat(x0Slider.value);
      x0Value.textContent = currentX0.toFixed(2);
      drawContinuity();
    });

    document.querySelectorAll('.fn-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.fn-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFn = btn.dataset.fn;
        drawContinuity();
      });
    });

    // ============================================
    // CONSTRUCTIVE LUB
    // ============================================
    
    const lubCanvas = document.getElementById('lubCanvas');
    const lubStatus = document.getElementById('lubStatus');
    let lubState = { a: 0, b: 2, step: 0, intervals: [], running: false };

    function lubFunction(x) {
      return Math.sin(Math.PI * x / 2);
    }

    function drawLub() {
      const { ctx, width, height } = setupCanvas(lubCanvas);

      ctx.fillStyle = '#0A0A0F';
      ctx.fillRect(0, 0, width, height);

      const padding = { left: 45, right: 20, top: 30, bottom: 40 };
      const plotWidth = width - padding.left - padding.right;
      const plotHeight = height - padding.top - padding.bottom;

      const xMin = 0, xMax = 2;
      const yMin = -0.3, yMax = 1.3;

      const toScreenX = (x) => padding.left + ((x - xMin) / (xMax - xMin)) * plotWidth;
      const toScreenY = (y) => padding.top + ((yMax - y) / (yMax - yMin)) * plotHeight;

      // Draw current interval
      ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
      ctx.fillRect(
        toScreenX(lubState.a), 
        padding.top, 
        toScreenX(lubState.b) - toScreenX(lubState.a), 
        plotHeight
      );

      // Draw previous intervals
      lubState.intervals.forEach((int, i) => {
        ctx.strokeStyle = `rgba(139, 92, 246, ${0.3 + i * 0.1})`;
        ctx.lineWidth = 1;
        ctx.setLineDash([3, 3]);
        ctx.strokeRect(
          toScreenX(int.a),
          padding.top,
          toScreenX(int.b) - toScreenX(int.a),
          plotHeight
        );
        ctx.setLineDash([]);
      });

      // Draw function
      ctx.strokeStyle = '#06B6D4';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let i = 0; i <= 100; i++) {
        const x = xMin + (i / 100) * (xMax - xMin);
        const y = lubFunction(x);
        const sx = toScreenX(x);
        const sy = toScreenY(y);
        if (i === 0) ctx.moveTo(sx, sy);
        else ctx.lineTo(sx, sy);
      }
      ctx.stroke();

      // Draw supremum line
      const sup = 1; // sin(π/2) = 1
      ctx.strokeStyle = '#EC4899';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(padding.left, toScreenY(sup));
      ctx.lineTo(width - padding.right, toScreenY(sup));
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = '#EC4899';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'right';
      ctx.fillText('sup = 1', padding.left - 5, toScreenY(sup) + 4);

      // Draw current bounds
      ctx.fillStyle = '#8B5CF6';
      ctx.beginPath();
      ctx.arc(toScreenX(lubState.a), toScreenY(lubFunction(lubState.a)), 6, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(toScreenX(lubState.b), toScreenY(lubFunction(lubState.b)), 6, 0, Math.PI * 2);
      ctx.fill();

      // Axis labels
      ctx.fillStyle = '#666';
      ctx.font = '10px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('0', toScreenX(0), height - padding.bottom + 15);
      ctx.fillText('1', toScreenX(1), height - padding.bottom + 15);
      ctx.fillText('2', toScreenX(2), height - padding.bottom + 15);

      // Update status
      lubStatus.innerHTML = `
        <p class="status-step">Step ${lubState.step}</p>
        <p class="status-interval">[a, b] = [${lubState.a.toFixed(4)}, ${lubState.b.toFixed(4)}]</p>
        <p class="status-explanation">
          Width: ${(lubState.b - lubState.a).toFixed(6)} | 
          Midpoint: ${((lubState.a + lubState.b) / 2).toFixed(4)}
        </p>
      `;
    }

    function lubStep() {
      if (lubState.b - lubState.a < 0.001) return;

      lubState.intervals.push({ a: lubState.a, b: lubState.b });
      
      const mid = (lubState.a + lubState.b) / 2;
      
      // Check: is mid + δ an upper bound, or is there x > mid with f(x) > f(mid)?
      // For sin(πx/2) on [0,2], the max is at x=1
      // If mid < 1, the max is in the right half
      // If mid >= 1, we need to check more carefully
      
      // Simplified: bisection toward x = 1
      if (mid < 1) {
        lubState.a = mid;
      } else {
        lubState.b = mid;
      }
      
      lubState.step++;
      drawLub();
    }

    function lubReset() {
      lubState = { a: 0, b: 2, step: 0, intervals: [], running: false };
      drawLub();
    }

    document.getElementById('lubStep').addEventListener('click', lubStep);
    document.getElementById('lubReset').addEventListener('click', lubReset);
    document.getElementById('lubAuto').addEventListener('click', () => {
      if (lubState.running) return;
      lubState.running = true;
      
      const autoRun = () => {
        if (lubState.b - lubState.a > 0.001) {
          lubStep();
          setTimeout(autoRun, 300);
        } else {
          lubState.running = false;
        }
      };
      autoRun();
    });

    // ============================================
    // WEAK IVT
    // ============================================
    
    const ivtCanvas = document.getElementById('ivtCanvas');
    const targetSlider = document.getElementById('targetSlider');
    const tolSlider = document.getElementById('tolSlider');
    const targetValue = document.getElementById('targetValue');
    const tolValue = document.getElementById('tolValue');
    const ivtResult = document.getElementById('ivtResult');
    const ivtX = document.getElementById('ivtX');
    const ivtExplanation = document.getElementById('ivtExplanation');

    let targetY = 0;
    let tolerance = 0.1;

    function ivtFunction(x) {
      return Math.sin(2 * x) - 0.3;
    }

    function drawIvt() {
      const { ctx, width, height } = setupCanvas(ivtCanvas);

      const padding = { left: 45, right: 20, top: 20, bottom: 35 };
      const plotWidth = width - padding.left - padding.right;
      const plotHeight = height - padding.top - padding.bottom;

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const xMin = 0, xMax = 3;
      const yMin = -1.5, yMax = 1.2;

      const toScreenX = (x) => padding.left + ((x - xMin) / (xMax - xMin)) * plotWidth;
      const toScreenY = (y) => padding.top + ((yMax - y) / (yMax - yMin)) * plotHeight;

      // Draw ε-band around target y
      ctx.fillStyle = 'rgba(245, 158, 11, 0.15)';
      const bandTop = toScreenY(targetY + tolerance);
      const bandBottom = toScreenY(targetY - tolerance);
      ctx.fillRect(padding.left, bandTop, plotWidth, bandBottom - bandTop);

      // Draw target line
      ctx.strokeStyle = '#F59E0B';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(padding.left, toScreenY(targetY));
      ctx.lineTo(width - padding.right, toScreenY(targetY));
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw zero line
      ctx.strokeStyle = '#CCC';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding.left, toScreenY(0));
      ctx.lineTo(width - padding.right, toScreenY(0));
      ctx.stroke();

      // Draw function
      ctx.strokeStyle = '#2563EB';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      for (let i = 0; i <= 100; i++) {
        const x = xMin + (i / 100) * (xMax - xMin);
        const y = ivtFunction(x);
        const sx = toScreenX(x);
        const sy = toScreenY(y);
        if (i === 0) ctx.moveTo(sx, sy);
        else ctx.lineTo(sx, sy);
      }
      ctx.stroke();

      // Find approximate solution via bisection
      let a = 0, b = 3;
      for (let i = 0; i < 20; i++) {
        const mid = (a + b) / 2;
        const fMid = ivtFunction(mid);
        if (Math.abs(fMid - targetY) < tolerance / 10) break;
        if ((ivtFunction(a) - targetY) * (fMid - targetY) < 0) {
          b = mid;
        } else {
          a = mid;
        }
      }
      const xSolution = (a + b) / 2;
      const fSolution = ivtFunction(xSolution);
      const error = Math.abs(fSolution - targetY);

      // Draw solution point
      ctx.fillStyle = error < tolerance ? '#10B981' : '#EF4444';
      ctx.beginPath();
      ctx.arc(toScreenX(xSolution), toScreenY(fSolution), 8, 0, Math.PI * 2);
      ctx.fill();

      // Vertical line from solution to target
      ctx.strokeStyle = error < tolerance ? 'rgba(16, 185, 129, 0.5)' : 'rgba(239, 68, 68, 0.5)';
      ctx.lineWidth = 2;
      ctx.setLineDash([3, 3]);
      ctx.beginPath();
      ctx.moveTo(toScreenX(xSolution), toScreenY(fSolution));
      ctx.lineTo(toScreenX(xSolution), toScreenY(targetY));
      ctx.stroke();
      ctx.setLineDash([]);

      // Update result
      ivtX.textContent = `x ≈ ${xSolution.toFixed(3)}`;
      ivtExplanation.textContent = `|f(x) - y| = ${error.toFixed(4)} ${error < tolerance ? '<' : '≥'} ε ${error < tolerance ? '✓' : '✗'}`;
      
      if (error < tolerance) {
        ivtResult.className = 'ivt-result approximate';
        ivtResult.querySelector('.result-title').textContent = 'Approximate Solution Found';
      } else {
        ivtResult.className = 'ivt-result exact';
        ivtResult.querySelector('.result-title').textContent = 'Need Smaller ε';
      }
    }

    targetSlider.addEventListener('input', () => {
      targetY = parseFloat(targetSlider.value);
      targetValue.textContent = `y = ${targetY.toFixed(2)}`;
      drawIvt();
    });

    tolSlider.addEventListener('input', () => {
      tolerance = parseFloat(tolSlider.value);
      tolValue.textContent = `ε = ${tolerance.toFixed(2)}`;
      drawIvt();
    });

    // ============================================
    // INITIALIZE
    // ============================================
    
    drawContinuity();
    drawLub();
    drawIvt();

    window.addEventListener('resize', () => {
      drawContinuity();
      drawLub();
      drawIvt();
    });
  </script>
</body>
</html>
