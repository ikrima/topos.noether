<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Completeness & The Completion — Chapter 4</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@300;400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --complete-color: #8B5CF6;
      --cauchy-color: #06B6D4;
      --regular-color: #22C55E;
      --limit-color: #EC4899;
      --sequence-color: #F59E0B;
      --background: #FAF8F5;
      --background-dark: #0F0F12;
      --ink: #1A1A1A;
      --ink-light: #FAF8F5;
      
      --display: 'Crimson Text', serif;
      --body: 'Source Sans Pro', sans-serif;
      --mono: 'JetBrains Mono', monospace;
      
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: var(--body);
      background: var(--background);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .opening {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: linear-gradient(180deg, var(--complete-color) 0%, #7C3AED 100%);
      color: var(--ink-light);
    }

    .opening-content {
      text-align: center;
      max-width: 800px;
    }

    .chapter-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.2s forwards;
    }

    .section-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.9);
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.3s forwards;
    }

    .main-title {
      font-family: var(--display);
      font-size: clamp(2rem, 6vw, 3.5rem);
      font-weight: 400;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.4s forwards;
    }

    .subtitle {
      font-size: 1.15rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 0.8s var(--ease-out-expo) 0.6s forwards;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .narrative-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }

    .narrative-section.dark {
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .narrative-content {
      max-width: 650px;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
    }

    .narrative-content.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .narrative-content p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .math-display {
      font-family: var(--mono);
      font-size: 0.95rem;
      background: rgba(139, 92, 246, 0.1);
      padding: 1.5rem;
      border-radius: 8px;
      text-align: center;
      margin: 1.5rem 0;
      border-left: 3px solid var(--complete-color);
    }

    .dark .math-display {
      background: rgba(139, 92, 246, 0.15);
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-family: var(--display);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: #666;
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Cauchy Section */
    .cauchy-section {
      padding: 4rem 2rem;
      background: linear-gradient(180deg, #F5F3F0 0%, var(--background) 100%);
    }

    .cauchy-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .cauchy-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .cauchy-canvas-container {
      height: 300px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #cauchyCanvas {
      width: 100%;
      height: 100%;
    }

    .cauchy-controls {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .control-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input[type="range"] {
      width: 120px;
      accent-color: var(--cauchy-color);
    }

    .slider-value {
      font-family: var(--mono);
      font-size: 0.9rem;
      min-width: 40px;
      color: var(--cauchy-color);
    }

    .cauchy-info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    @media (max-width: 700px) {
      .cauchy-info { grid-template-columns: 1fr; }
    }

    .info-card {
      background: #FAFAFA;
      padding: 1.2rem;
      border-radius: 10px;
      text-align: center;
    }

    .info-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #666;
      margin-bottom: 0.3rem;
    }

    .info-value {
      font-family: var(--mono);
      font-size: 1rem;
    }

    /* Regular Sequences Section */
    .regular-section {
      min-height: 100vh;
      padding: 4rem 2rem;
      background: var(--background-dark);
      color: var(--ink-light);
    }

    .regular-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .regular-panel {
      background: rgba(30, 30, 40, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.3);
      border-radius: 16px;
      padding: 2rem;
    }

    .regular-canvas-container {
      height: 320px;
      margin-bottom: 1.5rem;
    }

    #regularCanvas {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: #0A0A0F;
    }

    .regular-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .seq-btn {
      padding: 0.8rem 1.2rem;
      border: 2px solid var(--regular-color);
      border-radius: 8px;
      background: transparent;
      color: var(--regular-color);
      font-family: var(--mono);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .seq-btn:hover {
      background: rgba(34, 197, 94, 0.2);
    }

    .seq-btn.active {
      background: var(--regular-color);
      color: white;
    }

    .regular-explanation {
      background: rgba(34, 197, 94, 0.1);
      padding: 1.5rem;
      border-radius: 12px;
      border-left: 3px solid var(--regular-color);
    }

    .regular-explanation p {
      font-size: 0.95rem;
      margin-bottom: 0.8rem;
    }

    .regular-explanation p:last-child {
      margin-bottom: 0;
    }

    /* Completion Section */
    .completion-section {
      padding: 4rem 2rem;
      background: var(--background);
    }

    .completion-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .completion-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
      padding: 2rem;
    }

    .completion-canvas-container {
      height: 280px;
      background: #FAFAFA;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    #completionCanvas {
      width: 100%;
      height: 100%;
    }

    .completion-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .step-btn {
      padding: 0.8rem 1.5rem;
      border: 2px solid var(--complete-color);
      border-radius: 8px;
      background: transparent;
      color: var(--complete-color);
      font-family: var(--mono);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .step-btn:hover {
      background: rgba(139, 92, 246, 0.15);
    }

    .completion-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 600px) {
      .completion-info { grid-template-columns: 1fr; }
    }

    .completion-card {
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
    }

    .completion-card.q {
      background: rgba(6, 182, 212, 0.1);
      border: 2px solid var(--cauchy-color);
    }

    .completion-card.r {
      background: rgba(139, 92, 246, 0.1);
      border: 2px solid var(--complete-color);
    }

    .completion-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .completion-card.q .completion-label { color: var(--cauchy-color); }
    .completion-card.r .completion-label { color: var(--complete-color); }

    .completion-value {
      font-family: var(--display);
      font-size: 1.8rem;
    }

    .completion-card.q .completion-value { color: var(--cauchy-color); }
    .completion-card.r .completion-value { color: var(--complete-color); }

    .completion-desc {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0.5rem;
    }

    /* Navigation */
    .next-section {
      padding: 4rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, var(--complete-color) 0%, #7C3AED 100%);
      color: var(--ink-light);
      text-align: center;
    }

    .next-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
      margin-bottom: 1rem;
    }

    .next-title {
      font-family: var(--display);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .next-description {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 500px;
    }
  </style>
</head>
<body>

  <!-- Opening -->
  <section class="opening">
    <div class="opening-content">
      <p class="chapter-label">Chapter 4: Metric Spaces</p>
      <p class="section-label">Section 3: Completeness</p>
      <h1 class="main-title">Completeness & The Completion</h1>
      <p class="subtitle">A space is complete when Cauchy sequences converge. The completion fills in the gaps.</p>
    </div>
  </section>

  <!-- Narrative: Cauchy -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>A sequence (xₙ) is <strong>Cauchy</strong> if its terms eventually cluster together:</p>
      <div class="math-display">
        <strong>Definition 3.3:</strong> For each ε > 0, there exists N_ε such that<br>
        ρ(xₘ, xₙ) < ε &nbsp;&nbsp;whenever m, n ≥ N_ε
      </div>
      <p>The modulus N_ε is the <em>constructive content</em>: it tells you how far out to look.</p>
      <p>A space is <strong>complete</strong> if every Cauchy sequence converges to a point in the space.</p>
    </div>
  </section>

  <!-- Cauchy Sequence Visualization -->
  <section class="cauchy-section">
    <div class="section-header">
      <h2 class="section-title">Cauchy Sequences</h2>
      <p class="section-subtitle">Watch the terms cluster as n increases</p>
    </div>

    <div class="cauchy-container">
      <div class="cauchy-panel">
        <div class="cauchy-canvas-container">
          <canvas id="cauchyCanvas"></canvas>
        </div>

        <div class="cauchy-controls">
          <div class="control-group">
            <span class="control-label">Tolerance ε</span>
            <div class="slider-container">
              <input type="range" id="epsilonSlider" min="0.05" max="0.5" step="0.01" value="0.2">
              <span class="slider-value" id="epsilonValue">0.20</span>
            </div>
          </div>
          <div class="control-group">
            <span class="control-label">Terms shown</span>
            <div class="slider-container">
              <input type="range" id="termsSlider" min="5" max="30" step="1" value="15">
              <span class="slider-value" id="termsValue">15</span>
            </div>
          </div>
        </div>

        <div class="cauchy-info">
          <div class="info-card">
            <p class="info-label">Sequence</p>
            <p class="info-value" style="color: var(--cauchy-color);">xₙ = 1/n</p>
          </div>
          <div class="info-card">
            <p class="info-label">Modulus N(ε)</p>
            <p class="info-value" id="modulusValue" style="color: var(--sequence-color);">⌈1/ε⌉ = 5</p>
          </div>
          <div class="info-card">
            <p class="info-label">Limit</p>
            <p class="info-value" style="color: var(--limit-color);">0</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Regular Sequences -->
  <section class="regular-section">
    <div class="section-header" style="color: var(--ink-light);">
      <h2 class="section-title">Regular Sequences</h2>
      <p class="section-subtitle" style="color: #9CA3AF;">ρ(xₘ, xₙ) < m⁻¹ + n⁻¹ — a stronger condition with built-in modulus</p>
    </div>

    <div class="regular-container">
      <div class="regular-panel">
        <div class="regular-canvas-container">
          <canvas id="regularCanvas"></canvas>
        </div>

        <div class="regular-controls">
          <button class="seq-btn active" data-seq="sqrt2">√2 in ℚ</button>
          <button class="seq-btn" data-seq="e">e in ℚ</button>
          <button class="seq-btn" data-seq="pi">π in ℚ</button>
        </div>

        <div class="regular-explanation">
          <p><strong>Definition 3.1:</strong> A sequence (xₙ) is <em>regular</em> if ρ(xₘ, xₙ) < m⁻¹ + n⁻¹ for all m, n.</p>
          <p>Regular sequences have a <strong>built-in modulus</strong>: for tolerance ε, take N = ⌈2/ε⌉.</p>
          <p>The completion X̂ consists of equivalence classes of regular sequences, with equality: (xₙ) = (yₙ) iff ρ(xₙ, yₙ) < 2n⁻¹.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: The Completion -->
  <section class="narrative-section">
    <div class="narrative-content" data-animate>
      <p>The <strong>completion</strong> X̂ of a metric space X is built from regular sequences:</p>
      <div class="math-display">
        X̂ = { regular sequences in X } / ~<br><br>
        where (xₙ) ~ (yₙ) iff ρ(xₙ, yₙ) < 2n⁻¹
      </div>
      <p>The metric on X̂ is defined by:</p>
      <p style="font-family: var(--mono); text-align: center;">ρ̂((xₙ), (yₙ)) = lim ρ(xₙ, yₙ)</p>
      <p>This limit exists because the sequence (ρ(xₙ, yₙ)) is Cauchy in ℝ.</p>
    </div>
  </section>

  <!-- Completion Visualization -->
  <section class="completion-section">
    <div class="section-header">
      <h2 class="section-title">Building ℝ from ℚ</h2>
      <p class="section-subtitle">The completion of the rationals fills in the gaps</p>
    </div>

    <div class="completion-container">
      <div class="completion-panel">
        <div class="completion-canvas-container">
          <canvas id="completionCanvas"></canvas>
        </div>

        <div class="completion-controls">
          <button class="step-btn" id="addRational">Add Rational</button>
          <button class="step-btn" id="showLimit">Show Limit Point</button>
          <button class="step-btn" id="resetCompletion">Reset</button>
        </div>

        <div class="completion-info">
          <div class="completion-card q">
            <p class="completion-label">Rationals ℚ</p>
            <p class="completion-value">Incomplete</p>
            <p class="completion-desc">Has gaps (√2, e, π, ...)</p>
          </div>
          <div class="completion-card r">
            <p class="completion-label">Completion ℚ̂ = ℝ</p>
            <p class="completion-value">Complete</p>
            <p class="completion-desc">All Cauchy sequences converge</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Narrative: Baire Category -->
  <section class="narrative-section dark">
    <div class="narrative-content" data-animate>
      <p>A powerful consequence of completeness is the <strong>Baire Category Theorem</strong>:</p>
      <div class="math-display">
        <strong>Theorem 3.9:</strong> In a complete metric space,<br>
        the intersection of countably many dense open sets is dense.
      </div>
      <p>Constructively, this means: given a point x and radius r, we can <em>find</em> a point in S(x, r) that belongs to all the dense open sets.</p>
      <p>This is Cantor's diagonal technique in its most powerful form.</p>
    </div>
  </section>

  <!-- Navigation -->
  <section class="next-section">
    <p class="next-label">Coming Next</p>
    <h3 class="next-title">Total Boundedness & Compactness</h3>
    <p class="next-description">Compact = Complete + Totally Bounded. The constructive definition that makes analysis work.</p>
  </section>

  <script>
    // Scroll animations
    const observerOptions = { threshold: 0.3, rootMargin: '0px 0px -10% 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, observerOptions);
    document.querySelectorAll('[data-animate], .narrative-content').forEach(el => observer.observe(el));

    function setupCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      return { ctx, width: rect.width, height: rect.height };
    }

    // ============================================
    // CAUCHY SEQUENCE VISUALIZATION
    // ============================================
    
    const cauchyCanvas = document.getElementById('cauchyCanvas');
    let epsilon = 0.2;
    let numTerms = 15;

    function drawCauchy() {
      const { ctx, width, height } = setupCanvas(cauchyCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const margin = 60;
      const plotWidth = width - 2 * margin;
      const plotHeight = height - 2 * margin;

      // Axes
      ctx.strokeStyle = '#DDD';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(margin, margin);
      ctx.lineTo(margin, height - margin);
      ctx.lineTo(width - margin, height - margin);
      ctx.stroke();

      // Axis labels
      ctx.fillStyle = '#999';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'center';
      ctx.fillText('n', width - margin + 20, height - margin + 5);
      ctx.save();
      ctx.translate(margin - 25, height / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.fillText('xₙ', 0, 0);
      ctx.restore();

      // Y-axis scale (0 to 1)
      const yScale = (val) => height - margin - val * plotHeight;
      const xScale = (n) => margin + (n / numTerms) * plotWidth;

      // Grid lines
      ctx.strokeStyle = '#EEE';
      ctx.lineWidth = 1;
      for (let y = 0; y <= 1; y += 0.2) {
        ctx.beginPath();
        ctx.moveTo(margin, yScale(y));
        ctx.lineTo(width - margin, yScale(y));
        ctx.stroke();
        ctx.fillStyle = '#999';
        ctx.textAlign = 'right';
        ctx.fillText(y.toFixed(1), margin - 8, yScale(y) + 4);
      }

      // Epsilon band around limit (0)
      ctx.fillStyle = 'rgba(6, 182, 212, 0.15)';
      ctx.fillRect(margin, yScale(epsilon), plotWidth, yScale(-epsilon) - yScale(epsilon));
      ctx.strokeStyle = '#06B6D4';
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(margin, yScale(epsilon));
      ctx.lineTo(width - margin, yScale(epsilon));
      ctx.moveTo(margin, yScale(-epsilon));
      ctx.lineTo(width - margin, yScale(-epsilon));
      ctx.stroke();
      ctx.setLineDash([]);

      // N_epsilon line
      const N = Math.ceil(1 / epsilon);
      if (N <= numTerms) {
        ctx.strokeStyle = '#F59E0B';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(xScale(N), margin);
        ctx.lineTo(xScale(N), height - margin);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle = '#F59E0B';
        ctx.textAlign = 'center';
        ctx.fillText(`N=${N}`, xScale(N), margin - 10);
      }

      // Sequence points xₙ = 1/n
      ctx.fillStyle = '#06B6D4';
      for (let n = 1; n <= numTerms; n++) {
        const x = xScale(n);
        const y = yScale(1 / n);
        
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fill();
      }

      // Connect points
      ctx.strokeStyle = 'rgba(6, 182, 212, 0.5)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let n = 1; n <= numTerms; n++) {
        const x = xScale(n);
        const y = yScale(1 / n);
        if (n === 1) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Limit point
      ctx.fillStyle = '#EC4899';
      ctx.beginPath();
      ctx.arc(width - margin, yScale(0), 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#EC4899';
      ctx.textAlign = 'left';
      ctx.fillText('limit = 0', width - margin + 15, yScale(0) + 4);

      // Update modulus display
      document.getElementById('modulusValue').textContent = `⌈1/ε⌉ = ${N}`;
    }

    document.getElementById('epsilonSlider').addEventListener('input', (e) => {
      epsilon = parseFloat(e.target.value);
      document.getElementById('epsilonValue').textContent = epsilon.toFixed(2);
      drawCauchy();
    });

    document.getElementById('termsSlider').addEventListener('input', (e) => {
      numTerms = parseInt(e.target.value);
      document.getElementById('termsValue').textContent = numTerms;
      drawCauchy();
    });

    // ============================================
    // REGULAR SEQUENCES
    // ============================================
    
    const regularCanvas = document.getElementById('regularCanvas');
    let currentSeq = 'sqrt2';

    const sequences = {
      sqrt2: {
        name: '√2',
        approx: (n) => {
          // Newton's method for √2
          let x = 1;
          for (let i = 0; i < n; i++) x = (x + 2 / x) / 2;
          return x;
        },
        limit: Math.sqrt(2)
      },
      e: {
        name: 'e',
        approx: (n) => {
          let sum = 0;
          let fact = 1;
          for (let k = 0; k <= n + 3; k++) {
            if (k > 0) fact *= k;
            sum += 1 / fact;
          }
          return sum;
        },
        limit: Math.E
      },
      pi: {
        name: 'π',
        approx: (n) => {
          // Leibniz formula (slow but illustrative)
          let sum = 0;
          for (let k = 0; k <= n * 50; k++) {
            sum += Math.pow(-1, k) / (2 * k + 1);
          }
          return 4 * sum;
        },
        limit: Math.PI
      }
    };

    function drawRegular() {
      const { ctx, width, height } = setupCanvas(regularCanvas);
      const seq = sequences[currentSeq];

      ctx.fillStyle = '#0A0A0F';
      ctx.fillRect(0, 0, width, height);

      const margin = 60;
      const plotWidth = width - 2 * margin;
      const plotHeight = height - 2 * margin;
      const numTerms = 12;

      // Compute sequence values
      const values = [];
      for (let n = 1; n <= numTerms; n++) {
        values.push(seq.approx(n));
      }

      // Find y range
      const minY = Math.min(...values, seq.limit) - 0.1;
      const maxY = Math.max(...values, seq.limit) + 0.1;

      const yScale = (val) => height - margin - ((val - minY) / (maxY - minY)) * plotHeight;
      const xScale = (n) => margin + ((n - 1) / (numTerms - 1)) * plotWidth;

      // Axes
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(margin, margin);
      ctx.lineTo(margin, height - margin);
      ctx.lineTo(width - margin, height - margin);
      ctx.stroke();

      // Limit line
      ctx.strokeStyle = '#EC4899';
      ctx.lineWidth = 2;
      ctx.setLineDash([8, 4]);
      ctx.beginPath();
      ctx.moveTo(margin, yScale(seq.limit));
      ctx.lineTo(width - margin, yScale(seq.limit));
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = '#EC4899';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText(`${seq.name} = ${seq.limit.toFixed(6)}`, width - margin + 10, yScale(seq.limit) + 4);

      // Error bounds (1/n + 1/m ≈ 2/n for large n)
      for (let n = 1; n <= numTerms; n++) {
        const x = xScale(n);
        const errorBound = 2 / n;
        
        ctx.fillStyle = 'rgba(34, 197, 94, 0.1)';
        ctx.fillRect(x - 10, yScale(values[n-1] + errorBound), 20, 
                     yScale(values[n-1] - errorBound) - yScale(values[n-1] + errorBound));
      }

      // Connect points
      ctx.strokeStyle = 'rgba(34, 197, 94, 0.6)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      for (let n = 1; n <= numTerms; n++) {
        const x = xScale(n);
        const y = yScale(values[n-1]);
        if (n === 1) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Sequence points
      ctx.fillStyle = '#22C55E';
      for (let n = 1; n <= numTerms; n++) {
        const x = xScale(n);
        const y = yScale(values[n-1]);
        
        ctx.beginPath();
        ctx.arc(x, y, 6, 0, Math.PI * 2);
        ctx.fill();
      }

      // Labels
      ctx.fillStyle = '#666';
      ctx.textAlign = 'center';
      for (let n = 1; n <= numTerms; n += 2) {
        ctx.fillText(n.toString(), xScale(n), height - margin + 20);
      }
      ctx.fillText('n', width - margin + 15, height - margin + 5);
    }

    document.querySelectorAll('.seq-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.seq-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSeq = btn.dataset.seq;
        drawRegular();
      });
    });

    // ============================================
    // COMPLETION VISUALIZATION
    // ============================================
    
    const completionCanvas = document.getElementById('completionCanvas');
    let rationals = [];
    let showingLimit = false;
    let limitPoint = null;

    function drawCompletion() {
      const { ctx, width, height } = setupCanvas(completionCanvas);

      ctx.fillStyle = '#FAFAFA';
      ctx.fillRect(0, 0, width, height);

      const margin = 50;
      const lineY = height / 2;

      // Number line
      ctx.strokeStyle = '#CCC';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(margin, lineY);
      ctx.lineTo(width - margin, lineY);
      ctx.stroke();

      // Scale: 0 to 2
      const xScale = (val) => margin + (val / 2) * (width - 2 * margin);

      // Ticks
      ctx.fillStyle = '#999';
      ctx.font = '11px "JetBrains Mono"';
      ctx.textAlign = 'center';
      for (let v = 0; v <= 2; v += 0.5) {
        const x = xScale(v);
        ctx.beginPath();
        ctx.moveTo(x, lineY - 8);
        ctx.lineTo(x, lineY + 8);
        ctx.stroke();
        ctx.fillText(v.toFixed(1), x, lineY + 25);
      }

      // Draw rationals
      ctx.fillStyle = '#06B6D4';
      rationals.forEach(r => {
        ctx.beginPath();
        ctx.arc(xScale(r), lineY, 4, 0, Math.PI * 2);
        ctx.fill();
      });

      // Show limit point (√2)
      if (showingLimit && limitPoint !== null) {
        // Draw sequence converging to √2
        const sqrt2 = Math.sqrt(2);
        ctx.strokeStyle = 'rgba(236, 72, 153, 0.3)';
        ctx.lineWidth = 2;
        
        // Approximations
        let x = 1;
        for (let i = 0; i < 5; i++) {
          ctx.fillStyle = 'rgba(236, 72, 153, 0.5)';
          ctx.beginPath();
          ctx.arc(xScale(x), lineY - 20 - i * 8, 3, 0, Math.PI * 2);
          ctx.fill();
          x = (x + 2 / x) / 2;
        }

        // The limit point
        ctx.fillStyle = '#EC4899';
        ctx.beginPath();
        ctx.arc(xScale(sqrt2), lineY, 8, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = '#EC4899';
        ctx.font = '12px "JetBrains Mono"';
        ctx.fillText('√2', xScale(sqrt2), lineY - 35);
        ctx.font = '10px "JetBrains Mono"';
        ctx.fillText('(limit of Cauchy seq)', xScale(sqrt2), lineY - 50);
      }

      // Labels
      ctx.fillStyle = '#06B6D4';
      ctx.font = 'bold 14px "JetBrains Mono"';
      ctx.textAlign = 'left';
      ctx.fillText('ℚ', margin, lineY - 40);

      if (showingLimit) {
        ctx.fillStyle = '#8B5CF6';
        ctx.fillText('ℝ = ℚ̂', margin + 30, lineY - 40);
      }
    }

    document.getElementById('addRational').addEventListener('click', () => {
      // Add a random rational
      const denom = Math.floor(Math.random() * 10) + 2;
      const numer = Math.floor(Math.random() * (2 * denom));
      const r = numer / denom;
      if (r <= 2 && !rationals.includes(r)) {
        rationals.push(r);
        drawCompletion();
      }
    });

    document.getElementById('showLimit').addEventListener('click', () => {
      showingLimit = true;
      limitPoint = Math.sqrt(2);
      drawCompletion();
    });

    document.getElementById('resetCompletion').addEventListener('click', () => {
      rationals = [];
      showingLimit = false;
      limitPoint = null;
      drawCompletion();
    });

    // Initialize
    drawCauchy();
    drawRegular();
    drawCompletion();

    window.addEventListener('resize', () => {
      drawCauchy();
      drawRegular();
      drawCompletion();
    });
  </script>
</body>
</html>
