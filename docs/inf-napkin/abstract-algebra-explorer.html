<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Abstract Algebra Explorer - An Infinitely Large Napkin</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-purple: #a371f7;
            --accent-orange: #d29922;
            --accent-red: #f85149;
            --accent-cyan: #39c5cf;
            --accent-pink: #db61a2;
            --border-color: #30363d;
            --shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 17px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px;
        }

        header {
            padding: 80px 0 60px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 60px;
        }

        header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }

        header .chapter-info {
            margin-top: 24px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        section {
            margin-bottom: 100px;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 24px;
            color: var(--accent-purple);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h2::before {
            content: '';
            width: 4px;
            height: 32px;
            background: linear-gradient(180deg, var(--accent-purple), var(--accent-blue));
            border-radius: 2px;
        }

        h3 {
            font-size: 1.4rem;
            margin: 32px 0 16px;
            color: var(--accent-blue);
        }

        p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .highlight {
            color: var(--text-primary);
            font-weight: 500;
        }

        .math {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: var(--accent-cyan);
        }

        .definition-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--accent-purple);
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
        }

        .definition-box .label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-purple);
            margin-bottom: 12px;
        }

        .theorem-box {
            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
        }

        .theorem-box .label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-green);
            margin-bottom: 12px;
        }

        .interactive-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 32px 0;
            box-shadow: var(--shadow);
        }

        .interactive-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .interactive-title {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        select, input[type="range"], button, input[type="number"] {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        input[type="number"] {
            width: 70px;
        }

        select:hover, button:hover {
            border-color: var(--accent-blue);
        }

        button {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border: none;
            font-weight: 500;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        button.secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        input[type="range"] {
            width: 120px;
            padding: 0;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-cyan);
            border-radius: 50%;
            cursor: pointer;
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 8px;
            background: var(--bg-primary);
        }

        .canvas-container {
            position: relative;
            margin-bottom: 16px;
        }

        .info-panel {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .info-panel .value {
            color: var(--accent-cyan);
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: all 0.2s;
            border: none;
            background: none;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-blue);
            color: white;
        }

        .instructions {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 12px;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            color: var(--accent-cyan);
            font-family: monospace;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 2.2rem;
            }
        }

        .ring-table {
            display: grid;
            gap: 2px;
            background: var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            margin: 16px 0;
        }

        .ring-cell {
            background: var(--bg-tertiary);
            padding: 8px;
            text-align: center;
            font-family: monospace;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .ring-cell.header {
            background: var(--bg-secondary);
            color: var(--accent-blue);
            font-weight: 600;
        }

        .ring-cell.highlight-cell {
            background: rgba(88, 166, 255, 0.2);
        }

        .ideal-element {
            display: inline-block;
            padding: 4px 10px;
            margin: 2px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .ideal-element.in-ideal {
            background: rgba(163, 113, 247, 0.3);
            border: 1px solid var(--accent-purple);
        }

        .ideal-element.not-in-ideal {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }

        .hierarchy-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
        }

        .hierarchy-node {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            min-width: 200px;
            transition: all 0.3s;
        }

        .hierarchy-node.active {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .hierarchy-arrow {
            color: var(--text-muted);
            font-size: 1.5rem;
        }

        .factor-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: monospace;
            font-size: 1.1rem;
            flex-wrap: wrap;
            justify-content: center;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin: 16px 0;
        }

        .factor {
            padding: 6px 12px;
            border-radius: 4px;
            background: rgba(88, 166, 255, 0.2);
            border: 1px solid var(--accent-blue);
        }

        .factor.irreducible {
            background: rgba(63, 185, 80, 0.2);
            border-color: var(--accent-green);
        }

        .coset-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin: 16px 0;
        }

        .coset {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 100px;
            text-align: center;
            transition: all 0.3s;
        }

        .coset.selected {
            border-color: var(--accent-cyan);
            background: rgba(57, 197, 207, 0.1);
        }

        .coset-label {
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 8px;
        }

        .coset-elements {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        footer {
            text-align: center;
            padding: 60px 0;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
        }

        footer a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .fiber-viz {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            padding: 20px;
            min-height: 200px;
        }

        .fiber {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .fiber-point {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s;
        }

        .fiber-base {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            border: 3px solid;
        }

        .example-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .example-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .example-card.selected {
            border-color: var(--accent-cyan);
            background: rgba(57, 197, 207, 0.05);
        }

        .example-card h4 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .example-card p {
            font-size: 0.9rem;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Basic Abstract Algebra</h1>
            <p class="subtitle">From homomorphisms to quotient structures - discovering how algebraic objects relate through structure-preserving maps and the art of "modding out."</p>
            <p class="chapter-info">Chapters 3-5 from "An Infinitely Large Napkin" by Evan Chen</p>
        </div>
    </header>

    <main class="container">
        <!-- Introduction -->
        <section id="intro">
            <h2>The Big Picture</h2>
            <p>Abstract algebra is about <span class="highlight">structure</span>. We've seen groups (one operation), and now we'll explore how groups talk to each other through <span class="highlight">homomorphisms</span>, how to build new groups by "modding out" via <span class="highlight">quotients</span>, and then graduate to <span class="highlight">rings</span> (two operations: addition and multiplication).</p>

            <p>The key insight: instead of asking "what elements does this structure have?", we ask "how does this structure relate to others?" This perspective shift - from objects to morphisms - is one of the most powerful ideas in mathematics.</p>
        </section>

        <!-- Homomorphisms -->
        <section id="homomorphisms">
            <h2>Homomorphisms: Structure-Preserving Maps</h2>
            <p>A <span class="highlight">homomorphism</span> is a function between groups that respects the group operation. If <span class="math">&phi;: G &rarr; H</span> is a homomorphism, then <span class="math">&phi;(g&sdot;h) = &phi;(g)&sdot;&phi;(h)</span>.</p>

            <div class="definition-box">
                <div class="label">Definition</div>
                <p>A <span class="highlight">group homomorphism</span> <span class="math">&phi;: G &rarr; H</span> satisfies:</p>
                <p style="text-align: center; margin: 12px 0;"><span class="math">&phi;(g<sub>1</sub> &star; g<sub>2</sub>) = &phi;(g<sub>1</sub>) &ast; &phi;(g<sub>2</sub>)</span></p>
                <p>An <span class="highlight">isomorphism</span> is a bijective homomorphism - it says the groups are "the same."</p>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Homomorphism Visualizer</span>
                    <div class="controls">
                        <div class="control-group">
                            <label>Example:</label>
                            <select id="homSelect">
                                <option value="mod5">Z &rarr; Z/5Z (mod 5)</option>
                                <option value="sign">S&sub;3; &rarr; Z/2Z (sign)</option>
                                <option value="det">GL&sub;2;(R) &rarr; R* (det)</option>
                                <option value="trivial">G &rarr; {1} (trivial)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="canvas-container">
                    <canvas id="homCanvas" width="800" height="350"></canvas>
                </div>
                <p class="instructions">Click elements in the source group to see where they map. The kernel (elements mapping to identity) is highlighted.</p>
                <div class="info-panel" id="homInfo">
                    <div>Homomorphism: <span class="value" id="homName">&phi;: Z &rarr; Z/5Z</span></div>
                    <div style="margin-top: 8px;">Kernel: <span class="value" id="homKernel">{..., -10, -5, 0, 5, 10, ...} = 5Z</span></div>
                </div>
            </div>

            <h3>The Kernel</h3>
            <p>The <span class="highlight">kernel</span> of a homomorphism <span class="math">&phi;: G &rarr; H</span> is the set of elements that map to the identity:</p>
            <p style="text-align: center;"><span class="math">ker &phi; = {g &in; G : &phi;(g) = 1<sub>H</sub>}</span></p>
            <p>The kernel tells us how "information is lost" in the homomorphism. If ker &phi; = {1<sub>G</sub>}, then &phi; is injective - no information is lost!</p>
        </section>

        <!-- Cosets and Quotients -->
        <section id="quotients">
            <h2>Cosets and Quotient Groups</h2>
            <p>Given a subgroup <span class="math">N &le; G</span>, we can partition <span class="math">G</span> into <span class="highlight">cosets</span>. If <span class="math">N</span> is "nice" (a <span class="highlight">normal subgroup</span>), these cosets themselves form a group!</p>

            <div class="definition-box">
                <div class="label">Definition</div>
                <p>A <span class="highlight">left coset</span> of <span class="math">N</span> in <span class="math">G</span> is a set <span class="math">gN = {gn : n &in; N}</span>.</p>
                <p style="margin-top: 12px;"><span class="math">N</span> is <span class="highlight">normal</span> (written <span class="math">N &trianglelefteq; G</span>) if it is the kernel of some homomorphism, equivalently if <span class="math">gng<sup>-1</sup> &in; N</span> for all <span class="math">g &in; G</span>, <span class="math">n &in; N</span>.</p>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Coset Partition Explorer</span>
                    <div class="controls">
                        <div class="control-group">
                            <label>Group:</label>
                            <select id="cosetGroup">
                                <option value="z12">Z/12Z</option>
                                <option value="z8">Z/8Z</option>
                                <option value="d8">D&sub;8; (dihedral)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Subgroup:</label>
                            <select id="cosetSubgroup">
                                <option value="3">3Z (index 3)</option>
                                <option value="4">4Z (index 4)</option>
                                <option value="6">6Z (index 6)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="cosetDisplay" class="coset-container"></div>
                <div class="info-panel">
                    <div>Group order: <span class="value" id="groupOrder">12</span> | Subgroup order: <span class="value" id="subgroupOrder">4</span> | Number of cosets: <span class="value" id="numCosets">3</span></div>
                    <div style="margin-top: 8px;">Lagrange's Theorem: |G| = |N| &times; [G:N]</div>
                </div>
            </div>

            <h3>The Quotient Group</h3>
            <p>When <span class="math">N &trianglelefteq; G</span>, we can multiply cosets: <span class="math">(g<sub>1</sub>N)(g<sub>2</sub>N) = (g<sub>1</sub>g<sub>2</sub>)N</span>. The set of cosets with this operation forms the <span class="highlight">quotient group</span> <span class="math">G/N</span>.</p>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Quotient Group: Fibers Collapsing</span>
                </div>
                <div id="fiberViz" class="fiber-viz"></div>
                <div class="controls" style="justify-content: center; margin-top: 16px;">
                    <button id="animateCollapse">Animate Collapse</button>
                    <button id="resetFibers" class="secondary">Reset</button>
                </div>
                <p class="instructions">Watch how elements of G (top) collapse onto their cosets in G/N (bottom). Each "fiber" is a coset.</p>
            </div>

            <div class="theorem-box">
                <div class="label">First Isomorphism Theorem</div>
                <p>If <span class="math">&phi;: G &rarr; H</span> is a homomorphism, then <span class="math">G/ker(&phi;) &cong; im(&phi;)</span>.</p>
                <p style="margin-top: 8px;">In other words: modding out by the kernel gives you (an isomorphic copy of) the image.</p>
            </div>
        </section>

        <!-- Rings -->
        <section id="rings">
            <h2>Rings: Two Operations</h2>
            <p>A <span class="highlight">ring</span> has both addition and multiplication. Think of <span class="math">Z</span> as your prototype: you can add, subtract, and multiply integers, but division doesn't always work.</p>

            <div class="definition-box">
                <div class="label">Definition</div>
                <p>A <span class="highlight">ring</span> <span class="math">(R, +, &times;)</span> satisfies:</p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--text-secondary);">
                    <li><span class="math">(R, +)</span> is an abelian group with identity 0</li>
                    <li><span class="math">&times;</span> is associative with identity 1</li>
                    <li>Multiplication distributes over addition</li>
                </ul>
                <p style="margin-top: 12px;">A ring is <span class="highlight">commutative</span> if <span class="math">ab = ba</span>.</p>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Ring Operation Tables</span>
                    <div class="controls">
                        <div class="control-group">
                            <label>Ring:</label>
                            <select id="ringSelect">
                                <option value="z5">Z/5Z</option>
                                <option value="z6">Z/6Z</option>
                                <option value="z4">Z/4Z</option>
                                <option value="z8">Z/8Z</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Operation:</label>
                            <select id="ringOp">
                                <option value="add">Addition (+)</option>
                                <option value="mul">Multiplication (&times;)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="ringTable" class="ring-table"></div>
                <p class="instructions">Hover over cells to highlight the row and column. Look for patterns like zero divisors!</p>
                <div class="info-panel" id="ringInfo">
                    <div>Units (invertible elements): <span class="value" id="ringUnits">{1, 2, 3, 4}</span></div>
                    <div>Zero divisors: <span class="value" id="zeroDivisors">none</span></div>
                </div>
            </div>
        </section>

        <!-- Ideals -->
        <section id="ideals">
            <h2>Ideals: The Ring Analog of Normal Subgroups</h2>
            <p>Just as normal subgroups let us build quotient groups, <span class="highlight">ideals</span> let us build quotient rings. An ideal is a subset that "absorbs" multiplication from the whole ring.</p>

            <div class="definition-box">
                <div class="label">Definition</div>
                <p>A subset <span class="math">I &sube; R</span> is an <span class="highlight">ideal</span> if:</p>
                <ul style="margin-left: 24px; margin-top: 12px; color: var(--text-secondary);">
                    <li>I is closed under addition</li>
                    <li>For any <span class="math">x &in; I</span> and <span class="math">r &in; R</span>, we have <span class="math">rx &in; I</span></li>
                </ul>
                <p style="margin-top: 12px;">The ideal <span class="highlight">generated</span> by elements <span class="math">a<sub>1</sub>, ..., a<sub>n</sub></span> is <span class="math">(a<sub>1</sub>, ..., a<sub>n</sub>) = {r<sub>1</sub>a<sub>1</sub> + ... + r<sub>n</sub>a<sub>n</sub> : r<sub>i</sub> &in; R}</span>.</p>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Ideal Visualizer in Z/nZ</span>
                    <div class="controls">
                        <div class="control-group">
                            <label>Ring: Z/</label>
                            <select id="idealRing">
                                <option value="12">12Z</option>
                                <option value="15">15Z</option>
                                <option value="20">20Z</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Ideal (d):</label>
                            <select id="idealGen"></select>
                        </div>
                    </div>
                </div>
                <div id="idealDisplay" style="text-align: center; padding: 16px;"></div>
                <div class="info-panel">
                    <div>Ideal: <span class="value" id="idealDesc">(3) = 3Z/12Z = {0, 3, 6, 9}</span></div>
                    <div style="margin-top: 8px;">Quotient ring: <span class="value" id="quotientDesc">Z/12Z / (3) &cong; Z/3Z</span></div>
                </div>
            </div>

            <h3>Modding Out by Ideals</h3>
            <p>When we form <span class="math">R/I</span>, we're declaring that everything in <span class="math">I</span> equals zero. For example, <span class="math">Z/(5) = Z/5Z</span> is "integers mod 5" - we've declared all multiples of 5 to be zero.</p>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Polynomial Quotient Ring</span>
                </div>
                <div class="tabs" id="polyTabs">
                    <button class="tab active" data-poly="x">R[x]/(x) &cong; R</button>
                    <button class="tab" data-poly="x-3">R[x]/(x-3) &cong; R</button>
                    <button class="tab" data-poly="x2+1">R[x]/(x&sup2;+1) &cong; C</button>
                </div>
                <div id="polyInfo" class="info-panel">
                    <p>When we mod out <span class="math">R[x]</span> by <span class="math">(x)</span>, we're setting <span class="math">x = 0</span>.</p>
                    <p style="margin-top: 8px;">Every polynomial <span class="math">p(x)</span> becomes its constant term <span class="math">p(0)</span>.</p>
                    <p style="margin-top: 8px;">Result: <span class="value">R[x]/(x) &cong; R</span></p>
                </div>
            </div>
        </section>

        <!-- Flavors of Rings -->
        <section id="flavors">
            <h2>Flavors of Rings</h2>
            <p>Rings come in different "flavors" based on what nice properties they have. Let's build up a hierarchy!</p>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Ring Hierarchy</span>
                </div>
                <div class="hierarchy-container" id="ringHierarchy">
                    <div class="hierarchy-node" style="background: rgba(163, 113, 247, 0.3); border: 2px solid var(--accent-purple);" data-type="field">
                        Field
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">Every nonzero element is a unit</div>
                    </div>
                    <div class="hierarchy-arrow">&darr;</div>
                    <div class="hierarchy-node" style="background: rgba(63, 185, 80, 0.3); border: 2px solid var(--accent-green);" data-type="pid">
                        Principal Ideal Domain (PID)
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">Every ideal is (a) for some a</div>
                    </div>
                    <div class="hierarchy-arrow">&darr;</div>
                    <div class="hierarchy-node" style="background: rgba(88, 166, 255, 0.3); border: 2px solid var(--accent-blue);" data-type="ufd">
                        Unique Factorization Domain (UFD)
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">Unique factorization into irreducibles</div>
                    </div>
                    <div class="hierarchy-arrow">&darr;</div>
                    <div class="hierarchy-node" style="background: rgba(57, 197, 207, 0.3); border: 2px solid var(--accent-cyan);" data-type="domain">
                        Integral Domain
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">No zero divisors: ab=0 &rArr; a=0 or b=0</div>
                    </div>
                    <div class="hierarchy-arrow">&darr;</div>
                    <div class="hierarchy-node" style="background: rgba(210, 153, 34, 0.3); border: 2px solid var(--accent-orange);" data-type="ring">
                        Ring
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">Addition + Multiplication</div>
                    </div>
                </div>
                <p class="instructions">Click on each level to see examples!</p>
                <div class="info-panel" id="hierarchyInfo">
                    <p><strong>Field examples:</strong> Q, R, C, F<sub>p</sub> = Z/pZ for prime p</p>
                </div>
            </div>
        </section>

        <!-- Prime and Maximal Ideals -->
        <section id="prime-maximal">
            <h2>Prime and Maximal Ideals</h2>
            <p>Just as we have prime numbers in <span class="math">Z</span>, we have <span class="highlight">prime ideals</span> in rings. And there's an even stronger notion: <span class="highlight">maximal ideals</span>.</p>

            <div class="grid-2">
                <div class="definition-box">
                    <div class="label">Prime Ideal</div>
                    <p>A proper ideal <span class="math">I</span> is <span class="highlight">prime</span> if:</p>
                    <p style="margin: 12px 0;"><span class="math">ab &in; I &rArr; a &in; I or b &in; I</span></p>
                    <p><strong>Key fact:</strong> <span class="math">I</span> is prime iff <span class="math">R/I</span> is an integral domain.</p>
                </div>
                <div class="definition-box">
                    <div class="label">Maximal Ideal</div>
                    <p>A proper ideal <span class="math">I</span> is <span class="highlight">maximal</span> if it's not contained in any larger proper ideal.</p>
                    <p style="margin-top: 12px;"><strong>Key fact:</strong> <span class="math">I</span> is maximal iff <span class="math">R/I</span> is a field.</p>
                </div>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Ideal Lattice in Z</span>
                </div>
                <canvas id="latticeCanvas" width="800" height="350"></canvas>
                <p class="instructions">The ideal (n) contains (m) iff n divides m. Prime ideals are marked in green, maximal ideals have a double border.</p>
                <div class="info-panel">
                    <p>In Z, an ideal (p) is prime iff p is a prime number (or p=0).</p>
                    <p style="margin-top: 8px;">For nonzero ideals, prime = maximal in Z (since Z/(p) = F<sub>p</sub> is a field).</p>
                </div>
            </div>

            <div class="theorem-box">
                <div class="label">Maximal &rArr; Prime</div>
                <p>Every maximal ideal is prime (because every field is an integral domain).</p>
                <p style="margin-top: 8px;">The converse is false in general! In <span class="math">Z[x]</span>, the ideal <span class="math">(x)</span> is prime but not maximal (since <span class="math">Z[x]/(x) &cong; Z</span> is a domain but not a field).</p>
            </div>
        </section>

        <!-- UFD -->
        <section id="ufd">
            <h2>Unique Factorization</h2>
            <p>In <span class="math">Z</span>, every integer factors uniquely into primes. This doesn't hold in all rings!</p>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Factorization Explorer</span>
                    <div class="controls">
                        <div class="control-group">
                            <label>Ring:</label>
                            <select id="ufdRing">
                                <option value="Z">Z (UFD)</option>
                                <option value="Zi">Z[i] (UFD)</option>
                                <option value="Zsqrt5">Z[&radic;-5] (NOT UFD!)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="factorInput" style="text-align: center; padding: 16px;">
                    <div class="control-group" style="justify-content: center;">
                        <label>Factor:</label>
                        <input type="number" id="factorNum" value="30" min="2" max="1000">
                        <button id="factorBtn">Factorize</button>
                    </div>
                </div>
                <div id="factorResult" class="factor-display"></div>
                <div class="info-panel" id="ufdInfo">
                    <p>In Z, 30 = 2 &times; 3 &times; 5 (unique up to order and signs).</p>
                </div>
            </div>

            <h3>The Classic Counterexample</h3>
            <p>In <span class="math">Z[&radic;-5]</span>, we have:</p>
            <div class="factor-display">
                <span>6 = 2 &times; 3 = (1 - &radic;-5)(1 + &radic;-5)</span>
            </div>
            <p>Both factorizations are into irreducibles, but they're different! This is why <span class="math">Z[&radic;-5]</span> is NOT a UFD. The failure of unique factorization is one of the main motivations for studying ideals in algebraic number theory.</p>
        </section>

        <!-- Field of Fractions -->
        <section id="fractions">
            <h2>Field of Fractions</h2>
            <p>Just as we build <span class="math">Q</span> from <span class="math">Z</span> by "adding fractions," we can build a field from any integral domain.</p>

            <div class="definition-box">
                <div class="label">Definition</div>
                <p>The <span class="highlight">field of fractions</span> of an integral domain <span class="math">R</span> is:</p>
                <p style="margin: 12px 0; text-align: center;"><span class="math">Frac(R) = {a/b : a, b &in; R, b &ne; 0}</span></p>
                <p>with <span class="math">a/b = c/d</span> iff <span class="math">ad = bc</span>.</p>
            </div>

            <div class="interactive-container">
                <div class="interactive-header">
                    <span class="interactive-title">Building Fields of Fractions</span>
                </div>
                <div class="tabs" id="fracTabs">
                    <button class="tab active" data-frac="Z">Frac(Z) = Q</button>
                    <button class="tab" data-frac="Zi">Frac(Z[i]) = Q(i)</button>
                    <button class="tab" data-frac="poly">Frac(R[x]) = R(x)</button>
                </div>
                <div id="fracInfo" class="info-panel">
                    <p><strong>Z &rarr; Q:</strong> The rationals are fractions of integers.</p>
                    <p style="margin-top: 8px;">Example elements: 1/2, -3/7, 22/7</p>
                    <p style="margin-top: 8px;">Key property: Every nonzero element of Q has a multiplicative inverse.</p>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <div class="container">
            <p>Interactive exploration based on <a href="https://web.evanchen.cc/napkin.html">An Infinitely Large Napkin</a> by Evan Chen</p>
            <p style="margin-top: 8px;">Inspired by <a href="https://ciechanow.ski">Bartosz Ciechanowski</a> and <a href="http://worrydream.com">Bret Victor</a></p>
        </div>
    </footer>

    <script>
        // Utility functions
        const mod = (n, m) => ((n % m) + m) % m;
        const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
        const divisors = n => {
            const result = [];
            for (let i = 1; i <= n; i++) {
                if (n % i === 0) result.push(i);
            }
            return result;
        };

        // ==================== HOMOMORPHISM VISUALIZER ====================
        const homCanvas = document.getElementById('homCanvas');
        const homCtx = homCanvas.getContext('2d');

        const homomorphisms = {
            mod5: {
                name: 'Z → Z/5Z (mod 5)',
                source: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                target: [0, 1, 2, 3, 4],
                map: x => mod(x, 5),
                kernel: '5Z = {..., -10, -5, 0, 5, 10, ...}',
                sourceLabel: 'Z',
                targetLabel: 'Z/5Z'
            },
            sign: {
                name: 'S₃ → Z/2Z (sign)',
                source: ['e', '(12)', '(13)', '(23)', '(123)', '(132)'],
                target: ['+', '-'],
                map: x => ['e', '(123)', '(132)'].includes(x) ? '+' : '-',
                kernel: '{e, (123), (132)} = A₃',
                sourceLabel: 'S₃',
                targetLabel: 'Z/2Z'
            },
            det: {
                name: 'GL₂(R) → R* (det)',
                source: ['I', 'A', 'B', 'C', 'D'],
                target: ['det=1', 'det=2', 'det=-1'],
                map: x => x === 'I' ? 'det=1' : x === 'A' ? 'det=2' : x === 'B' ? 'det=-1' : x === 'C' ? 'det=1' : 'det=2',
                kernel: 'SL₂(R) = {matrices with det=1}',
                sourceLabel: 'GL₂(R)',
                targetLabel: 'R*'
            },
            trivial: {
                name: 'G → {1} (trivial)',
                source: ['a', 'b', 'c', 'd', 'e'],
                target: ['1'],
                map: x => '1',
                kernel: 'G (everything)',
                sourceLabel: 'G',
                targetLabel: '{1}'
            }
        };

        let currentHom = 'mod5';
        let selectedSource = null;

        function drawHomomorphism() {
            const ctx = homCtx;
            const w = homCanvas.width;
            const h = homCanvas.height;
            const hom = homomorphisms[currentHom];

            ctx.fillStyle = '#0d1117';
            ctx.fillRect(0, 0, w, h);

            const sourceY = 100;
            const targetY = 280;
            const sourceStartX = 80;
            const targetStartX = 200;

            // Draw labels
            ctx.fillStyle = '#8b949e';
            ctx.font = '14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(hom.sourceLabel, 40, sourceY);
            ctx.fillText(hom.targetLabel, 40, targetY);

            // Draw source elements
            const sourceSpacing = Math.min(60, (w - 160) / hom.source.length);
            hom.source.forEach((el, i) => {
                const x = sourceStartX + i * sourceSpacing;
                const isKernel = hom.map(el) === hom.target[0] || hom.map(el) === '+' || hom.map(el) === 'det=1' || hom.map(el) === '1';

                ctx.beginPath();
                ctx.arc(x, sourceY, 18, 0, Math.PI * 2);
                ctx.fillStyle = selectedSource === el ? 'rgba(57, 197, 207, 0.5)' :
                               isKernel ? 'rgba(163, 113, 247, 0.3)' : 'rgba(88, 166, 255, 0.3)';
                ctx.fill();
                ctx.strokeStyle = selectedSource === el ? '#39c5cf' : isKernel ? '#a371f7' : '#58a6ff';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = '#e6edf3';
                ctx.font = '11px monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(el.toString(), x, sourceY);

                // Draw arrow if selected
                if (selectedSource === el) {
                    const targetIdx = hom.target.indexOf(hom.map(el));
                    const targetX = targetStartX + targetIdx * 100;

                    ctx.strokeStyle = '#39c5cf';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(x, sourceY + 20);
                    ctx.lineTo(targetX, targetY - 20);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    // Arrow head
                    const angle = Math.atan2(targetY - 20 - sourceY - 20, targetX - x);
                    ctx.beginPath();
                    ctx.moveTo(targetX, targetY - 20);
                    ctx.lineTo(targetX - 10 * Math.cos(angle - 0.3), targetY - 20 - 10 * Math.sin(angle - 0.3));
                    ctx.moveTo(targetX, targetY - 20);
                    ctx.lineTo(targetX - 10 * Math.cos(angle + 0.3), targetY - 20 - 10 * Math.sin(angle + 0.3));
                    ctx.stroke();
                }
            });

            // Draw target elements
            const targetSpacing = 100;
            hom.target.forEach((el, i) => {
                const x = targetStartX + i * targetSpacing;
                const isImage = selectedSource !== null && hom.map(selectedSource) === el;

                ctx.beginPath();
                ctx.arc(x, targetY, 22, 0, Math.PI * 2);
                ctx.fillStyle = isImage ? 'rgba(57, 197, 207, 0.5)' : 'rgba(63, 185, 80, 0.3)';
                ctx.fill();
                ctx.strokeStyle = isImage ? '#39c5cf' : '#3fb950';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = '#e6edf3';
                ctx.font = '12px monospace';
                ctx.fillText(el.toString(), x, targetY);
            });

            // Update info
            document.getElementById('homName').textContent = hom.name;
            document.getElementById('homKernel').textContent = hom.kernel;
        }

        homCanvas.addEventListener('click', (e) => {
            const rect = homCanvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (homCanvas.width / rect.width);
            const y = (e.clientY - rect.top) * (homCanvas.height / rect.height);

            const hom = homomorphisms[currentHom];
            const sourceStartX = 80;
            const sourceSpacing = Math.min(60, (homCanvas.width - 160) / hom.source.length);

            if (y > 70 && y < 130) {
                hom.source.forEach((el, i) => {
                    const elX = sourceStartX + i * sourceSpacing;
                    if (Math.abs(x - elX) < 20) {
                        selectedSource = selectedSource === el ? null : el;
                        drawHomomorphism();
                    }
                });
            }
        });

        document.getElementById('homSelect').addEventListener('change', (e) => {
            currentHom = e.target.value;
            selectedSource = null;
            drawHomomorphism();
        });

        // ==================== COSET PARTITION ====================
        function updateCosets() {
            const groupSelect = document.getElementById('cosetGroup').value;
            const subgroupSelect = document.getElementById('cosetSubgroup').value;

            let n, d;
            if (groupSelect === 'z12') {
                n = 12;
            } else if (groupSelect === 'z8') {
                n = 8;
            } else {
                n = 8; // D8
            }

            d = parseInt(subgroupSelect);
            if (d > n) d = divisors(n)[1] || n;

            // Update subgroup options
            const subgroupSel = document.getElementById('cosetSubgroup');
            subgroupSel.innerHTML = '';
            divisors(n).forEach(div => {
                if (div > 1 && div < n) {
                    const opt = document.createElement('option');
                    opt.value = div;
                    opt.textContent = `${div}Z (index ${n/div})`;
                    if (div === d) opt.selected = true;
                    subgroupSel.appendChild(opt);
                }
            });

            // Build cosets
            const numCosets = n / d;
            const cosetDiv = document.getElementById('cosetDisplay');
            cosetDiv.innerHTML = '';

            const colors = ['#58a6ff', '#3fb950', '#a371f7', '#d29922', '#f85149', '#39c5cf'];

            for (let c = 0; c < numCosets; c++) {
                const coset = document.createElement('div');
                coset.className = 'coset';
                coset.style.borderColor = colors[c % colors.length];

                const label = document.createElement('div');
                label.className = 'coset-label';
                label.style.color = colors[c % colors.length];
                label.textContent = c === 0 ? `${d}Z` : `${c} + ${d}Z`;

                const elements = document.createElement('div');
                elements.className = 'coset-elements';
                const els = [];
                for (let i = 0; i < d; i++) {
                    els.push(mod(c + i * (n / d), n));
                }
                els.sort((a, b) => a - b);
                elements.textContent = `{${els.join(', ')}}`;

                coset.appendChild(label);
                coset.appendChild(elements);
                cosetDiv.appendChild(coset);
            }

            document.getElementById('groupOrder').textContent = n;
            document.getElementById('subgroupOrder').textContent = d;
            document.getElementById('numCosets').textContent = numCosets;
        }

        document.getElementById('cosetGroup').addEventListener('change', updateCosets);
        document.getElementById('cosetSubgroup').addEventListener('change', updateCosets);

        // ==================== FIBER VISUALIZATION ====================
        function setupFibers() {
            const container = document.getElementById('fiberViz');
            container.innerHTML = '';

            const n = 12;
            const d = 4;
            const numCosets = n / d;
            const colors = ['#58a6ff', '#3fb950', '#a371f7'];

            for (let c = 0; c < numCosets; c++) {
                const fiber = document.createElement('div');
                fiber.className = 'fiber';

                // Points in the fiber (top)
                for (let i = d - 1; i >= 0; i--) {
                    const el = mod(c + i * numCosets, n);
                    const point = document.createElement('div');
                    point.className = 'fiber-point';
                    point.id = `fiber-point-${el}`;
                    point.style.backgroundColor = colors[c];
                    point.textContent = el;
                    fiber.appendChild(point);
                }

                // Base point (bottom)
                const base = document.createElement('div');
                base.className = 'fiber-base';
                base.style.borderColor = colors[c];
                base.style.color = colors[c];
                base.textContent = c;
                fiber.appendChild(base);

                container.appendChild(fiber);
            }
        }

        document.getElementById('animateCollapse').addEventListener('click', () => {
            const points = document.querySelectorAll('.fiber-point');
            points.forEach((p, i) => {
                setTimeout(() => {
                    p.style.transform = 'translateY(100px) scale(0.5)';
                    p.style.opacity = '0.3';
                }, i * 50);
            });
        });

        document.getElementById('resetFibers').addEventListener('click', () => {
            const points = document.querySelectorAll('.fiber-point');
            points.forEach(p => {
                p.style.transform = '';
                p.style.opacity = '';
            });
        });

        // ==================== RING TABLES ====================
        function updateRingTable() {
            const ringSelect = document.getElementById('ringSelect').value;
            const op = document.getElementById('ringOp').value;

            let n;
            if (ringSelect === 'z5') n = 5;
            else if (ringSelect === 'z6') n = 6;
            else if (ringSelect === 'z4') n = 4;
            else n = 8;

            const table = document.getElementById('ringTable');
            table.innerHTML = '';
            table.style.gridTemplateColumns = `repeat(${n + 1}, 1fr)`;

            // Header row
            const opSymbol = op === 'add' ? '+' : '×';
            const headerCell = document.createElement('div');
            headerCell.className = 'ring-cell header';
            headerCell.textContent = opSymbol;
            table.appendChild(headerCell);

            for (let i = 0; i < n; i++) {
                const cell = document.createElement('div');
                cell.className = 'ring-cell header';
                cell.textContent = i;
                table.appendChild(cell);
            }

            // Data rows
            for (let i = 0; i < n; i++) {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'ring-cell header';
                rowHeader.textContent = i;
                table.appendChild(rowHeader);

                for (let j = 0; j < n; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'ring-cell';
                    const result = op === 'add' ? mod(i + j, n) : mod(i * j, n);
                    cell.textContent = result;
                    cell.dataset.row = i;
                    cell.dataset.col = j;

                    // Highlight zero divisors
                    if (op === 'mul' && i !== 0 && j !== 0 && result === 0) {
                        cell.style.background = 'rgba(248, 81, 73, 0.3)';
                    }

                    cell.addEventListener('mouseenter', () => highlightRowCol(i, j));
                    cell.addEventListener('mouseleave', clearHighlight);
                    table.appendChild(cell);
                }
            }

            // Update info
            const units = [];
            const zeroDivs = [];
            for (let i = 1; i < n; i++) {
                let isUnit = false;
                for (let j = 1; j < n; j++) {
                    if (mod(i * j, n) === 1) {
                        isUnit = true;
                        break;
                    }
                }
                if (isUnit) units.push(i);
                else zeroDivs.push(i);
            }

            document.getElementById('ringUnits').textContent = units.length > 0 ? `{${units.join(', ')}}` : 'none';
            document.getElementById('zeroDivisors').textContent = zeroDivs.length > 0 ? `{${zeroDivs.join(', ')}}` : 'none';
        }

        function highlightRowCol(row, col) {
            const cells = document.querySelectorAll('.ring-cell');
            cells.forEach(cell => {
                if (cell.dataset.row == row || cell.dataset.col == col) {
                    cell.classList.add('highlight-cell');
                }
            });
        }

        function clearHighlight() {
            const cells = document.querySelectorAll('.ring-cell');
            cells.forEach(cell => cell.classList.remove('highlight-cell'));
        }

        document.getElementById('ringSelect').addEventListener('change', updateRingTable);
        document.getElementById('ringOp').addEventListener('change', updateRingTable);

        // ==================== IDEAL VISUALIZER ====================
        function updateIdealDisplay() {
            const n = parseInt(document.getElementById('idealRing').value);
            const genSelect = document.getElementById('idealGen');

            // Update generator options
            genSelect.innerHTML = '';
            divisors(n).forEach(d => {
                if (d > 0 && d <= n) {
                    const opt = document.createElement('option');
                    opt.value = d;
                    opt.textContent = `(${d})`;
                    genSelect.appendChild(opt);
                }
            });

            displayIdeal();
        }

        function displayIdeal() {
            const n = parseInt(document.getElementById('idealRing').value);
            const d = parseInt(document.getElementById('idealGen').value) || divisors(n)[1];

            const display = document.getElementById('idealDisplay');
            display.innerHTML = '';

            for (let i = 0; i < n; i++) {
                const el = document.createElement('span');
                el.className = 'ideal-element';
                el.textContent = i;
                if (i % d === 0) {
                    el.classList.add('in-ideal');
                } else {
                    el.classList.add('not-in-ideal');
                }
                display.appendChild(el);
            }

            const idealElements = [];
            for (let i = 0; i < n; i += d) idealElements.push(i);

            document.getElementById('idealDesc').textContent =
                `(${d}) = ${d}Z/${n}Z = {${idealElements.join(', ')}}`;
            document.getElementById('quotientDesc').textContent =
                `Z/${n}Z / (${d}) ≅ Z/${d}Z (${d} elements)`;
        }

        document.getElementById('idealRing').addEventListener('change', updateIdealDisplay);
        document.getElementById('idealGen').addEventListener('change', displayIdeal);

        // ==================== POLYNOMIAL QUOTIENTS ====================
        document.querySelectorAll('#polyTabs .tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('#polyTabs .tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const poly = tab.dataset.poly;
                const info = document.getElementById('polyInfo');

                if (poly === 'x') {
                    info.innerHTML = `
                        <p>When we mod out <span class="math">R[x]</span> by <span class="math">(x)</span>, we're setting <span class="math">x = 0</span>.</p>
                        <p style="margin-top: 8px;">Every polynomial <span class="math">p(x)</span> becomes its constant term <span class="math">p(0)</span>.</p>
                        <p style="margin-top: 8px;">Result: <span class="value">R[x]/(x) ≅ R</span></p>
                    `;
                } else if (poly === 'x-3') {
                    info.innerHTML = `
                        <p>When we mod out <span class="math">R[x]</span> by <span class="math">(x-3)</span>, we're setting <span class="math">x = 3</span>.</p>
                        <p style="margin-top: 8px;">Every polynomial <span class="math">p(x)</span> becomes <span class="math">p(3)</span>.</p>
                        <p style="margin-top: 8px;">Result: <span class="value">R[x]/(x-3) ≅ R</span> (differently!)</p>
                    `;
                } else {
                    info.innerHTML = `
                        <p>When we mod out <span class="math">R[x]</span> by <span class="math">(x² + 1)</span>, we're setting <span class="math">x² = -1</span>.</p>
                        <p style="margin-top: 8px;">Now x behaves like <span class="math">i = √(-1)</span>!</p>
                        <p style="margin-top: 8px;">Result: <span class="value">R[x]/(x² + 1) ≅ C</span></p>
                        <p style="margin-top: 8px;">This is how we can <em>construct</em> the complex numbers from the reals!</p>
                    `;
                }
            });
        });

        // ==================== RING HIERARCHY ====================
        document.querySelectorAll('.hierarchy-node').forEach(node => {
            node.addEventListener('click', () => {
                document.querySelectorAll('.hierarchy-node').forEach(n => n.classList.remove('active'));
                node.classList.add('active');

                const type = node.dataset.type;
                const info = document.getElementById('hierarchyInfo');

                const examples = {
                    field: '<p><strong>Field examples:</strong> Q, R, C, F<sub>p</sub> = Z/pZ for prime p</p><p style="margin-top: 8px;">Every nonzero element has a multiplicative inverse. You can divide!</p>',
                    pid: '<p><strong>PID examples:</strong> Z, k[x] for any field k</p><p style="margin-top: 8px;">Every ideal is generated by a single element. This lets you compute GCDs!</p>',
                    ufd: '<p><strong>UFD examples:</strong> Z, Z[i], k[x], k[x,y]</p><p style="margin-top: 8px;">Unique factorization into irreducibles (up to units). The fundamental theorem of arithmetic generalizes!</p>',
                    domain: '<p><strong>Integral domain examples:</strong> Z, Z[x], any subring of a field</p><p style="margin-top: 8px;">No zero divisors: if ab = 0, then a = 0 or b = 0. You can cancel!</p>',
                    ring: '<p><strong>Ring examples:</strong> Z/6Z (has zero divisors: 2·3 = 0), matrices M<sub>n</sub>(R)</p><p style="margin-top: 8px;">Just addition and multiplication with the basic axioms.</p>'
                };

                info.innerHTML = examples[type];
            });
        });

        // ==================== IDEAL LATTICE ====================
        const latticeCanvas = document.getElementById('latticeCanvas');
        const latticeCtx = latticeCanvas.getContext('2d');

        function drawIdealLattice() {
            const ctx = latticeCtx;
            const w = latticeCanvas.width;
            const h = latticeCanvas.height;

            ctx.fillStyle = '#0d1117';
            ctx.fillRect(0, 0, w, h);

            // Draw ideal lattice for small integers
            const ideals = [
                { n: 0, x: 400, y: 50, label: '(0)', prime: true },
                { n: 1, x: 400, y: 310, label: 'Z', prime: false },
                { n: 2, x: 200, y: 200, label: '(2)', prime: true },
                { n: 3, x: 350, y: 200, label: '(3)', prime: true },
                { n: 5, x: 500, y: 200, label: '(5)', prime: true },
                { n: 7, x: 650, y: 200, label: '(7)', prime: true },
                { n: 4, x: 100, y: 130, label: '(4)', prime: false },
                { n: 6, x: 280, y: 130, label: '(6)', prime: false },
                { n: 10, x: 450, y: 130, label: '(10)', prime: false },
                { n: 12, x: 180, y: 80, label: '(12)', prime: false },
            ];

            // Draw containment lines
            const containments = [
                [0, 2], [0, 3], [0, 5], [0, 7],
                [2, 4], [2, 6], [2, 10],
                [3, 6], [5, 10],
                [4, 12], [6, 12],
                [4, 1], [6, 1], [10, 1], [12, 1],
                [2, 1], [3, 1], [5, 1], [7, 1]
            ];

            ctx.strokeStyle = '#30363d';
            ctx.lineWidth = 1;
            containments.forEach(([i, j]) => {
                const a = ideals.find(x => x.n === i);
                const b = ideals.find(x => x.n === j);
                if (a && b) {
                    ctx.beginPath();
                    ctx.moveTo(a.x, a.y);
                    ctx.lineTo(b.x, b.y);
                    ctx.stroke();
                }
            });

            // Draw ideals
            ideals.forEach(ideal => {
                ctx.beginPath();
                ctx.arc(ideal.x, ideal.y, 25, 0, Math.PI * 2);

                if (ideal.prime && ideal.n !== 0) {
                    ctx.fillStyle = 'rgba(63, 185, 80, 0.3)';
                    ctx.fill();
                    ctx.strokeStyle = '#3fb950';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    // Double border for maximal
                    ctx.beginPath();
                    ctx.arc(ideal.x, ideal.y, 30, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (ideal.n === 0) {
                    ctx.fillStyle = 'rgba(163, 113, 247, 0.3)';
                    ctx.fill();
                    ctx.strokeStyle = '#a371f7';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                } else {
                    ctx.fillStyle = 'rgba(88, 166, 255, 0.2)';
                    ctx.fill();
                    ctx.strokeStyle = '#58a6ff';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                ctx.fillStyle = '#e6edf3';
                ctx.font = '12px monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(ideal.label, ideal.x, ideal.y);
            });

            // Legend
            ctx.font = '11px sans-serif';
            ctx.fillStyle = '#8b949e';
            ctx.textAlign = 'left';
            ctx.fillText('Green with double border = prime (& maximal)', 20, h - 20);
            ctx.fillText('Lines show containment: (n) ⊃ (m) iff n | m', 20, h - 40);
        }

        // ==================== UFD FACTORIZATION ====================
        function primeFactors(n) {
            const factors = [];
            let d = 2;
            while (d * d <= n) {
                while (n % d === 0) {
                    factors.push(d);
                    n /= d;
                }
                d++;
            }
            if (n > 1) factors.push(n);
            return factors;
        }

        function updateFactorization() {
            const ring = document.getElementById('ufdRing').value;
            const num = parseInt(document.getElementById('factorNum').value) || 30;
            const result = document.getElementById('factorResult');
            const info = document.getElementById('ufdInfo');

            if (ring === 'Z') {
                const factors = primeFactors(Math.abs(num));
                result.innerHTML = `<span>${num} = </span>` +
                    factors.map(f => `<span class="factor irreducible">${f}</span>`).join('<span> × </span>');
                info.innerHTML = `<p>In Z, ${num} factors uniquely as ${factors.join(' × ')}.</p>`;
            } else if (ring === 'Zi') {
                // Gaussian integer factorization (simplified)
                result.innerHTML = `<span>Factorization in Z[i]:</span>`;
                if (num === 5) {
                    result.innerHTML += `<br><span>5 = </span><span class="factor irreducible">(2+i)</span><span> × </span><span class="factor irreducible">(2-i)</span>`;
                    info.innerHTML = `<p>In Z[i], 5 splits as (2+i)(2-i) because 5 ≡ 1 (mod 4).</p>`;
                } else if (num === 2) {
                    result.innerHTML += `<br><span>2 = </span><span class="factor irreducible">-i(1+i)²</span>`;
                    info.innerHTML = `<p>In Z[i], 2 = -i(1+i)². The prime 2 ramifies in Z[i].</p>`;
                } else {
                    result.innerHTML += `<br><span>${num} = </span>` +
                        primeFactors(num).map(f => `<span class="factor">${f}</span>`).join('<span> × </span>');
                    info.innerHTML = `<p>Z[i] is a UFD. Primes p ≡ 1 (mod 4) split, p ≡ 3 (mod 4) stay prime.</p>`;
                }
            } else {
                // Z[sqrt(-5)] - not a UFD
                if (num === 6) {
                    result.innerHTML = `
                        <div>6 = <span class="factor irreducible">2</span> × <span class="factor irreducible">3</span></div>
                        <div style="margin-top: 8px;">6 = <span class="factor irreducible">(1-√-5)</span> × <span class="factor irreducible">(1+√-5)</span></div>
                    `;
                    info.innerHTML = `<p><strong>NOT UNIQUE!</strong> Both factorizations are into irreducibles, but they're different.</p>
                        <p style="margin-top: 8px;">This is why Z[√-5] is NOT a UFD. This failure motivates ideal theory!</p>`;
                } else {
                    result.innerHTML = `<span>Enter 6 to see the classic counterexample!</span>`;
                    info.innerHTML = `<p>Z[√-5] is not a UFD. Try factoring 6.</p>`;
                }
            }
        }

        document.getElementById('factorBtn').addEventListener('click', updateFactorization);
        document.getElementById('ufdRing').addEventListener('change', updateFactorization);

        // ==================== FIELD OF FRACTIONS ====================
        document.querySelectorAll('#fracTabs .tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('#fracTabs .tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const frac = tab.dataset.frac;
                const info = document.getElementById('fracInfo');

                if (frac === 'Z') {
                    info.innerHTML = `
                        <p><strong>Z → Q:</strong> The rationals are fractions of integers.</p>
                        <p style="margin-top: 8px;">Example elements: 1/2, -3/7, 22/7</p>
                        <p style="margin-top: 8px;">Key property: Every nonzero element of Q has a multiplicative inverse.</p>
                    `;
                } else if (frac === 'Zi') {
                    info.innerHTML = `
                        <p><strong>Z[i] → Q(i):</strong> The Gaussian rationals.</p>
                        <p style="margin-top: 8px;">Q(i) = {a + bi : a, b ∈ Q}</p>
                        <p style="margin-top: 8px;">Example: (3+2i)/(1-i) = (3+2i)(1+i)/2 = (1+5i)/2</p>
                    `;
                } else {
                    info.innerHTML = `
                        <p><strong>R[x] → R(x):</strong> The field of rational functions.</p>
                        <p style="margin-top: 8px;">Elements are ratios of polynomials: f(x)/g(x)</p>
                        <p style="margin-top: 8px;">Example: (x² + 1)/(x - 3) is an element of R(x)</p>
                    `;
                }
            });
        });

        // ==================== INITIALIZATION ====================
        function init() {
            drawHomomorphism();
            updateCosets();
            setupFibers();
            updateRingTable();
            updateIdealDisplay();
            drawIdealLattice();
            updateFactorization();
        }

        init();
    </script>
</body>
</html>
