<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monodromy Atomization — North Star</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Chart Container Styles as per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px; /* Constraint for larger screens */
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* Base height */
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        /* Warm Neutral Palette overrides */
        body {
            background-color: #fdfbf7; /* Warm off-white */
            color: #4a4a4a; /* Soft charcoal */
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .active-tab {
            border-bottom: 3px solid #d97706; /* amber-600 */
            color: #d97706;
            font-weight: 600;
        }

        .console-text {
            font-family: 'Courier New', Courier, monospace;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- REQUIRED PLACEHOLDERS -->
    <!-- Chosen Palette: Warm Neutrals (Background: #fdfbf7, Text: #4a4a4a, Accents: Amber/Stone) -->
    <!-- Application Structure Plan:
         1. Header: Mission & Core Concept.
         2. Interactive Cycle (Chart.js): The "Monodromy" core loop. Users click segments to understand phases.
         3. The Atom Pack (Grid): Interactive cards defining the irreducible components.
         4. The Ladder (Vertical Steps): Visualizing the MLIR levels (Idea -> Code).
         5. Theory & Hypotheses (Tabs): Switching between Category Theory, HoTT, and key hypotheses.
         6. Simulation Console: A functional mock-up of the "MVP0" engine to demonstrate the process flow.
         Rationale: This structure breaks the dense theory into consumable "atoms" of information, moving from high-level process to specific components, then underlying theory, and finally practical application.
    -->
    <!-- Visualization & Content Choices:
         1. Monodromy Loop -> Goal: Show the cyclic process -> Viz: Interactive Doughnut Chart (Chart.js) -> Interaction: Click segment to update description. -> Justification: Circles intuitively represent loops; interactive clicks allow focus on specific steps.
         2. Atom Pack -> Goal: Define components -> Viz: CSS Grid of Cards -> Interaction: Hover/Click to expand details. -> Justification: Clean, organized way to present a set of items.
         3. Logic Console -> Goal: Demonstrate the "Engine" -> Viz: Terminal-style div -> Interaction: Button trigger JS simulation. -> Justification: Makes the abstract "functions" concrete.
         Confirming NO SVG/Mermaid.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Header Section -->
    <header class="w-full bg-[#f3f0eb] border-b border-[#e5e0d8] py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight mb-2">Monodromy Atomization</h1>
            <p class="text-lg md:text-xl text-[#d97706] font-medium mb-4">North Star Methodology</p>
            <p class="max-w-3xl text-gray-600 leading-relaxed">
                Mission: Turn the long, messy path from ideation to V1 into a repeatable, compressible process that yields a small set of irreducible <strong>atoms</strong> from which the product can be regenerated.
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8 space-y-16">

        <!-- SECTION 1: The Core Loop (Monodromy) -->
        <section id="core-loop" class="bg-white rounded-xl shadow-sm border border-[#e5e0d8] p-6 md:p-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">The Monodromy Loop</h2>
                <p class="text-gray-500 mt-2">
                    The central engine of the methodology. It is not just iteration; it is a search for stability. Click the chart segments below to explore each phase of the cycle.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <!-- Interactive Visualization -->
                <div class="w-full flex justify-center">
                    <div class="chart-container">
                        <canvas id="monodromyChart"></canvas>
                    </div>
                </div>

                <!-- Contextual Details -->
                <div class="bg-[#f9f8f6] rounded-lg p-6 border border-[#e5e0d8] h-full flex flex-col justify-center">
                    <h3 id="loop-phase-title" class="text-xl font-bold text-[#d97706] mb-3">Select a Phase</h3>
                    <p id="loop-phase-desc" class="text-gray-700 leading-relaxed mb-4">
                        Interact with the cycle on the left to understand how we move from generation to distillation. The goal is to hunt for "eigenatoms"—stable fixed points in the product definition.
                    </p>
                    <div id="loop-phase-meta" class="hidden border-t border-gray-200 pt-4 mt-2">
                        <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Key Action</span>
                        <p id="loop-phase-action" class="font-medium text-gray-800 mt-1">...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: The Atom Pack -->
        <section id="atoms" class="space-y-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">The Atom Pack</h2>
                <p class="text-gray-600 mt-2 max-w-4xl">
                    An atom is a minimal, composable artifact with high regenerative power. If it can be removed without losing the ability to reconstruct the product, it is not an atom. Below are the 8 irreducible components of a practical Atom Pack.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Cards generated via JS to ensure consistency, but structure mocked here for layout check -->
                <!-- Filled by JS function renderAtoms() -->
                <div id="atom-grid-container" class="contents"></div>
            </div>
        </section>

        <!-- SECTION 3: MLIR-Style Multi-Level IR -->
        <section id="ir-ladder" class="bg-white rounded-xl shadow-sm border border-[#e5e0d8] overflow-hidden">
            <div class="p-6 md:p-8 border-b border-[#e5e0d8]">
                <h2 class="text-2xl font-bold text-gray-800">The IR Ladder</h2>
                <p class="text-gray-600 mt-2">
                    A compilation ladder where each "lowering" step preserves invariants and increases executability. The process moves between high-level ideas and concrete code.
                </p>
            </div>
            
            <div class="flex flex-col md:flex-row">
                <!-- Control/Step List -->
                <div class="w-full md:w-1/3 bg-[#fdfbf7] border-r border-[#e5e0d8] p-4 space-y-2">
                    <button onclick="updateIR('IdeaIR')" class="ir-btn w-full text-left p-4 rounded-lg hover:bg-[#f3f0eb] focus:outline-none transition-colors border-l-4 border-transparent active-ir" data-ir="IdeaIR">
                        <span class="text-sm text-gray-400 font-mono">01</span>
                        <span class="block text-lg font-bold text-gray-800">IdeaIR</span>
                    </button>
                    <div class="flex justify-center text-gray-300 py-1 text-xl">↓</div>
                    <button onclick="updateIR('ProductIR')" class="ir-btn w-full text-left p-4 rounded-lg hover:bg-[#f3f0eb] focus:outline-none transition-colors border-l-4 border-transparent" data-ir="ProductIR">
                        <span class="text-sm text-gray-400 font-mono">02</span>
                        <span class="block text-lg font-bold text-gray-800">ProductIR</span>
                    </button>
                    <div class="flex justify-center text-gray-300 py-1 text-xl">↓</div>
                    <button onclick="updateIR('SystemIR')" class="ir-btn w-full text-left p-4 rounded-lg hover:bg-[#f3f0eb] focus:outline-none transition-colors border-l-4 border-transparent" data-ir="SystemIR">
                        <span class="text-sm text-gray-400 font-mono">03</span>
                        <span class="block text-lg font-bold text-gray-800">SystemIR</span>
                    </button>
                    <div class="flex justify-center text-gray-300 py-1 text-xl">↓</div>
                    <button onclick="updateIR('CodeIR')" class="ir-btn w-full text-left p-4 rounded-lg hover:bg-[#f3f0eb] focus:outline-none transition-colors border-l-4 border-transparent" data-ir="CodeIR">
                        <span class="text-sm text-gray-400 font-mono">04</span>
                        <span class="block text-lg font-bold text-gray-800">CodeIR</span>
                    </button>
                </div>

                <!-- Display Area -->
                <div class="w-full md:w-2/3 p-8 flex flex-col justify-center bg-white min-h-[300px]">
                    <div id="ir-content">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">IdeaIR</h3>
                        <div class="space-y-4 text-gray-600">
                            <p><strong>Focus:</strong> Purpose, Invariants, User Needs.</p>
                            <p>The highest level of abstraction. This represents the "soul" of the product before features are defined.</p>
                            <div class="bg-[#f3f0eb] p-4 rounded text-sm font-mono text-gray-700 mt-4">
                                {<br>
                                &nbsp;&nbsp;"invariant": "Data never leaves device",<br>
                                &nbsp;&nbsp;"success_metric": "Time to First Insight < 5m"<br>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: Theoretical Framework & Hypotheses -->
        <section id="theory" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Tabs for Theory -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-[#e5e0d8] p-6">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Theoretical Lenses</h2>
                    <p class="text-gray-500 mt-1">Foundational concepts driving the methodology.</p>
                </div>
                
                <div class="flex space-x-6 border-b border-gray-200 mb-6">
                    <button onclick="switchTab('cat-theory')" class="tab-btn pb-2 text-gray-500 hover:text-gray-700 active-tab" data-tab="cat-theory">Category Triality</button>
                    <button onclick="switchTab('hott')" class="tab-btn pb-2 text-gray-500 hover:text-gray-700" data-tab="hott">HoTT Compass</button>
                    <button onclick="switchTab('metamath')" class="tab-btn pb-2 text-gray-500 hover:text-gray-700" data-tab="metamath">Metamathematics</button>
                </div>

                <div id="tab-content" class="min-h-[200px]">
                    <!-- Content injected via JS -->
                </div>
            </div>

            <!-- Right: Hypotheses -->
            <div class="bg-[#2d2a29] text-[#fdfbf7] rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#e67e22] mb-4">Key Hypotheses</h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-sm uppercase tracking-wider text-gray-400 mb-2">To Falsify (Risks)</h4>
                        <ul class="list-disc list-inside space-y-2 text-sm text-gray-300">
                            <li><strong>H1:</strong> No convergence; repeated distillation produces chaos.</li>
                            <li><strong>H2:</strong> No usable equivalence relation exists.</li>
                            <li><strong>H3:</strong> Atoms overfit and don't transfer.</li>
                        </ul>
                    </div>
                    <div class="border-t border-gray-700 pt-4">
                        <h4 class="font-bold text-sm uppercase tracking-wider text-gray-400 mb-2">To Confirm (Hopes)</h4>
                        <ul class="list-disc list-inside space-y-2 text-sm text-gray-300">
                            <li><strong>C1:</strong> Attractor structures (stable cores) exist.</li>
                            <li><strong>C2:</strong> Atoms have canonical normal forms.</li>
                            <li><strong>C3:</strong> IR lowering is functorial and reusable.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: MVP0 Simulation -->
        <section id="simulation" class="bg-white rounded-xl shadow-sm border border-[#e5e0d8] p-6 md:p-8">
            <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">MVP0 Monodromy Engine</h2>
                    <p class="text-gray-500 mt-1">Simulate the "Distill ∘ Elaborate" loop on a theoretical project.</p>
                </div>
                <button onclick="runSimulation()" id="run-sim-btn" class="mt-4 md:mt-0 bg-[#d97706] hover:bg-[#b45309] text-white font-bold py-2 px-6 rounded shadow transition-colors">
                    Run Iteration
                </button>
            </div>

            <div class="bg-[#1e1e1e] rounded-lg p-4 h-64 overflow-y-auto shadow-inner border border-gray-700 text-sm">
                <div id="console-output" class="console-text space-y-1">
                    <div class="text-green-500">> Engine Ready. Awaiting Input...</div>
                    <div class="text-gray-500">> Click "Run Iteration" to start the Monodromy loop.</div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-[#e5e0d8] mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p>&copy; 2024 Monodromy Atomization Explorer. Generated from Source Report.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA STORAGE ---
        
        const coreLoopData = {
            'Generate': {
                desc: "Produce artifacts quickly (PRD, architecture, prototypes, tests, code). This is the expansion phase where we explore the solution space.",
                action: "Output: Raw Code, Docs, Tests"
            },
            'Ship': {
                desc: "Deploy the generated artifacts to a real environment. Reality is the only valid test of the product.",
                action: "Action: Deploy to Prod/Staging"
            },
            'Observe': {
                desc: "Identify true value drivers, invariants, and failure modes. Watch how the system behaves in the wild.",
                action: "Input: Telemetry, User Feedback"
            },
            'Distill': {
                desc: "Compress the whole journey into a minimal basis of 'atoms'. Remove what wasn't needed. Keep the invariants.",
                action: "Process: Compression / Refactoring"
            },
            'Rebuild': {
                desc: "Regenerate the product from the new, smaller set of atoms. Compare this trajectory to the original.",
                action: "Process: Re-compilation from Atoms"
            }
        };

        const atomsData = [
            { title: "Invariant Kernel", desc: "What must remain true regardless of implementation details." },
            { title: "User-need Basis", desc: "Irreducible user stories and success metrics." },
            { title: "System Skeleton", desc: "Components, boundaries, and high-level responsibilities." },
            { title: "Contracts", desc: "API specs, UI flows, schemas, and protocols." },
            { title: "State + Event Model", desc: "What changes over time; logging and telemetry hooks." },
            { title: "Verification Harness", desc: "Tests, acceptance checks, and validation logic." },
            { title: "Risks/Constraints", desc: "Performance bars, UX standards, safety constraints." },
            { title: "Build/Run Recipe", desc: "The shortest path to a 'running' system." }
        ];

        const irData = {
            'IdeaIR': {
                title: "IdeaIR",
                focus: "Purpose, Invariants, User Needs",
                desc: "The highest level of abstraction. Represents the 'why' and 'what' constraints.",
                json: '{\n  "invariant": "Data privacy",\n  "metric": "Time < 5m"\n}'
            },
            'ProductIR': {
                title: "ProductIR",
                focus: "Feature Slices, UX Flows, Acceptance Tests",
                desc: "Concrete user experiences and functional requirements.",
                json: '{\n  "flow": "Login -> Dashboard",\n  "tests": ["can_view_stats"]\n}'
            },
            'SystemIR': {
                title: "SystemIR",
                focus: "Architecture, Data Contracts, Module Graph",
                desc: "The technical blueprint. Interfaces and data structures defined.",
                json: '{\n  "modules": ["Auth", "Graph"],\n  "api": "GraphQL Schema"\n}'
            },
            'CodeIR': {
                title: "CodeIR",
                focus: "Scaffolds, APIs, Test Harness, Build Scripts",
                desc: "The executable code and infrastructure configurations.",
                json: '{\n  "src": "./src/main.rs",\n  "build": "cargo build"\n}'
            }
        };

        const theoryData = {
            'cat-theory': {
                title: "Category-Theory Lens (Triality)",
                content: `
                    <p class="mb-4">Model the process as an evolving category:</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 mb-4">
                        <li><strong>Objects:</strong> Artifacts, modules, concepts.</li>
                        <li><strong>Morphisms:</strong> Transformations (refactor, compile, test).</li>
                        <li><strong>Embedding Space:</strong> Constraints, languages, platform assumptions.</li>
                    </ul>
                    <p class="text-sm text-gray-500">Repeated reflection discovers higher structure (morphisms between morphisms).</p>
                `
            },
            'hott': {
                title: "HoTT Compass (Univalence)",
                content: `
                    <p class="mb-4">Homotopy Type Theory gives semantics for "different paths, same outcome":</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 mb-4">
                        <li><strong>Types = Spaces:</strong> Product specifications.</li>
                        <li><strong>Terms = Points:</strong> Concrete implementations.</li>
                        <li><strong>Paths = Equalities:</strong> Refactors and development trajectories.</li>
                    </ul>
                    <p class="text-sm text-gray-500">We treat "equivalent up to structure" as "the same" (Univalence).</p>
                `
            },
            'metamath': {
                title: "Constellation of Topoi",
                content: `
                    <p class="mb-4">Three meta-axioms for finite agents:</p>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700 mb-4">
                        <li><strong>Finite Choice:</strong> Bounded search budgets.</li>
                        <li><strong>Interpretability:</strong> Logic-frames must be understandable.</li>
                        <li><strong>Predictability:</strong> Frames must yield checkable predictions.</li>
                    </ol>
                    <p class="text-sm text-gray-500">We switch between internally consistent micro-foundations.</p>
                `
            }
        };

        // --- CHART.JS CONFIG ---
        
        let loopChart;

        function initChart() {
            const ctx = document.getElementById('monodromyChart').getContext('2d');
            
            // Warm neutral colors with a pop for the 'active' idea
            const colors = ['#d97706', '#b45309', '#78350f', '#57534e', '#a8a29e']; 
            
            loopChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Generate', 'Ship', 'Observe', 'Distill', 'Rebuild'],
                    datasets: [{
                        data: [20, 20, 20, 20, 20],
                        backgroundColor: [
                            '#eab308', // Generate - Yellow
                            '#f97316', // Ship - Orange
                            '#06b6d4', // Observe - Cyan/Teal (Observation)
                            '#8b5cf6', // Distill - Purple (Transformation)
                            '#10b981'  // Rebuild - Green (New Life)
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label;
                                }
                            }
                        }
                    },
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const label = loopChart.data.labels[index];
                            updateLoopDetails(label);
                        }
                    }
                }
            });
        }

        function updateLoopDetails(phase) {
            const data = coreLoopData[phase];
            if (!data) return;

            document.getElementById('loop-phase-title').textContent = phase;
            document.getElementById('loop-phase-desc').textContent = data.desc;
            document.getElementById('loop-phase-action').textContent = data.action;
            document.getElementById('loop-phase-meta').classList.remove('hidden');
        }

        // --- UI FUNCTIONS ---

        function renderAtoms() {
            const container = document.getElementById('atom-grid-container');
            atomsData.forEach(atom => {
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-lg border border-[#e5e0d8] card-hover transition-all duration-200 cursor-default group";
                card.innerHTML = `
                    <div class="h-10 w-10 bg-[#fef3c7] rounded-full flex items-center justify-center mb-4 text-[#d97706]">
                        <span class="text-xl font-bold">●</span>
                    </div>
                    <h3 class="font-bold text-gray-800 mb-2 group-hover:text-[#d97706] transition-colors">${atom.title}</h3>
                    <p class="text-sm text-gray-600">${atom.desc}</p>
                `;
                container.appendChild(card);
            });
        }

        function updateIR(irKey) {
            const data = irData[irKey];
            if (!data) return;

            // Update Buttons
            document.querySelectorAll('.ir-btn').forEach(btn => {
                if (btn.dataset.ir === irKey) {
                    btn.classList.add('border-[#d97706]', 'bg-[#f3f0eb]');
                    btn.classList.remove('border-transparent');
                } else {
                    btn.classList.remove('border-[#d97706]', 'bg-[#f3f0eb]');
                    btn.classList.add('border-transparent');
                }
            });

            // Update Content
            const contentDiv = document.getElementById('ir-content');
            contentDiv.style.opacity = '0';
            setTimeout(() => {
                contentDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${data.title}</h3>
                    <div class="space-y-4 text-gray-600">
                        <p><strong>Focus:</strong> ${data.focus}</p>
                        <p>${data.desc}</p>
                        <div class="bg-[#2d2a29] p-4 rounded text-sm font-mono text-green-400 mt-4 overflow-x-auto shadow-inner">
                            <pre>${data.json}</pre>
                        </div>
                    </div>
                `;
                contentDiv.style.opacity = '1';
            }, 200);
        }

        function switchTab(tabKey) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.tab === tabKey) {
                    btn.classList.add('active-tab');
                } else {
                    btn.classList.remove('active-tab');
                }
            });

            // Update Content
            const container = document.getElementById('tab-content');
            const data = theoryData[tabKey];
            container.innerHTML = `
                <h4 class="text-lg font-bold text-gray-800 mb-2">${data.title}</h4>
                ${data.content}
            `;
        }

        // --- SIMULATION LOGIC ---

        function runSimulation() {
            const consoleDiv = document.getElementById('console-output');
            const btn = document.getElementById('run-sim-btn');
            
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            consoleDiv.innerHTML = '<div class="text-green-500">> Initializing Monodromy Engine...</div>';

            const steps = [
                { text: "> Loading current product state (ProductIR)...", color: "text-gray-300", delay: 800 },
                { text: "> elaborate(atoms_v0) -> Generating artifacts...", color: "text-yellow-400", delay: 1600 },
                { text: "> Deploying to staging... [OK]", color: "text-green-400", delay: 2400 },
                { text: "> Observing... Telemetry received. 14 invariants detected.", color: "text-blue-400", delay: 3200 },
                { text: "> Distilling... Compressing 14 invariants to 3 Eigenatoms.", color: "text-purple-400", delay: 4200 },
                { text: "> Rebuilding from Basis...", color: "text-gray-300", delay: 5000 },
                { text: "> Calculating Equivalence (HoTT)... Score: 0.98", color: "text-white font-bold", delay: 6000 },
                { text: "> CYCLE COMPLETE. Atoms stabilized.", color: "text-green-500 font-bold", delay: 6500 }
            ];

            let cumulativeDelay = 0;

            steps.forEach(step => {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.className = step.color;
                    line.textContent = step.text;
                    consoleDiv.appendChild(line);
                    consoleDiv.scrollTop = consoleDiv.scrollHeight;
                }, step.delay);
                cumulativeDelay = step.delay;
            });

            setTimeout(() => {
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, cumulativeDelay + 500);
        }

        // --- INITIALIZATION ---

        window.addEventListener('DOMContentLoaded', () => {
            initChart();
            renderAtoms();
            // Initialize Tabs and IR
            switchTab('cat-theory');
            updateIR('IdeaIR');
            // Initial Loop Detail
            updateLoopDetails('Generate');
        });

    </script>
</body>
</html>