<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monodromy Atomization: A Visual Essay</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=IBM+Plex+Mono:wght@400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Libre Baskerville', serif;
            background: linear-gradient(135deg, #f5f1e8 0%, #ebe4d4 100%);
            color: #2c2416;
            line-height: 1.7;
            overflow-x: hidden;
        }

        .essay-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 30px;
        }

        .section {
            margin-bottom: 120px;
            position: relative;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: #2c2416;
            margin-bottom: 20px;
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #c85a3f;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
        }

        h3 {
            font-size: 1.3rem;
            color: #5d8a66;
            margin-bottom: 15px;
            font-weight: 600;
        }

        p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #3d3425;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #8b7355;
            font-style: italic;
            margin-bottom: 10px;
        }

        .byline {
            font-size: 1rem;
            color: #9d8b73;
            margin-bottom: 60px;
        }

        code {
            font-family: 'IBM Plex Mono', monospace;
            background: #fff9f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
            color: #c85a3f;
        }

        .code-block {
            font-family: 'IBM Plex Mono', monospace;
            background: #2c2416;
            color: #e8dcc8;
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
            overflow-x: auto;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
        }

        .punchline {
            background: #c85a3f;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-style: italic;
            border-left: 4px solid #9d3f2b;
        }

        .interactive-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #5d8a66;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }

        .tooltip {
            position: absolute;
            background: #2c2416;
            color: #e8dcc8;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-family: 'Inter', sans-serif;
            pointer-events: none;
            z-index: 1000;
            white-space: nowrap;
        }

        .dad-joke-badge {
            display: inline-block;
            background: #ffd93d;
            color: #2c2416;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            margin-left: 10px;
            transform: rotate(-2deg);
        }

        .orbit-container {
            width: 100%;
            height: 500px;
            position: relative;
            background: #fff9f0;
            border-radius: 12px;
            margin: 30px 0;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .atom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .atom-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid #e8dcc8;
            position: relative;
        }

        .atom-card:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 0 10px 30px rgba(200, 90, 63, 0.2);
            border-color: #c85a3f;
        }

        .atom-card:active {
            cursor: grabbing;
        }

        .slider-container {
            margin: 40px 0;
            padding: 30px;
            background: white;
            border-radius: 10px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, #5d8a66, #c85a3f);
            border-radius: 4px;
            outline: none;
            margin: 20px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #c85a3f;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .button {
            background: #c85a3f;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin: 10px 0;
        }

        .button:hover {
            background: #9d3f2b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(200, 90, 63, 0.3);
        }

        .hot-josh-popup {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2c2416;
            color: #ffd93d;
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .sql-transform {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
            border: 2px solid #e8dcc8;
            transition: all 0.5s ease;
        }

        .sql-transform:hover {
            border-color: #c85a3f;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        .footnote {
            font-size: 0.9rem;
            color: #8b7355;
            font-style: italic;
            border-left: 3px solid #c85a3f;
            padding-left: 15px;
            margin: 20px 0;
        }

        canvas {
            display: block;
        }

        .highlight {
            background: linear-gradient(120deg, #ffd93d 0%, #ffd93d 100%);
            background-repeat: no-repeat;
            background-size: 100% 40%;
            background-position: 0 85%;
        }

        .convergence-meter {
            width: 100%;
            height: 40px;
            background: #e8dcc8;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }

        .convergence-fill {
            height: 100%;
            background: linear-gradient(90deg, #5d8a66, #c85a3f);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ========================================
        // HERO SECTION WITH DRAGGABLE ORBIT
        // ========================================
        const MonodromyOrbit = () => {
            const canvasRef = useRef(null);
            const [angle, setAngle] = useState(0);
            const [isDragging, setIsDragging] = useState(false);
            const [tooltip, setTooltip] = useState('');
            const [tooltipPos, setTooltipPos] = useState({ x: 0, y: 0 });

            const jokes = [
                "0¬∞: The Idea Phase (where Hot Josh says 'what if blockchain?')",
                "45¬∞: Early Enthusiasm (Josh: 'this is definitely going to work')",
                "90¬∞: First Reality Check (Josh: 'maybe we need microservices?')",
                "135¬∞: The Pivot (Josh: 'okay but what if...')",
                "180¬∞: Deep in the Trenches (Josh has stopped talking)",
                "225¬∞: Distillation Begins (finding what actually matters)",
                "270¬∞: The Rebuild (starting fresh, wiser)",
                "315¬∞: Approaching Convergence (eigenatoms emerging)"
            ];

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const width = canvas.width = canvas.offsetWidth * 2;
                const height = canvas.height = canvas.offsetHeight * 2;
                ctx.scale(2, 2);

                const centerX = width / 4;
                const centerY = height / 4;
                const radius = Math.min(width, height) / 6;

                // Clear
                ctx.clearRect(0, 0, width / 2, height / 2);

                // Draw base space (singularity)
                ctx.fillStyle = '#c85a3f';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 20, 0, Math.PI * 2);
                ctx.fill();

                // Draw orbit path
                ctx.strokeStyle = '#e8dcc8';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);

                // Draw phase markers
                for (let i = 0; i < 8; i++) {
                    const a = (i / 8) * Math.PI * 2;
                    const x = centerX + Math.cos(a) * radius;
                    const y = centerY + Math.sin(a) * radius;
                    ctx.fillStyle = '#5d8a66';
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Draw current position
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.fillStyle = '#ffd93d';
                ctx.strokeStyle = '#2c2416';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Draw line from center
                ctx.strokeStyle = '#8b7355';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();

                // Draw labels
                ctx.fillStyle = '#2c2416';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('User Need', centerX, centerY + 40);
                ctx.fillText('Singularity', centerX, centerY + 55);

            }, [angle]);

            const handleMouseDown = (e) => {
                setIsDragging(true);
            };

            const handleMouseMove = (e) => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                if (isDragging) {
                    const newAngle = Math.atan2(y, x);
                    setAngle(newAngle);
                }

                // Update tooltip
                const dist = Math.sqrt(x * x + y * y);
                if (dist > 80 && dist < 180) {
                    const hoverAngle = Math.atan2(y, x);
                    const degrees = ((hoverAngle * 180 / Math.PI) + 360) % 360;
                    const jokeIndex = Math.floor(degrees / 45);
                    setTooltip(jokes[jokeIndex]);
                    setTooltipPos({ x: e.clientX, y: e.clientY });
                } else {
                    setTooltip('');
                }
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            return (
                <div className="orbit-container">
                    <canvas 
                        ref={canvasRef}
                        style={{ width: '100%', height: '100%', cursor: isDragging ? 'grabbing' : 'grab' }}
                        onMouseDown={handleMouseDown}
                        onMouseMove={handleMouseMove}
                        onMouseUp={handleMouseUp}
                        onMouseLeave={handleMouseUp}
                    />
                    {tooltip && (
                        <div className="tooltip" style={{ 
                            left: tooltipPos.x + 10, 
                            top: tooltipPos.y + 10 
                        }}>
                            {tooltip}
                        </div>
                    )}
                </div>
            );
        };

        // ========================================
        // SQL TRANSFORMATION
        // ========================================
        const SQLTransform = () => {
            const [isHovered, setIsHovered] = useState(false);
            const beforeRef = useRef(null);
            const afterRef = useRef(null);
            const punchlineRef = useRef(null);

            useEffect(() => {
                if (isHovered) {
                    anime({
                        targets: beforeRef.current,
                        opacity: 0,
                        duration: 400,
                        easing: 'easeOutQuad'
                    });
                    anime({
                        targets: afterRef.current,
                        opacity: 1,
                        duration: 400,
                        easing: 'easeInQuad',
                        delay: 200
                    });
                    anime({
                        targets: punchlineRef.current,
                        opacity: [0, 1],
                        translateY: [-10, 0],
                        duration: 500,
                        easing: 'easeOutElastic(1, .8)',
                        delay: 400
                    });
                } else {
                    anime({
                        targets: beforeRef.current,
                        opacity: 1,
                        duration: 300,
                        easing: 'easeInQuad'
                    });
                    anime({
                        targets: afterRef.current,
                        opacity: 0,
                        duration: 300,
                        easing: 'easeOutQuad'
                    });
                }
            }, [isHovered]);

            return (
                <div 
                    className="sql-transform"
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                >
                    <div className="interactive-label">‚òùÔ∏è HOVER TO SEE THE TRUTH</div>
                    <div className="code-block">
                        <div ref={beforeRef} style={{ opacity: 1 }}>
                            {`CREATE TABLE features (
  id INT PRIMARY KEY,
  shipped_date DATE,
  works BOOLEAN DEFAULT TRUE
);`}
                        </div>
                        <div
                            ref={afterRef}
                            style={{
                                opacity: 0,
                                position: 'absolute',
                                top: 25,
                                left: 25,
                                right: 25
                            }}
                        >
                            {`CREATE TABLE features (
  id INT PRIMARY KEY,
  shipped_date DATE,
  works BOOLEAN DEFAULT FALSE,
  technical_debt INT DEFAULT 9999,
  "why_did_we_do_it_this_way" TEXT 
    DEFAULT 'Hot Josh thought it was a good idea',
  regret_level INT CHECK (regret_level > 0),
  FOREIGN KEY (regret) REFERENCES everything(always)
);`}
                        </div>
                    </div>
                    {isHovered && (
                        <div ref={punchlineRef} className="punchline" style={{ opacity: 0 }}>
                            This is what the PDF calls "accidental complexity."<br/>
                            Hot Josh calls it "Wednesday."
                        </div>
                    )}
                </div>
            );
        };

        // ========================================
        // DRAGGABLE ATOMS
        // ========================================
        const AtomCard = ({ number, title, description }) => {
            const [showJoke, setShowJoke] = useState(false);
            const cardRef = useRef(null);
            const jokeRef = useRef(null);

            const jokes = {
                1: "Like baby Alix's sleep schedule: non-negotiable.",
                2: "The 'why' that keeps you going at 3 AM (both parenting and coding).",
                3: "The skeleton that holds everything together. Like caffeine.",
                4: "The interface between chaos and order. Also known as 'boundaries'.",
                5: "What changes and how. Usually it's the diaper.",
                6: "Testing if it works. Narrator: it doesn't always work.",
                7: "The stuff that will break if you ignore it. (Also true for babies.)",
                8: "The recipe for rebuilding. Measured in coffee cups."
            };

            useEffect(() => {
                if (showJoke && jokeRef.current) {
                    anime({
                        targets: jokeRef.current,
                        opacity: [0, 1],
                        translateY: [10, 0],
                        scale: [0.95, 1],
                        duration: 600,
                        easing: 'easeOutElastic(1, .6)'
                    });
                }
            }, [showJoke]);

            const handleClick = () => {
                // Wiggle animation on click
                anime({
                    targets: cardRef.current,
                    rotate: [0, -5, 5, -3, 3, 0],
                    duration: 600,
                    easing: 'easeInOutQuad'
                });
                
                setShowJoke(true);
                setTimeout(() => setShowJoke(false), 3000);
            };

            return (
                <div
                    ref={cardRef}
                    className="atom-card"
                    onClick={handleClick}
                    style={{ cursor: 'pointer' }}
                >
                    <div style={{ 
                        fontSize: '2rem', 
                        fontWeight: 'bold', 
                        color: '#c85a3f',
                        marginBottom: '10px'
                    }}>
                        {number}
                    </div>
                    <h3 style={{ marginBottom: '10px' }}>{title}</h3>
                    <p style={{ fontSize: '0.9rem', color: '#6d5d4b' }}>{description}</p>
                    {showJoke && (
                        <div
                            ref={jokeRef}
                            style={{
                                marginTop: '15px',
                                padding: '10px',
                                background: '#ffd93d',
                                borderRadius: '5px',
                                fontSize: '0.85rem',
                                fontFamily: 'Inter, sans-serif',
                                color: '#2c2416',
                                opacity: 0
                            }}
                        >
                            <strong>Dad Joke Alert:</strong> {jokes[number]}
                        </div>
                    )}
                </div>
            );
        };

        const AtomPack = () => {
            const atoms = [
                { number: 1, title: "Invariant Kernel", description: "The DNA. The rules that must hold." },
                { number: 2, title: "User-Need Basis", description: "Why this exists. The North Star." },
                { number: 3, title: "System Skeleton", description: "The architecture. Bones before flesh." },
                { number: 4, title: "Contracts", description: "How things talk. APIs, schemas, promises." },
                { number: 5, title: "State + Events", description: "What changes and how it changes." },
                { number: 6, title: "Verification", description: "Tests. Proof it works (or doesn't)." },
                { number: 7, title: "Constraints", description: "Performance, latency, real-world limits." },
                { number: 8, title: "Build Recipe", description: "The shortest path to running code." }
            ];

            return (
                <div className="atom-grid">
                    {atoms.map(atom => (
                        <AtomCard key={atom.number} {...atom} />
                    ))}
                </div>
            );
        };

        // ========================================
        // TECHNICAL DEBT BABY METER
        // ========================================
        const TechnicalDebtBaby = () => {
            const [debtLevel, setDebtLevel] = useState(50);
            const [babyMood, setBabyMood] = useState('üòä');
            const footnoteRef = useRef(null);

            useEffect(() => {
                if (debtLevel < 20) setBabyMood('üòá');
                else if (debtLevel < 40) setBabyMood('üòä');
                else if (debtLevel < 60) setBabyMood('üòê');
                else if (debtLevel < 80) setBabyMood('üò∞');
                else setBabyMood('üò≠');
            }, [debtLevel]);

            useEffect(() => {
                if (debtLevel > 80 && footnoteRef.current) {
                    anime({
                        targets: footnoteRef.current,
                        opacity: [0, 1],
                        translateX: [-20, 0],
                        duration: 600,
                        easing: 'easeOutQuad'
                    });
                }
            }, [debtLevel]);

            const comments = {
                'üòá': "Clean atoms! Baby sleeps through the night!",
                'üòä': "Pretty good. Only one 2 AM wake-up.",
                'üòê': "Mmm, getting messy. Like a diaper situation.",
                'üò∞': "This is concerning. Code smells detected.",
                'üò≠': "REFACTOR NOW. Baby is screaming. Josh is panicking."
            };

            return (
                <div className="slider-container">
                    <div className="interactive-label">üë∂ TECHNICAL DEBT BABY‚Ñ¢</div>
                    <p style={{ fontSize: '0.95rem', color: '#6d5d4b', marginBottom: '20px' }}>
                        As a new dad, Paul understands: some things grow exponentially if you don't address them early.
                    </p>
                    <div style={{ textAlign: 'center', fontSize: '5rem', margin: '20px 0' }}>
                        {babyMood}
                    </div>
                    <input 
                        type="range" 
                        min="0" 
                        max="100" 
                        value={debtLevel}
                        onChange={(e) => setDebtLevel(parseInt(e.target.value))}
                    />
                    <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.9rem', color: '#8b7355' }}>
                        <span>Clean Atoms</span>
                        <span>Monolithic Disaster</span>
                    </div>
                    <div className="punchline" style={{ marginTop: '20px' }}>
                        {comments[babyMood]}
                    </div>
                    {debtLevel > 80 && (
                        <div ref={footnoteRef} className="footnote" style={{ opacity: 0 }}>
                            Fun fact: Hot Josh once let technical debt reach 147%. We don't talk about that sprint.
                        </div>
                    )}
                </div>
            );
        };

        // ========================================
        // CODE IS CACHE REVEAL
        // ========================================
        const CodeIsCache = () => {
            const [cleared, setCleared] = useState(false);
            const codeRef = useRef(null);
            const punchlineRef = useRef(null);

            useEffect(() => {
                if (codeRef.current) {
                    anime({
                        targets: codeRef.current,
                        opacity: cleared ? 0.3 : 1,
                        scale: cleared ? 0.95 : 1,
                        filter: cleared ? 'blur(4px)' : 'blur(0px)',
                        duration: 800,
                        easing: 'easeOutCubic'
                    });
                }

                if (cleared && punchlineRef.current) {
                    anime({
                        targets: punchlineRef.current,
                        opacity: [0, 1],
                        translateY: [20, 0],
                        duration: 600,
                        easing: 'easeOutElastic(1, .8)',
                        delay: 400
                    });
                }
            }, [cleared]);

            return (
                <div style={{ margin: '60px 0' }}>
                    <div className="interactive-label">üíæ THE BIG REVEAL</div>
                    <div style={{ 
                        background: 'white', 
                        padding: '40px', 
                        borderRadius: '10px',
                        textAlign: 'center'
                    }}>
                        <div ref={codeRef}>
                            <h3 style={{ fontSize: '2.5rem', marginBottom: '20px' }}>
                                {cleared ? 'üóëÔ∏è' : 'üìù'} 10,000 Lines of Code
                            </h3>
                            <p style={{ fontSize: '1.1rem', color: '#6d5d4b' }}>
                                {cleared 
                                    ? 'Deleted. Regenerated from atoms in 2 minutes.' 
                                    : 'Hot Josh\'s Magnum Opus. Blood, sweat, and Stack Overflow.'}
                            </p>
                        </div>

                        <button 
                            className="button"
                            onClick={() => setCleared(!cleared)}
                            style={{ marginTop: '30px' }}
                        >
                            {cleared ? '‚èÆÔ∏è Restore Cache' : 'üóëÔ∏è Clear Cache'}
                        </button>

                        {cleared && (
                            <div
                                ref={punchlineRef}
                                className="punchline"
                                style={{ marginTop: '30px', opacity: 0 }}
                            >
                                <strong>That's the point.</strong><br/>
                                Code is disposable. The atoms are forever.<br/>
                                (Like the love for your daughter. But unlike Hot Josh's code quality.)
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ========================================
        // EIGENATOM CONVERGENCE PLAYGROUND
        // ========================================
        const EigenatomPlayground = () => {
            const [iterations, setIterations] = useState(0);
            const [convergence, setConvergence] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const convergenceBarRef = useRef(null);
            const messageRef = useRef(null);
            const successRef = useRef(null);

            useEffect(() => {
                if (isRunning && iterations < 10) {
                    const timer = setTimeout(() => {
                        setIterations(prev => prev + 1);
                        const newConvergence = 100 * (1 - Math.exp(-iterations / 3));
                        setConvergence(newConvergence);
                        
                        // Animate convergence bar
                        if (convergenceBarRef.current) {
                            anime({
                                targets: convergenceBarRef.current,
                                width: `${newConvergence}%`,
                                duration: 800,
                                easing: 'easeOutCubic'
                            });
                        }

                        // Animate message
                        if (messageRef.current) {
                            anime({
                                targets: messageRef.current,
                                opacity: [0, 1],
                                translateX: [-20, 0],
                                duration: 500,
                                easing: 'easeOutQuad'
                            });
                        }
                    }, 800);
                    return () => clearTimeout(timer);
                } else if (iterations >= 10) {
                    setIsRunning(false);
                    
                    // Success animation
                    if (successRef.current) {
                        anime({
                            targets: successRef.current,
                            opacity: [0, 1],
                            scale: [0.9, 1],
                            duration: 800,
                            easing: 'easeOutElastic(1, .6)'
                        });
                    }
                }
            }, [isRunning, iterations]);

            const reset = () => {
                setIterations(0);
                setConvergence(0);
                setIsRunning(false);
                if (convergenceBarRef.current) {
                    anime({
                        targets: convergenceBarRef.current,
                        width: '0%',
                        duration: 400,
                        easing: 'easeInQuad'
                    });
                }
            };

            const messages = [
                "Starting iteration... Hot Josh suggests a rewrite.",
                "Learning from users... They don't want blockchain.",
                "Distilling feedback... Removing 40% of features.",
                "Regenerating... Code is 30% smaller now.",
                "Testing... Baby Alix approves (she's asleep).",
                "Converging... The atoms are stabilizing.",
                "Almost there... Hot Josh is suspiciously quiet.",
                "Eigenatoms emerging... Truth crystalizing.",
                "Final push... Everything makes sense now.",
                "CONVERGENCE! üéâ Hot Josh: 'Can we add NFTs?'"
            ];

            return (
                <div style={{ margin: '60px 0' }}>
                    <div className="interactive-label">üéØ EIGENATOM CONVERGENCE SIMULATOR</div>
                    <div style={{ background: 'white', padding: '40px', borderRadius: '10px' }}>
                        <p style={{ marginBottom: '30px' }}>
                            Watch as the atoms stabilize through repeated monodromy loops.
                            This is what "convergence" looks like in practice.
                        </p>

                        <div className="convergence-meter">
                            <div 
                                ref={convergenceBarRef}
                                className="convergence-fill"
                                style={{ width: '0%' }}
                            >
                                {convergence > 20 && `${Math.round(convergence)}%`}
                            </div>
                        </div>

                        <div style={{ 
                            minHeight: '80px', 
                            margin: '20px 0',
                            fontFamily: 'IBM Plex Mono',
                            fontSize: '0.95rem',
                            color: '#5d8a66'
                        }}>
                            {iterations > 0 && (
                                <div ref={messageRef} key={iterations}>
                                    <strong>Iteration {iterations}:</strong> {messages[iterations - 1]}
                                </div>
                            )}
                        </div>

                        <div style={{ display: 'flex', gap: '15px', justifyContent: 'center' }}>
                            <button 
                                className="button"
                                onClick={() => setIsRunning(true)}
                                disabled={isRunning || iterations >= 10}
                                style={{ opacity: (isRunning || iterations >= 10) ? 0.5 : 1 }}
                            >
                                {iterations === 0 ? '‚ñ∂Ô∏è Start' : '‚ñ∂Ô∏è Continue'}
                            </button>
                            <button 
                                className="button"
                                onClick={reset}
                                style={{ background: '#5d8a66' }}
                            >
                                üîÑ Reset
                            </button>
                        </div>

                        {iterations >= 10 && (
                            <div
                                ref={successRef}
                                className="punchline"
                                style={{ marginTop: '30px', opacity: 0 }}
                            >
                                <strong>Convergence Achieved! ‚ú®</strong><br/>
                                Your atoms are now eigenatoms‚Äîstable, essential, true.<br/>
                                (Unlike Hot Josh's understanding of Docker networking.)
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ========================================
        // HOT JOSH POPUP MANAGER
        // ========================================
        const HotJoshPopup = ({ messages, interval = 15000 }) => {
            const [currentMessage, setCurrentMessage] = useState(null);
            const [visible, setVisible] = useState(false);
            const popupRef = useRef(null);

            useEffect(() => {
                const showMessage = () => {
                    const msg = messages[Math.floor(Math.random() * messages.length)];
                    setCurrentMessage(msg);
                    setVisible(true);
                    
                    // Entrance animation
                    if (popupRef.current) {
                        anime({
                            targets: popupRef.current,
                            opacity: [0, 1],
                            translateY: [50, 0],
                            scale: [0.8, 1],
                            duration: 600,
                            easing: 'easeOutElastic(1, .7)'
                        });
                    }
                    
                    setTimeout(() => {
                        // Exit animation
                        if (popupRef.current) {
                            anime({
                                targets: popupRef.current,
                                opacity: [1, 0],
                                translateY: [0, 30],
                                duration: 400,
                                easing: 'easeInQuad',
                                complete: () => setVisible(false)
                            });
                        }
                    }, 4600);
                };

                const timer = setInterval(showMessage, interval);
                return () => clearInterval(timer);
            }, [messages, interval]);

            if (!visible) return null;

            return (
                <div ref={popupRef} className="hot-josh-popup" style={{ opacity: 0 }}>
                    <div style={{ 
                        fontWeight: 'bold', 
                        marginBottom: '10px',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '10px'
                    }}>
                        ü§î Hot Josh Says:
                    </div>
                    <div>{currentMessage}</div>
                </div>
            );
        };

        // ========================================
        // MAIN APP
        // ========================================
        const MonodromyEssay = () => {
            const essayRef = useRef(null);

            useEffect(() => {
                // Page entrance animation
                if (essayRef.current) {
                    anime({
                        targets: essayRef.current.querySelectorAll('.section'),
                        opacity: [0, 1],
                        translateY: [30, 0],
                        duration: 1000,
                        delay: anime.stagger(150),
                        easing: 'easeOutQuad'
                    });
                }
            }, []);

            const hotJoshMessages = [
                "What if we just added more servers?",
                "I think we need a microservice for this.",
                "Have you considered blockchain?",
                "Can we make it serverless?",
                "What about using GraphQL?",
                "I saw this on Hacker News...",
                "Maybe we should rewrite it in Rust?",
                "Docker Compose is production-ready, right?",
                "What if we used MongoDB for everything?",
                "I think we need more meetings about this."
            ];

            return (
                <>
                    <div ref={essayRef} className="essay-container">
                        {/* HERO */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h1>Monodromy Atomization</h1>
                            <div className="subtitle">
                                Or: How I Learned to Stop Patching and Love the Regeneration
                            </div>
                            <div className="byline">
                                By Paul Mestemaker<span className="dad-joke-badge">DAD JOKE CERTIFIED</span><br/>
                                <span style={{ fontSize: '0.9rem' }}>
                                    (With apologies to Bartosz Ciechanowski, Neal Brennan, and Hot Josh)
                                </span>
                            </div>

                            <p>
                                If you've ever spent <span className="highlight">three years building a codebase</span> only to realize 
                                the requirements changed in month two, this essay is for you.
                            </p>

                            <p>
                                If you've ever wondered "why does this keep breaking?", this essay is for you.
                            </p>

                            <p>
                                If you've ever worked with someone named Hot Josh who suggests "maybe we need microservices?" 
                                at every standup, <strong>this essay is definitely for you.</strong>
                            </p>
                        </section>

                        {/* SECTION 1: THE ORBIT */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 1: The Orbit<span className="dad-joke-badge">DRAG ME</span></h2>
                            
                            <p>
                                Traditional software development is <em>linear</em>. You go from idea to code to ship, 
                                accumulating complexity like a baby accumulates spit-up on your shoulder.
                            </p>

                            <p>
                                <strong>Monodromy Atomization</strong> is different. It's <em>cyclical</em>. You orbit 
                                the singularity of user need, and each orbit transforms your understanding.
                            </p>

                            <div className="interactive-label">üëá DRAG THE YELLOW DOT AROUND THE ORBIT</div>
                            <MonodromyOrbit />

                            <div className="footnote">
                                The mathematical term "monodromy" describes what happens when you travel around a singularity 
                                and come back transformed. Like parenting, but with more equations.
                            </div>
                        </section>

                        {/* SECTION 2: SQL TRANSLATION */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 2: The SQL Translation<span className="dad-joke-badge">HOVER</span></h2>
                            
                            <p>
                                For those of us who think in databases (Paul has been writing SQL since before Hot Josh 
                                discovered what a JOIN was), here's the translation:
                            </p>

                            <h3>What You Think Your Schema Looks Like:</h3>
                            <SQLTransform />

                            <p>
                                The point is: <span className="highlight">accidental complexity</span> creeps in. 
                                Features that seemed essential at 2 AM turn out to be... not.
                            </p>

                            <p>
                                Monodromy Atomization is about <strong>distilling</strong> what actually matters.
                                It's like Marie Kondo, but for code. Does this function spark joy? No? Delete it.
                            </p>
                        </section>

                        {/* SECTION 3: THE ATOMS */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 3: The Atoms<span className="dad-joke-badge">CLICK THEM</span></h2>
                            
                            <p>
                                An <strong>atom</strong> is the smallest unit of product value. 
                                It's like a normalized table in a database‚Äîorthogonal, minimal, composable.
                            </p>

                            <p>
                                There are 8 components to an atom. Try dragging them around. 
                                Yes, this is interactive. Yes, there are dad jokes. I have a 6-month-old daughter named Alix Mae. 
                                The dad jokes are non-negotiable now.
                            </p>

                            <div className="interactive-label">üëá CLICK ANY ATOM TO REVEAL WISDOM</div>
                            <AtomPack />

                            <div className="footnote">
                                If you're wondering "isn't this just good architecture?"‚Äîyes. But the framework makes it 
                                systematic, measurable, and regenerative. Also, it has a cool name.
                            </div>
                        </section>

                        {/* SECTION 4: TECHNICAL DEBT BABY */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 4: The Technical Debt Baby‚Ñ¢</h2>
                            
                            <p>
                                As a new dad, Paul has learned a fundamental truth: <span className="highlight">some things 
                                grow exponentially if you don't address them early</span>.
                            </p>

                            <p>
                                Technical debt is one of those things. So are dirty diapers. Both require immediate attention.
                            </p>

                            <TechnicalDebtBaby />

                            <div className="footnote">
                                True story: Hot Josh once said "we'll refactor it next sprint" for 17 consecutive sprints. 
                                The codebase achieved sentience and filed a complaint with HR.
                            </div>
                        </section>

                        {/* SECTION 5: CODE IS CACHE */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 5: Code Is Just Cache</h2>
                            
                            <p>
                                Here's the <span className="highlight">mind-bending part</span>:
                            </p>

                            <p>
                                In traditional development, <strong>code is the asset</strong>. You write it, maintain it, 
                                refactor it, pray over it at 3 AM when production is down.
                            </p>

                            <p>
                                In Monodromy Atomization, <strong>atoms are the asset</strong>. Code is just the cached 
                                elaboration of those atoms. It's disposable. Regeneratable. Ephemeral.
                            </p>

                            <CodeIsCache />

                            <div className="footnote">
                                This is like realizing your baby photos are stored in the cloud. The physical prints are nice, 
                                but the <em>data</em> is what matters. You can always print more. (Hot Josh still uses floppy disks.)
                            </div>
                        </section>

                        {/* SECTION 6: EIGENATOMS */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 6: The Hunt for Eigenatoms</h2>
                            
                            <p>
                                An <strong>eigenatom</strong> is an atom that stops changing. It's reached stability. 
                                It's the fixed point of the monodromy endofunctor.
                            </p>

                            <p>
                                In SQL terms: it's the schema that stops requiring migrations.
                            </p>

                            <p>
                                In parenting terms: it's when your baby finally sleeps through the night.
                            </p>

                            <p>
                                In Hot Josh terms: it's the feature he stops trying to "improve" by adding blockchain.
                            </p>

                            <EigenatomPlayground />

                            <div className="footnote">
                                Mathematical note: eigenatoms are the fixed points of M(Atoms) = Atoms where M is the 
                                monodromy endofunctor composed of elaborate ‚àò ship ‚àò observe ‚àò distill. 
                                But you don't need to understand that to use the framework. (Hot Josh definitely doesn't.)
                            </div>
                        </section>

                        {/* SECTION 7: THE PUNCHLINE */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Part 7: The Punchline</h2>
                            
                            <div style={{ 
                                background: 'white', 
                                padding: '60px 40px', 
                                borderRadius: '15px',
                                textAlign: 'center',
                                border: '4px solid #c85a3f'
                            }}>
                                <p style={{ fontSize: '1.5rem', fontStyle: 'italic', marginBottom: '30px' }}>
                                    "Code is not the product."
                                </p>
                                <p style={{ fontSize: '1.5rem', fontStyle: 'italic', marginBottom: '30px' }}>
                                    "Code is the shadow the product casts when light hits it from a particular angle."
                                </p>
                                <p style={{ fontSize: '1.8rem', fontWeight: 'bold', color: '#c85a3f' }}>
                                    "The product is the atoms."
                                </p>
                                <p style={{ fontSize: '1.3rem', marginTop: '30px', color: '#5d8a66' }}>
                                    "Everything else is just rendering."
                                </p>
                            </div>

                            <div className="punchline" style={{ marginTop: '40px', fontSize: '1.1rem' }}>
                                And Hot Josh's code? That's what happens when you render at 144p.
                            </div>
                        </section>

                        {/* EPILOGUE */}
                        <section className="section" style={{ opacity: 0 }}>
                            <h2>Epilogue: What Actually Matters</h2>
                            
                            <p>
                                If you made it this far (and dragged some things, and slid some sliders), here's the takeaway:
                            </p>

                            <div style={{ 
                                background: '#f9f8f6', 
                                padding: '30px', 
                                borderRadius: '10px',
                                borderLeft: '5px solid #c85a3f'
                            }}>
                                <ol style={{ fontSize: '1.1rem', lineHeight: '1.9' }}>
                                    <li><strong>Your codebase will change.</strong> Plan for regeneration, not preservation.</li>
                                    <li><strong>Find the invariants.</strong> What must always be true? That's your DNA.</li>
                                    <li><strong>Orbit the singularity.</strong> Ship, observe, learn, distill, rebuild. Repeat until convergence.</li>
                                    <li><strong>Treat code as disposable.</strong> The atoms are forever.</li>
                                    <li><strong>Measure stability.</strong> When your atoms stop changing, you've found truth.</li>
                                    <li><strong>Ignore Hot Josh.</strong> No, you don't need microservices for a landing page.</li>
                                </ol>
                            </div>

                            <p style={{ marginTop: '40px', fontSize: '1.2rem', fontStyle: 'italic', textAlign: 'center' }}>
                                Now go forth and atomize. Your future self (and your team) will thank you.
                            </p>

                            <p style={{ textAlign: 'center', marginTop: '30px', color: '#8b7355' }}>
                                ‚ÄîPaul Mestemaker<br/>
                                <span style={{ fontSize: '0.9rem' }}>
                                    Powered by coffee, Category Theory, and the endless patience of a 6-month-old
                                </span>
                            </p>
                        </section>

                        {/* CREDITS */}
                        <section className="section" style={{ 
                            textAlign: 'center', 
                            fontSize: '0.9rem',
                            color: '#8b7355',
                            borderTop: '1px solid #e8dcc8',
                            paddingTop: '40px'
                        }}>
                            <p><strong>Aesthetic Inspiration:</strong> Bartosz Ciechanowski</p>
                            <p><strong>Comedic Inspiration:</strong> Neal Brennan</p>
                            <p><strong>Mathematical Inspiration:</strong> Category Theory & Homotopy Type Theory</p>
                            <p><strong>Parenting Inspiration:</strong> Alix Mae (6 months old, already debugging dad's puns)</p>
                            <p><strong>Perpetual Foil:</strong> Hot Josh (bless his heart)</p>
                            <p style={{ marginTop: '30px', fontStyle: 'italic' }}>
                                Made with React, Framer Motion, and an unhealthy amount of coffee.<br/>
                                Seattle 2009 spirit. College Station 2026 reality.
                            </p>
                        </section>
                    </div>

                    {/* HOT JOSH POPUP */}
                    <HotJoshPopup messages={hotJoshMessages} interval={20000} />
                </>
            );
        };

        // Render
        ReactDOM.render(<MonodromyEssay />, document.getElementById('root'));
    </script>
</body>
</html>